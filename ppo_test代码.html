<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>&#x6587;&#x4ef6;&#x7ed3;&#x6784;</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

/* From extension goessner.mdmath */
@font-face{font-family:KaTeX_AMS;font-style:normal;font-weight:400;src:url(fonts/KaTeX_AMS-Regular.woff2) format("woff2"),url(fonts/KaTeX_AMS-Regular.woff) format("woff"),url(fonts/KaTeX_AMS-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Caligraphic;font-style:normal;font-weight:700;src:url(fonts/KaTeX_Caligraphic-Bold.woff2) format("woff2"),url(fonts/KaTeX_Caligraphic-Bold.woff) format("woff"),url(fonts/KaTeX_Caligraphic-Bold.ttf) format("truetype")}@font-face{font-family:KaTeX_Caligraphic;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Caligraphic-Regular.woff2) format("woff2"),url(fonts/KaTeX_Caligraphic-Regular.woff) format("woff"),url(fonts/KaTeX_Caligraphic-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Fraktur;font-style:normal;font-weight:700;src:url(fonts/KaTeX_Fraktur-Bold.woff2) format("woff2"),url(fonts/KaTeX_Fraktur-Bold.woff) format("woff"),url(fonts/KaTeX_Fraktur-Bold.ttf) format("truetype")}@font-face{font-family:KaTeX_Fraktur;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Fraktur-Regular.woff2) format("woff2"),url(fonts/KaTeX_Fraktur-Regular.woff) format("woff"),url(fonts/KaTeX_Fraktur-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:normal;font-weight:700;src:url(fonts/KaTeX_Main-Bold.woff2) format("woff2"),url(fonts/KaTeX_Main-Bold.woff) format("woff"),url(fonts/KaTeX_Main-Bold.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:italic;font-weight:700;src:url(fonts/KaTeX_Main-BoldItalic.woff2) format("woff2"),url(fonts/KaTeX_Main-BoldItalic.woff) format("woff"),url(fonts/KaTeX_Main-BoldItalic.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:italic;font-weight:400;src:url(fonts/KaTeX_Main-Italic.woff2) format("woff2"),url(fonts/KaTeX_Main-Italic.woff) format("woff"),url(fonts/KaTeX_Main-Italic.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Main-Regular.woff2) format("woff2"),url(fonts/KaTeX_Main-Regular.woff) format("woff"),url(fonts/KaTeX_Main-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Math;font-style:italic;font-weight:700;src:url(fonts/KaTeX_Math-BoldItalic.woff2) format("woff2"),url(fonts/KaTeX_Math-BoldItalic.woff) format("woff"),url(fonts/KaTeX_Math-BoldItalic.ttf) format("truetype")}@font-face{font-family:KaTeX_Math;font-style:italic;font-weight:400;src:url(fonts/KaTeX_Math-Italic.woff2) format("woff2"),url(fonts/KaTeX_Math-Italic.woff) format("woff"),url(fonts/KaTeX_Math-Italic.ttf) format("truetype")}@font-face{font-family:"KaTeX_SansSerif";font-style:normal;font-weight:700;src:url(fonts/KaTeX_SansSerif-Bold.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Bold.woff) format("woff"),url(fonts/KaTeX_SansSerif-Bold.ttf) format("truetype")}@font-face{font-family:"KaTeX_SansSerif";font-style:italic;font-weight:400;src:url(fonts/KaTeX_SansSerif-Italic.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Italic.woff) format("woff"),url(fonts/KaTeX_SansSerif-Italic.ttf) format("truetype")}@font-face{font-family:"KaTeX_SansSerif";font-style:normal;font-weight:400;src:url(fonts/KaTeX_SansSerif-Regular.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Regular.woff) format("woff"),url(fonts/KaTeX_SansSerif-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Script;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Script-Regular.woff2) format("woff2"),url(fonts/KaTeX_Script-Regular.woff) format("woff"),url(fonts/KaTeX_Script-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size1;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size1-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size1-Regular.woff) format("woff"),url(fonts/KaTeX_Size1-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size2;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size2-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size2-Regular.woff) format("woff"),url(fonts/KaTeX_Size2-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size3;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size3-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size3-Regular.woff) format("woff"),url(fonts/KaTeX_Size3-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size4;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size4-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size4-Regular.woff) format("woff"),url(fonts/KaTeX_Size4-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Typewriter;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Typewriter-Regular.woff2) format("woff2"),url(fonts/KaTeX_Typewriter-Regular.woff) format("woff"),url(fonts/KaTeX_Typewriter-Regular.ttf) format("truetype")}.katex{font:normal 1.21em KaTeX_Main,Times New Roman,serif;line-height:1.2;text-indent:0;text-rendering:auto}.katex *{-ms-high-contrast-adjust:none!important;border-color:currentColor}.katex .katex-version:after{content:"0.13.11"}.katex .katex-mathml{clip:rect(1px,1px,1px,1px);border:0;height:1px;overflow:hidden;padding:0;position:absolute;width:1px}.katex .katex-html>.newline{display:block}.katex .base{position:relative;white-space:nowrap;width:-webkit-min-content;width:-moz-min-content;width:min-content}.katex .base,.katex .strut{display:inline-block}.katex .textbf{font-weight:700}.katex .textit{font-style:italic}.katex .textrm{font-family:KaTeX_Main}.katex .textsf{font-family:KaTeX_SansSerif}.katex .texttt{font-family:KaTeX_Typewriter}.katex .mathnormal{font-family:KaTeX_Math;font-style:italic}.katex .mathit{font-family:KaTeX_Main;font-style:italic}.katex .mathrm{font-style:normal}.katex .mathbf{font-family:KaTeX_Main;font-weight:700}.katex .boldsymbol{font-family:KaTeX_Math;font-style:italic;font-weight:700}.katex .amsrm,.katex .mathbb,.katex .textbb{font-family:KaTeX_AMS}.katex .mathcal{font-family:KaTeX_Caligraphic}.katex .mathfrak,.katex .textfrak{font-family:KaTeX_Fraktur}.katex .mathtt{font-family:KaTeX_Typewriter}.katex .mathscr,.katex .textscr{font-family:KaTeX_Script}.katex .mathsf,.katex .textsf{font-family:KaTeX_SansSerif}.katex .mathboldsf,.katex .textboldsf{font-family:KaTeX_SansSerif;font-weight:700}.katex .mathitsf,.katex .textitsf{font-family:KaTeX_SansSerif;font-style:italic}.katex .mainrm{font-family:KaTeX_Main;font-style:normal}.katex .vlist-t{border-collapse:collapse;display:inline-table;table-layout:fixed}.katex .vlist-r{display:table-row}.katex .vlist{display:table-cell;position:relative;vertical-align:bottom}.katex .vlist>span{display:block;height:0;position:relative}.katex .vlist>span>span{display:inline-block}.katex .vlist>span>.pstrut{overflow:hidden;width:0}.katex .vlist-t2{margin-right:-2px}.katex .vlist-s{display:table-cell;font-size:1px;min-width:2px;vertical-align:bottom;width:2px}.katex .vbox{-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-box-align:baseline;align-items:baseline;display:-webkit-inline-box;display:inline-flex;flex-direction:column}.katex .hbox{width:100%}.katex .hbox,.katex .thinbox{-webkit-box-orient:horizontal;-webkit-box-direction:normal;display:-webkit-inline-box;display:inline-flex;flex-direction:row}.katex .thinbox{max-width:0;width:0}.katex .msupsub{text-align:left}.katex .mfrac>span>span{text-align:center}.katex .mfrac .frac-line{border-bottom-style:solid;display:inline-block;width:100%}.katex .hdashline,.katex .hline,.katex .mfrac .frac-line,.katex .overline .overline-line,.katex .rule,.katex .underline .underline-line{min-height:1px}.katex .mspace{display:inline-block}.katex .clap,.katex .llap,.katex .rlap{position:relative;width:0}.katex .clap>.inner,.katex .llap>.inner,.katex .rlap>.inner{position:absolute}.katex .clap>.fix,.katex .llap>.fix,.katex .rlap>.fix{display:inline-block}.katex .llap>.inner{right:0}.katex .clap>.inner,.katex .rlap>.inner{left:0}.katex .clap>.inner>span{margin-left:-50%;margin-right:50%}.katex .rule{border:0 solid;display:inline-block;position:relative}.katex .hline,.katex .overline .overline-line,.katex .underline .underline-line{border-bottom-style:solid;display:inline-block;width:100%}.katex .hdashline{border-bottom-style:dashed;display:inline-block;width:100%}.katex .sqrt>.root{margin-left:.27777778em;margin-right:-.55555556em}.katex .fontsize-ensurer.reset-size1.size1,.katex .sizing.reset-size1.size1{font-size:1em}.katex .fontsize-ensurer.reset-size1.size2,.katex .sizing.reset-size1.size2{font-size:1.2em}.katex .fontsize-ensurer.reset-size1.size3,.katex .sizing.reset-size1.size3{font-size:1.4em}.katex .fontsize-ensurer.reset-size1.size4,.katex .sizing.reset-size1.size4{font-size:1.6em}.katex .fontsize-ensurer.reset-size1.size5,.katex .sizing.reset-size1.size5{font-size:1.8em}.katex .fontsize-ensurer.reset-size1.size6,.katex .sizing.reset-size1.size6{font-size:2em}.katex .fontsize-ensurer.reset-size1.size7,.katex .sizing.reset-size1.size7{font-size:2.4em}.katex .fontsize-ensurer.reset-size1.size8,.katex .sizing.reset-size1.size8{font-size:2.88em}.katex .fontsize-ensurer.reset-size1.size9,.katex .sizing.reset-size1.size9{font-size:3.456em}.katex .fontsize-ensurer.reset-size1.size10,.katex .sizing.reset-size1.size10{font-size:4.148em}.katex .fontsize-ensurer.reset-size1.size11,.katex .sizing.reset-size1.size11{font-size:4.976em}.katex .fontsize-ensurer.reset-size2.size1,.katex .sizing.reset-size2.size1{font-size:.83333333em}.katex .fontsize-ensurer.reset-size2.size2,.katex .sizing.reset-size2.size2{font-size:1em}.katex .fontsize-ensurer.reset-size2.size3,.katex .sizing.reset-size2.size3{font-size:1.16666667em}.katex .fontsize-ensurer.reset-size2.size4,.katex .sizing.reset-size2.size4{font-size:1.33333333em}.katex .fontsize-ensurer.reset-size2.size5,.katex .sizing.reset-size2.size5{font-size:1.5em}.katex .fontsize-ensurer.reset-size2.size6,.katex .sizing.reset-size2.size6{font-size:1.66666667em}.katex .fontsize-ensurer.reset-size2.size7,.katex .sizing.reset-size2.size7{font-size:2em}.katex .fontsize-ensurer.reset-size2.size8,.katex .sizing.reset-size2.size8{font-size:2.4em}.katex .fontsize-ensurer.reset-size2.size9,.katex .sizing.reset-size2.size9{font-size:2.88em}.katex .fontsize-ensurer.reset-size2.size10,.katex .sizing.reset-size2.size10{font-size:3.45666667em}.katex .fontsize-ensurer.reset-size2.size11,.katex .sizing.reset-size2.size11{font-size:4.14666667em}.katex .fontsize-ensurer.reset-size3.size1,.katex .sizing.reset-size3.size1{font-size:.71428571em}.katex .fontsize-ensurer.reset-size3.size2,.katex .sizing.reset-size3.size2{font-size:.85714286em}.katex .fontsize-ensurer.reset-size3.size3,.katex .sizing.reset-size3.size3{font-size:1em}.katex .fontsize-ensurer.reset-size3.size4,.katex .sizing.reset-size3.size4{font-size:1.14285714em}.katex .fontsize-ensurer.reset-size3.size5,.katex .sizing.reset-size3.size5{font-size:1.28571429em}.katex .fontsize-ensurer.reset-size3.size6,.katex .sizing.reset-size3.size6{font-size:1.42857143em}.katex .fontsize-ensurer.reset-size3.size7,.katex .sizing.reset-size3.size7{font-size:1.71428571em}.katex .fontsize-ensurer.reset-size3.size8,.katex .sizing.reset-size3.size8{font-size:2.05714286em}.katex .fontsize-ensurer.reset-size3.size9,.katex .sizing.reset-size3.size9{font-size:2.46857143em}.katex .fontsize-ensurer.reset-size3.size10,.katex .sizing.reset-size3.size10{font-size:2.96285714em}.katex .fontsize-ensurer.reset-size3.size11,.katex .sizing.reset-size3.size11{font-size:3.55428571em}.katex .fontsize-ensurer.reset-size4.size1,.katex .sizing.reset-size4.size1{font-size:.625em}.katex .fontsize-ensurer.reset-size4.size2,.katex .sizing.reset-size4.size2{font-size:.75em}.katex .fontsize-ensurer.reset-size4.size3,.katex .sizing.reset-size4.size3{font-size:.875em}.katex .fontsize-ensurer.reset-size4.size4,.katex .sizing.reset-size4.size4{font-size:1em}.katex .fontsize-ensurer.reset-size4.size5,.katex .sizing.reset-size4.size5{font-size:1.125em}.katex .fontsize-ensurer.reset-size4.size6,.katex .sizing.reset-size4.size6{font-size:1.25em}.katex .fontsize-ensurer.reset-size4.size7,.katex .sizing.reset-size4.size7{font-size:1.5em}.katex .fontsize-ensurer.reset-size4.size8,.katex .sizing.reset-size4.size8{font-size:1.8em}.katex .fontsize-ensurer.reset-size4.size9,.katex .sizing.reset-size4.size9{font-size:2.16em}.katex .fontsize-ensurer.reset-size4.size10,.katex .sizing.reset-size4.size10{font-size:2.5925em}.katex .fontsize-ensurer.reset-size4.size11,.katex .sizing.reset-size4.size11{font-size:3.11em}.katex .fontsize-ensurer.reset-size5.size1,.katex .sizing.reset-size5.size1{font-size:.55555556em}.katex .fontsize-ensurer.reset-size5.size2,.katex .sizing.reset-size5.size2{font-size:.66666667em}.katex .fontsize-ensurer.reset-size5.size3,.katex .sizing.reset-size5.size3{font-size:.77777778em}.katex .fontsize-ensurer.reset-size5.size4,.katex .sizing.reset-size5.size4{font-size:.88888889em}.katex .fontsize-ensurer.reset-size5.size5,.katex .sizing.reset-size5.size5{font-size:1em}.katex .fontsize-ensurer.reset-size5.size6,.katex .sizing.reset-size5.size6{font-size:1.11111111em}.katex .fontsize-ensurer.reset-size5.size7,.katex .sizing.reset-size5.size7{font-size:1.33333333em}.katex .fontsize-ensurer.reset-size5.size8,.katex .sizing.reset-size5.size8{font-size:1.6em}.katex .fontsize-ensurer.reset-size5.size9,.katex .sizing.reset-size5.size9{font-size:1.92em}.katex .fontsize-ensurer.reset-size5.size10,.katex .sizing.reset-size5.size10{font-size:2.30444444em}.katex .fontsize-ensurer.reset-size5.size11,.katex .sizing.reset-size5.size11{font-size:2.76444444em}.katex .fontsize-ensurer.reset-size6.size1,.katex .sizing.reset-size6.size1{font-size:.5em}.katex .fontsize-ensurer.reset-size6.size2,.katex .sizing.reset-size6.size2{font-size:.6em}.katex .fontsize-ensurer.reset-size6.size3,.katex .sizing.reset-size6.size3{font-size:.7em}.katex .fontsize-ensurer.reset-size6.size4,.katex .sizing.reset-size6.size4{font-size:.8em}.katex .fontsize-ensurer.reset-size6.size5,.katex .sizing.reset-size6.size5{font-size:.9em}.katex .fontsize-ensurer.reset-size6.size6,.katex .sizing.reset-size6.size6{font-size:1em}.katex .fontsize-ensurer.reset-size6.size7,.katex .sizing.reset-size6.size7{font-size:1.2em}.katex .fontsize-ensurer.reset-size6.size8,.katex .sizing.reset-size6.size8{font-size:1.44em}.katex .fontsize-ensurer.reset-size6.size9,.katex .sizing.reset-size6.size9{font-size:1.728em}.katex .fontsize-ensurer.reset-size6.size10,.katex .sizing.reset-size6.size10{font-size:2.074em}.katex .fontsize-ensurer.reset-size6.size11,.katex .sizing.reset-size6.size11{font-size:2.488em}.katex .fontsize-ensurer.reset-size7.size1,.katex .sizing.reset-size7.size1{font-size:.41666667em}.katex .fontsize-ensurer.reset-size7.size2,.katex .sizing.reset-size7.size2{font-size:.5em}.katex .fontsize-ensurer.reset-size7.size3,.katex .sizing.reset-size7.size3{font-size:.58333333em}.katex .fontsize-ensurer.reset-size7.size4,.katex .sizing.reset-size7.size4{font-size:.66666667em}.katex .fontsize-ensurer.reset-size7.size5,.katex .sizing.reset-size7.size5{font-size:.75em}.katex .fontsize-ensurer.reset-size7.size6,.katex .sizing.reset-size7.size6{font-size:.83333333em}.katex .fontsize-ensurer.reset-size7.size7,.katex .sizing.reset-size7.size7{font-size:1em}.katex .fontsize-ensurer.reset-size7.size8,.katex .sizing.reset-size7.size8{font-size:1.2em}.katex .fontsize-ensurer.reset-size7.size9,.katex .sizing.reset-size7.size9{font-size:1.44em}.katex .fontsize-ensurer.reset-size7.size10,.katex .sizing.reset-size7.size10{font-size:1.72833333em}.katex .fontsize-ensurer.reset-size7.size11,.katex .sizing.reset-size7.size11{font-size:2.07333333em}.katex .fontsize-ensurer.reset-size8.size1,.katex .sizing.reset-size8.size1{font-size:.34722222em}.katex .fontsize-ensurer.reset-size8.size2,.katex .sizing.reset-size8.size2{font-size:.41666667em}.katex .fontsize-ensurer.reset-size8.size3,.katex .sizing.reset-size8.size3{font-size:.48611111em}.katex .fontsize-ensurer.reset-size8.size4,.katex .sizing.reset-size8.size4{font-size:.55555556em}.katex .fontsize-ensurer.reset-size8.size5,.katex .sizing.reset-size8.size5{font-size:.625em}.katex .fontsize-ensurer.reset-size8.size6,.katex .sizing.reset-size8.size6{font-size:.69444444em}.katex .fontsize-ensurer.reset-size8.size7,.katex .sizing.reset-size8.size7{font-size:.83333333em}.katex .fontsize-ensurer.reset-size8.size8,.katex .sizing.reset-size8.size8{font-size:1em}.katex .fontsize-ensurer.reset-size8.size9,.katex .sizing.reset-size8.size9{font-size:1.2em}.katex .fontsize-ensurer.reset-size8.size10,.katex .sizing.reset-size8.size10{font-size:1.44027778em}.katex .fontsize-ensurer.reset-size8.size11,.katex .sizing.reset-size8.size11{font-size:1.72777778em}.katex .fontsize-ensurer.reset-size9.size1,.katex .sizing.reset-size9.size1{font-size:.28935185em}.katex .fontsize-ensurer.reset-size9.size2,.katex .sizing.reset-size9.size2{font-size:.34722222em}.katex .fontsize-ensurer.reset-size9.size3,.katex .sizing.reset-size9.size3{font-size:.40509259em}.katex .fontsize-ensurer.reset-size9.size4,.katex .sizing.reset-size9.size4{font-size:.46296296em}.katex .fontsize-ensurer.reset-size9.size5,.katex .sizing.reset-size9.size5{font-size:.52083333em}.katex .fontsize-ensurer.reset-size9.size6,.katex .sizing.reset-size9.size6{font-size:.5787037em}.katex .fontsize-ensurer.reset-size9.size7,.katex .sizing.reset-size9.size7{font-size:.69444444em}.katex .fontsize-ensurer.reset-size9.size8,.katex .sizing.reset-size9.size8{font-size:.83333333em}.katex .fontsize-ensurer.reset-size9.size9,.katex .sizing.reset-size9.size9{font-size:1em}.katex .fontsize-ensurer.reset-size9.size10,.katex .sizing.reset-size9.size10{font-size:1.20023148em}.katex .fontsize-ensurer.reset-size9.size11,.katex .sizing.reset-size9.size11{font-size:1.43981481em}.katex .fontsize-ensurer.reset-size10.size1,.katex .sizing.reset-size10.size1{font-size:.24108004em}.katex .fontsize-ensurer.reset-size10.size2,.katex .sizing.reset-size10.size2{font-size:.28929605em}.katex .fontsize-ensurer.reset-size10.size3,.katex .sizing.reset-size10.size3{font-size:.33751205em}.katex .fontsize-ensurer.reset-size10.size4,.katex .sizing.reset-size10.size4{font-size:.38572806em}.katex .fontsize-ensurer.reset-size10.size5,.katex .sizing.reset-size10.size5{font-size:.43394407em}.katex .fontsize-ensurer.reset-size10.size6,.katex .sizing.reset-size10.size6{font-size:.48216008em}.katex .fontsize-ensurer.reset-size10.size7,.katex .sizing.reset-size10.size7{font-size:.57859209em}.katex .fontsize-ensurer.reset-size10.size8,.katex .sizing.reset-size10.size8{font-size:.69431051em}.katex .fontsize-ensurer.reset-size10.size9,.katex .sizing.reset-size10.size9{font-size:.83317261em}.katex .fontsize-ensurer.reset-size10.size10,.katex .sizing.reset-size10.size10{font-size:1em}.katex .fontsize-ensurer.reset-size10.size11,.katex .sizing.reset-size10.size11{font-size:1.19961427em}.katex .fontsize-ensurer.reset-size11.size1,.katex .sizing.reset-size11.size1{font-size:.20096463em}.katex .fontsize-ensurer.reset-size11.size2,.katex .sizing.reset-size11.size2{font-size:.24115756em}.katex .fontsize-ensurer.reset-size11.size3,.katex .sizing.reset-size11.size3{font-size:.28135048em}.katex .fontsize-ensurer.reset-size11.size4,.katex .sizing.reset-size11.size4{font-size:.32154341em}.katex .fontsize-ensurer.reset-size11.size5,.katex .sizing.reset-size11.size5{font-size:.36173633em}.katex .fontsize-ensurer.reset-size11.size6,.katex .sizing.reset-size11.size6{font-size:.40192926em}.katex .fontsize-ensurer.reset-size11.size7,.katex .sizing.reset-size11.size7{font-size:.48231511em}.katex .fontsize-ensurer.reset-size11.size8,.katex .sizing.reset-size11.size8{font-size:.57877814em}.katex .fontsize-ensurer.reset-size11.size9,.katex .sizing.reset-size11.size9{font-size:.69453376em}.katex .fontsize-ensurer.reset-size11.size10,.katex .sizing.reset-size11.size10{font-size:.83360129em}.katex .fontsize-ensurer.reset-size11.size11,.katex .sizing.reset-size11.size11{font-size:1em}.katex .delimsizing.size1{font-family:KaTeX_Size1}.katex .delimsizing.size2{font-family:KaTeX_Size2}.katex .delimsizing.size3{font-family:KaTeX_Size3}.katex .delimsizing.size4{font-family:KaTeX_Size4}.katex .delimsizing.mult .delim-size1>span{font-family:KaTeX_Size1}.katex .delimsizing.mult .delim-size4>span{font-family:KaTeX_Size4}.katex .nulldelimiter{display:inline-block;width:.12em}.katex .delimcenter,.katex .op-symbol{position:relative}.katex .op-symbol.small-op{font-family:KaTeX_Size1}.katex .op-symbol.large-op{font-family:KaTeX_Size2}.katex .accent>.vlist-t,.katex .op-limits>.vlist-t{text-align:center}.katex .accent .accent-body{position:relative}.katex .accent .accent-body:not(.accent-full){width:0}.katex .overlay{display:block}.katex .mtable .vertical-separator{display:inline-block;min-width:1px}.katex .mtable .arraycolsep{display:inline-block}.katex .mtable .col-align-c>.vlist-t{text-align:center}.katex .mtable .col-align-l>.vlist-t{text-align:left}.katex .mtable .col-align-r>.vlist-t{text-align:right}.katex .svg-align{text-align:left}.katex svg{fill:currentColor;stroke:currentColor;fill-rule:nonzero;fill-opacity:1;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;display:block;height:inherit;position:absolute;width:100%}.katex svg path{stroke:none}.katex img{border-style:none;max-height:none;max-width:none;min-height:0;min-width:0}.katex .stretchy{display:block;overflow:hidden;position:relative;width:100%}.katex .stretchy:after,.katex .stretchy:before{content:""}.katex .hide-tail{overflow:hidden;position:relative;width:100%}.katex .halfarrow-left{left:0;overflow:hidden;position:absolute;width:50.2%}.katex .halfarrow-right{overflow:hidden;position:absolute;right:0;width:50.2%}.katex .brace-left{left:0;overflow:hidden;position:absolute;width:25.1%}.katex .brace-center{left:25%;overflow:hidden;position:absolute;width:50%}.katex .brace-right{overflow:hidden;position:absolute;right:0;width:25.1%}.katex .x-arrow-pad{padding:0 .5em}.katex .cd-arrow-pad{padding:0 .55556em 0 .27778em}.katex .mover,.katex .munder,.katex .x-arrow{text-align:center}.katex .boxpad{padding:0 .3em}.katex .fbox,.katex .fcolorbox{border:.04em solid;box-sizing:border-box}.katex .cancel-pad{padding:0 .2em}.katex .cancel-lap{margin-left:-.2em;margin-right:-.2em}.katex .sout{border-bottom-style:solid;border-bottom-width:.08em}.katex .angl{border-right:.049em solid;border-top:.049em solid;box-sizing:border-content;margin-right:.03889em}.katex .anglpad{padding:0 .03889em}.katex .eqn-num:before{content:"(" counter(katexEqnNo) ")";counter-increment:katexEqnNo}.katex .mml-eqn-num:before{content:"(" counter(mmlEqnNo) ")";counter-increment:mmlEqnNo}.katex .mtr-glue{width:50%}.katex .cd-vert-arrow{display:inline-block;position:relative}.katex .cd-label-left{display:inline-block;position:absolute;right:-webkit-calc(50% + .3em);right:calc(50% + .3em);text-align:left}.katex .cd-label-right{display:inline-block;left:-webkit-calc(50% + .3em);left:calc(50% + .3em);position:absolute;text-align:right}.katex-display{display:block;margin:1em 0;text-align:center}.katex-display>.katex{display:block;text-align:center;white-space:nowrap}.katex-display>.katex>.katex-html{display:block;position:relative}.katex-display>.katex>.katex-html>.tag{position:absolute;right:0}.katex-display.leqno>.katex>.katex-html>.tag{left:0;right:auto}.katex-display.fleqn>.katex{padding-left:2em;text-align:left}body{counter-reset:katexEqnNo mmlEqnNo}

/* style for html inside of browsers */
.katex { font-size: 1em !important; } /* align KaTeX font-size to surrounding text */

eq { display: inline-block; }
eqn { display: block}
section.eqno {
    display: flex;
    flex-direction: row;
    align-content: space-between;
    align-items: center;
}
section.eqno > eqn {
    width: 100%;
    margin-left: 3em;
}
section.eqno > span {
    width:3em;
    text-align:right;
}

p { 
    text-align: justify; 
    hyphens: auto;
}

table {
    display: table;
    width: auto;
    margin-left: auto;
    margin-right: auto;
    margin-bottom: 1em;
    border-collapse: collapse;
}

table th, table td {
    border-left: none;
    border-right: none;
    border-top: 1px solid #000;
    border-bottom: 1px solid #000;
}

figure {
    margin: 0.5em auto;
}
figure > img {
    display: block;
    margin: 0 auto;
    page-break-inside: avoid;
    text-align: center;
}
figcaption { 
    font-size: 0.9em;
    margin-top: 0.5em;
    text-align: center;
}

aside {
  font-size: 0.9em;
  max-width: 300px;
  padding: 0 0 0 1em;
  margin: 0 0 0 1em;
  float: right;
}

aside > *:first-child {
  margin-top: 0;
}
aside > *:last-child {
  margin-bottom: 0;
}

</style>
            
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h2 id="文件结构">文件结构</h2>
<pre><code>📁 .
  📁 ppo_test
    📁 policies
      📄 __init__.py
      📄 action.py
      📄 policy.py
      📄 sawyer_peg_insertion_side_v3_policy.py
    📁 utils
      📄 reward_utils.py
    📁 xml
      📄 basic_scene.xml
      📄 peg_block_dependencies.xml
      📄 peg_block.xml
      📄 peg_insert_dependencies.xml
      📄 sawyer_peg_insertion_side.xml
      📄 xyz_base_dependencies.xml
      📄 xyz_base.xml
    📄 __init__.py
    📄 asset_path_utils.py
    📄 env_dict.py
    📄 evaluation.py
    📄 sawyer_peg_insertion_side_v3.py
    📄 sawyer_xyz_env.py
    📄 types.py
    📄 wrappers.py
</code></pre>
<h2 id="源文件">源文件</h2>
<h3 id="ppo_testpoliciesinitpy">ppo_test/policies/<strong>init</strong>.py</h3>
<p><em>大小: 281 B | Token: 78</em></p>
<pre><code class="language-python"><span class="hljs-keyword">from</span> ppo_test.policies.sawyer_peg_insertion_side_v3_policy <span class="hljs-keyword">import</span> (
    SawyerPegInsertionSideV3Policy,
)

ENV_POLICY_MAP = <span class="hljs-built_in">dict</span>(
    {
        <span class="hljs-string">&quot;peg-insert-side-v3&quot;</span>: SawyerPegInsertionSideV3Policy,
    }
)

__all__ = [
    <span class="hljs-string">&quot;SawyerPegInsertionSideV3Policy&quot;</span>,
    <span class="hljs-string">&quot;ENV_POLICY_MAP&quot;</span>,
]
</code></pre>
<h3 id="ppo_testpoliciesactionpy">ppo_test/policies/action.py</h3>
<p><em>大小: 854 B | Token: 235</em></p>
<pre><code class="language-python"><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> annotations

<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> numpy.typing <span class="hljs-keyword">as</span> npt


<span class="hljs-keyword">class</span> <span class="hljs-title class_">Action</span>:
    <span class="hljs-string">&quot;&quot;&quot;Represents an action to be taken in an environment.&quot;&quot;&quot;</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, action_dim: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">&quot;&quot;&quot;Action.

        Args:
            action_dim: The dimension of the action space.
        &quot;&quot;&quot;</span>
        self.action_dim = action_dim
        self.array = np.zeros(action_dim, dtype=np.float32)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">sample</span>(<span class="hljs-params">self</span>) -&gt; np.ndarray:
        <span class="hljs-string">&quot;&quot;&quot;Samples a random action from the action space.&quot;&quot;&quot;</span>
        <span class="hljs-keyword">return</span> np.random.uniform(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, self.action_dim).astype(np.float32)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">set_action</span>(<span class="hljs-params">self, action: np.ndarray</span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">&quot;&quot;&quot;Sets the action array.

        Args:
            action: The action array to set.
        &quot;&quot;&quot;</span>
        <span class="hljs-keyword">assert</span> action.shape[<span class="hljs-number">0</span>] == self.action_dim, <span class="hljs-string">&quot;Action dimension mismatch&quot;</span>
        self.array = action
</code></pre>
<h3 id="ppo_testpoliciespolicypy">ppo_test/policies/policy.py</h3>
<p><em>大小: 2.3 KB | Token: 647</em></p>
<pre><code class="language-python"><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> annotations

<span class="hljs-keyword">import</span> abc
<span class="hljs-keyword">import</span> warnings
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Any</span>, <span class="hljs-type">Callable</span>

<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> numpy.typing <span class="hljs-keyword">as</span> npt


<span class="hljs-keyword">def</span> <span class="hljs-title function_">assert_fully_parsed</span>(<span class="hljs-params">
    func: <span class="hljs-type">Callable</span>[[npt.NDArray[np.float64]], <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, npt.NDArray[np.float64]]]
</span>) -&gt; <span class="hljs-type">Callable</span>[[npt.NDArray[np.float64]], <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, npt.NDArray[np.float64]]]:
    <span class="hljs-string">&quot;&quot;&quot;Decorator function to ensure observations are fully parsed.

    Args:
        func: The function to check

    Returns:
        The input function, decorated to assert full parsing
    &quot;&quot;&quot;</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">inner</span>(<span class="hljs-params">obs</span>) -&gt; <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]:
        obs_dict = func(obs)
        <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(obs) == <span class="hljs-built_in">sum</span>(
            [<span class="hljs-built_in">len</span>(i) <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(i, np.ndarray) <span class="hljs-keyword">else</span> <span class="hljs-number">1</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> obs_dict.values()]
        ), <span class="hljs-string">&quot;Observation not fully parsed&quot;</span>
        <span class="hljs-keyword">return</span> obs_dict

    <span class="hljs-keyword">return</span> inner


<span class="hljs-keyword">def</span> <span class="hljs-title function_">move</span>(<span class="hljs-params">
    from_xyz: npt.NDArray[<span class="hljs-type">Any</span>], to_xyz: npt.NDArray[<span class="hljs-type">Any</span>], p: <span class="hljs-built_in">float</span>
</span>) -&gt; npt.NDArray[<span class="hljs-type">Any</span>]:
    <span class="hljs-string">&quot;&quot;&quot;Computes action components that help move from 1 position to another.

    Args:
        from_xyz: The coordinates to move from (usually current position)
        to_xyz: The coordinates to move to
        p: constant to scale response

    Returns:
        Response that will decrease abs(to_xyz - from_xyz)
    &quot;&quot;&quot;</span>
    error = to_xyz - from_xyz
    response = p * error
    <span class="hljs-comment"># if np.any(np.absolute(response) &gt; 1.0):</span>
    <span class="hljs-comment">#     warnings.warn(</span>
    <span class="hljs-comment">#         &quot;Constant(s) may be too high. Environments clip response to [-1, 1]&quot;</span>
    <span class="hljs-comment">#     )</span>

    <span class="hljs-keyword">return</span> response


<span class="hljs-keyword">class</span> <span class="hljs-title class_">Policy</span>(abc.ABC):
    <span class="hljs-string">&quot;&quot;&quot;Abstract base class for policies.&quot;&quot;&quot;</span>

<span class="hljs-meta">    @staticmethod</span>
<span class="hljs-meta">    @abc.abstractmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_parse_obs</span>(<span class="hljs-params">obs: npt.NDArray[np.float64]</span>) -&gt; <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, npt.NDArray[np.float64]]:
        <span class="hljs-string">&quot;&quot;&quot;Pulls pertinent information out of observation and places in a dict.

        Args:
            obs: Observation which conforms to env.observation_space

        Returns:
            dict: Dictionary which contains information from the observation
        &quot;&quot;&quot;</span>
        <span class="hljs-keyword">raise</span> NotImplementedError

<span class="hljs-meta">    @abc.abstractmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_action</span>(<span class="hljs-params">self, obs: npt.NDArray[np.float64]</span>) -&gt; npt.NDArray[np.float32]:
        <span class="hljs-string">&quot;&quot;&quot;Gets an action in response to an observation.

        Args:
            obs: Observation which conforms to env.observation_space

        Returns:
            Array (usually 4 elements) representing the action to take
        &quot;&quot;&quot;</span>
        <span class="hljs-keyword">raise</span> NotImplementedError
</code></pre>
<h3 id="ppo_testpoliciessawyer_peg_insertion_side_v3_policypy">ppo_test/policies/sawyer_peg_insertion_side_v3_policy.py</h3>
<p><em>大小: 3.3 KB | Token: 917</em></p>
<pre><code class="language-python"><span class="hljs-comment"># metaworld/policies/sawyer_peg_insertion_side_v3_policy.py</span>

<span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> annotations

<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Any</span>

<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> numpy.typing <span class="hljs-keyword">as</span> npt

<span class="hljs-keyword">from</span> ppo_test.policies.action <span class="hljs-keyword">import</span> Action
<span class="hljs-keyword">from</span> ppo_test.policies.policy <span class="hljs-keyword">import</span> Policy, assert_fully_parsed, move


<span class="hljs-keyword">class</span> <span class="hljs-title class_">SawyerPegInsertionSideV3Policy</span>(<span class="hljs-title class_ inherited__">Policy</span>):
<span class="hljs-meta">    @staticmethod</span>
<span class="hljs-meta">    @assert_fully_parsed</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_parse_obs</span>(<span class="hljs-params">obs: npt.NDArray[np.float64]</span>) -&gt; <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, npt.NDArray[np.float64]]:
        <span class="hljs-comment"># Current observation breakdown:</span>
        <span class="hljs-comment"># 0-2: hand_pos (3)</span>
        <span class="hljs-comment"># 3-6: quat_hand (4)</span>
        <span class="hljs-comment"># 7: gripper_distance_apart (1)</span>
        <span class="hljs-comment"># 8-10: pegHead_force (3)</span>
        <span class="hljs-comment"># 11-13: peg_pos (3)        </span>
        <span class="hljs-comment"># 14-17: peg_rot (4)        </span>
        <span class="hljs-comment"># 18-24: unused_info_curr_obs (7)</span>
        <span class="hljs-comment"># Total curr_obs = 3 + 4 + 1 + 3 + 3 + 4 + 7 = 25</span>

        <span class="hljs-comment"># 25-49: _prev_obs (25)</span>
        <span class="hljs-comment"># 50-52: goal_pos (3)</span>
        <span class="hljs-comment"># Total observation length = 53</span>
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">&quot;hand_pos&quot;</span>: obs[:<span class="hljs-number">3</span>],
            <span class="hljs-string">&quot;quat_hand&quot;</span>: obs[<span class="hljs-number">3</span>:<span class="hljs-number">7</span>],
            <span class="hljs-string">&quot;gripper_distance_apart&quot;</span>: obs[<span class="hljs-number">7</span>],
            <span class="hljs-string">&quot;pegHead_force&quot;</span>: obs[<span class="hljs-number">8</span>:<span class="hljs-number">11</span>],       
            <span class="hljs-string">&quot;peg_pos&quot;</span>: obs[<span class="hljs-number">11</span>:<span class="hljs-number">14</span>],            
            <span class="hljs-string">&quot;peg_rot&quot;</span>: obs[<span class="hljs-number">14</span>:<span class="hljs-number">18</span>],            
            <span class="hljs-string">&quot;unused_info_curr_obs&quot;</span>: obs[<span class="hljs-number">18</span>:<span class="hljs-number">25</span>],
            <span class="hljs-string">&quot;_prev_obs&quot;</span>: obs[<span class="hljs-number">25</span>:<span class="hljs-number">50</span>],          
            <span class="hljs-string">&quot;goal_pos&quot;</span>: obs[-<span class="hljs-number">3</span>:],             
        }

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_action</span>(<span class="hljs-params">self, obs: npt.NDArray[np.float64]</span>) -&gt; npt.NDArray[np.float32]:
        o_d = self._parse_obs(obs)

        <span class="hljs-comment"># Action is now 7 dimensions: [delta_pos_x, delta_pos_y, delta_pos_z, delta_rot_x, delta_rot_y, delta_rot_z, gripper_effort]</span>
        action = Action(<span class="hljs-number">7</span>)

        <span class="hljs-comment"># Calculate delta_pos</span>
        delta_pos = move(o_d[<span class="hljs-string">&quot;hand_pos&quot;</span>], to_xyz=self._desired_pos(o_d), p=<span class="hljs-number">25.0</span>)
        <span class="hljs-comment"># delta_pos = np.zeros(3) </span>
        <span class="hljs-comment"># For now, set delta_rot to zero. This can be expanded later if rotation control is needed.</span>
        delta_rot = np.zeros(<span class="hljs-number">3</span>) 
        <span class="hljs-comment"># delta_rot[0] = 0.05</span>
        <span class="hljs-comment"># Calculate gripper_effort</span>
        gripper_effort = self._grab_effort(o_d)

        <span class="hljs-comment"># Combine all parts into a 7-dimensional action array</span>
        full_action = np.hstack((delta_pos, delta_rot, gripper_effort))
        action.set_action(full_action)

        <span class="hljs-keyword">return</span> action.array.astype(np.float32)

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_desired_pos</span>(<span class="hljs-params">o_d: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, npt.NDArray[np.float64]]</span>) -&gt; npt.NDArray[<span class="hljs-type">Any</span>]:
        pos_curr = o_d[<span class="hljs-string">&quot;hand_pos&quot;</span>]
        pos_peg = o_d[<span class="hljs-string">&quot;peg_pos&quot;</span>]
        <span class="hljs-comment"># lowest X is -.35, doesn&#x27;t matter if we overshoot</span>
        <span class="hljs-comment"># Y is given by hole_vec</span>
        <span class="hljs-comment"># Z is constant at .16</span>
        pos_hole = np.array([-<span class="hljs-number">0.35</span>, o_d[<span class="hljs-string">&quot;goal_pos&quot;</span>][<span class="hljs-number">1</span>], <span class="hljs-number">0.16</span>])

        <span class="hljs-keyword">if</span> np.linalg.norm(pos_curr[:<span class="hljs-number">2</span>] - pos_peg[:<span class="hljs-number">2</span>]) &gt; <span class="hljs-number">0.04</span>:
            <span class="hljs-keyword">return</span> pos_peg + np.array([<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.3</span>])
        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">abs</span>(pos_curr[<span class="hljs-number">2</span>] - pos_peg[<span class="hljs-number">2</span>]) &gt; <span class="hljs-number">0.025</span>:
            <span class="hljs-keyword">return</span> pos_peg
        <span class="hljs-keyword">elif</span> np.linalg.norm(pos_peg[<span class="hljs-number">1</span>:] - pos_hole[<span class="hljs-number">1</span>:]) &gt; <span class="hljs-number">0.03</span>:
            <span class="hljs-keyword">return</span> pos_hole + np.array([<span class="hljs-number">0.4</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>])
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> pos_hole - np.array([<span class="hljs-number">0.8</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>])

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_grab_effort</span>(<span class="hljs-params">o_d: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, npt.NDArray[np.float64]]</span>) -&gt; <span class="hljs-built_in">float</span>:
        pos_curr = o_d[<span class="hljs-string">&quot;hand_pos&quot;</span>]
        pos_peg = o_d[<span class="hljs-string">&quot;peg_pos&quot;</span>]

        <span class="hljs-keyword">if</span> (
            np.linalg.norm(pos_curr[:<span class="hljs-number">2</span>] - pos_peg[:<span class="hljs-number">2</span>]) &gt; <span class="hljs-number">0.04</span>
            <span class="hljs-keyword">or</span> <span class="hljs-built_in">abs</span>(pos_curr[<span class="hljs-number">2</span>] - pos_peg[<span class="hljs-number">2</span>]) &gt; <span class="hljs-number">0.15</span>
        ):
            <span class="hljs-keyword">return</span> -<span class="hljs-number">1.0</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-number">0.6</span>
</code></pre>
<h3 id="ppo_testutilsreward_utilspy">ppo_test/utils/reward_utils.py</h3>
<p><em>大小: 8.2 KB | Token: 2.3K</em></p>
<pre><code class="language-python"><span class="hljs-string">&quot;&quot;&quot;A set of reward utilities written by the authors of dm_control.&quot;&quot;&quot;</span>
<span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> annotations

<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Any</span>, <span class="hljs-type">Literal</span>, TypeVar

<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> numpy.typing <span class="hljs-keyword">as</span> npt

<span class="hljs-comment"># The value returned by tolerance() at `margin` distance from `bounds` interval.</span>
_DEFAULT_VALUE_AT_MARGIN = <span class="hljs-number">0.1</span>


SIGMOID_TYPE = <span class="hljs-type">Literal</span>[
    <span class="hljs-string">&quot;gaussian&quot;</span>,
    <span class="hljs-string">&quot;hyperbolic&quot;</span>,
    <span class="hljs-string">&quot;long_tail&quot;</span>,
    <span class="hljs-string">&quot;reciprocal&quot;</span>,
    <span class="hljs-string">&quot;cosine&quot;</span>,
    <span class="hljs-string">&quot;linear&quot;</span>,
    <span class="hljs-string">&quot;quadratic&quot;</span>,
    <span class="hljs-string">&quot;tanh_squared&quot;</span>,
]

X = TypeVar(<span class="hljs-string">&quot;X&quot;</span>, <span class="hljs-built_in">float</span>, npt.NDArray, np.floating)


<span class="hljs-keyword">def</span> <span class="hljs-title function_">_sigmoids</span>(<span class="hljs-params">x: X, value_at_1: <span class="hljs-built_in">float</span>, sigmoid: SIGMOID_TYPE</span>) -&gt; X:
    <span class="hljs-string">&quot;&quot;&quot;Maps the input to values between 0 and 1 using a specified sigmoid function. Returns 1 when the input is 0, between 0 and 1 otherwise.

    Args:
        x: The input.
        value_at_1: The output value when `x` == 1. Must be between 0 and 1.
        sigmoid: Choice of sigmoid type. Valid values are &#x27;gaussian&#x27;, &#x27;hyperbolic&#x27;,
        &#x27;long_tail&#x27;, &#x27;reciprocal&#x27;, &#x27;cosine&#x27;, &#x27;linear&#x27;, &#x27;quadratic&#x27;, &#x27;tanh_squared&#x27;.

    Returns:
        The input mapped to values between 0.0 and 1.0.

    Raises:
        ValueError: If not 0 &lt; `value_at_1` &lt; 1, except for `linear`, `cosine` and
        `quadratic` sigmoids which allow `value_at_1` == 0.
        ValueError: If `sigmoid` is of an unknown type.
    &quot;&quot;&quot;</span>
    <span class="hljs-keyword">if</span> sigmoid <span class="hljs-keyword">in</span> (<span class="hljs-string">&quot;cosine&quot;</span>, <span class="hljs-string">&quot;linear&quot;</span>, <span class="hljs-string">&quot;quadratic&quot;</span>):
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-number">0</span> &lt;= value_at_1 &lt; <span class="hljs-number">1</span>:
            <span class="hljs-keyword">raise</span> ValueError(
                <span class="hljs-string">f&quot;`value_at_1` must be nonnegative and smaller than 1, got <span class="hljs-subst">{value_at_1}</span>.&quot;</span>
            )
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-number">0</span> &lt; value_at_1 &lt; <span class="hljs-number">1</span>:
            <span class="hljs-keyword">raise</span> ValueError(
                <span class="hljs-string">f&quot;`value_at_1` must be strictly between 0 and 1, got <span class="hljs-subst">{value_at_1}</span>.&quot;</span>
            )

    <span class="hljs-keyword">if</span> sigmoid == <span class="hljs-string">&quot;gaussian&quot;</span>:
        scale = np.sqrt(-<span class="hljs-number">2</span> * np.log(value_at_1))
        <span class="hljs-keyword">return</span> np.exp(-<span class="hljs-number">0.5</span> * (x * scale) ** <span class="hljs-number">2</span>)

    <span class="hljs-keyword">elif</span> sigmoid == <span class="hljs-string">&quot;hyperbolic&quot;</span>:
        scale = np.arccosh(<span class="hljs-number">1</span> / value_at_1)
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> / np.cosh(x * scale)

    <span class="hljs-keyword">elif</span> sigmoid == <span class="hljs-string">&quot;long_tail&quot;</span>:
        scale = np.sqrt(<span class="hljs-number">1</span> / value_at_1 - <span class="hljs-number">1</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> / ((x * scale) ** <span class="hljs-number">2</span> + <span class="hljs-number">1</span>)

    <span class="hljs-keyword">elif</span> sigmoid == <span class="hljs-string">&quot;reciprocal&quot;</span>:
        scale = <span class="hljs-number">1</span> / value_at_1 - <span class="hljs-number">1</span>
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> / (<span class="hljs-built_in">abs</span>(x) * scale + <span class="hljs-number">1</span>)

    <span class="hljs-keyword">elif</span> sigmoid == <span class="hljs-string">&quot;cosine&quot;</span>:
        scale = np.arccos(<span class="hljs-number">2</span> * value_at_1 - <span class="hljs-number">1</span>) / np.pi
        scaled_x = x * scale
        ret = np.where(<span class="hljs-built_in">abs</span>(scaled_x) &lt; <span class="hljs-number">1</span>, (<span class="hljs-number">1</span> + np.cos(np.pi * scaled_x)) / <span class="hljs-number">2</span>, <span class="hljs-number">0.0</span>)
        <span class="hljs-keyword">return</span> ret.item() <span class="hljs-keyword">if</span> np.isscalar(x) <span class="hljs-keyword">else</span> ret

    <span class="hljs-keyword">elif</span> sigmoid == <span class="hljs-string">&quot;linear&quot;</span>:
        scale = <span class="hljs-number">1</span> - value_at_1
        scaled_x = x * scale
        ret = np.where(<span class="hljs-built_in">abs</span>(scaled_x) &lt; <span class="hljs-number">1</span>, <span class="hljs-number">1</span> - scaled_x, <span class="hljs-number">0.0</span>)
        <span class="hljs-keyword">return</span> ret.item() <span class="hljs-keyword">if</span> np.isscalar(x) <span class="hljs-keyword">else</span> ret

    <span class="hljs-keyword">elif</span> sigmoid == <span class="hljs-string">&quot;quadratic&quot;</span>:
        scale = np.sqrt(<span class="hljs-number">1</span> - value_at_1)
        scaled_x = x * scale
        ret = np.where(<span class="hljs-built_in">abs</span>(scaled_x) &lt; <span class="hljs-number">1</span>, <span class="hljs-number">1</span> - scaled_x**<span class="hljs-number">2</span>, <span class="hljs-number">0.0</span>)
        <span class="hljs-keyword">return</span> ret.item() <span class="hljs-keyword">if</span> np.isscalar(x) <span class="hljs-keyword">else</span> ret

    <span class="hljs-keyword">elif</span> sigmoid == <span class="hljs-string">&quot;tanh_squared&quot;</span>:
        scale = np.arctanh(np.sqrt(<span class="hljs-number">1</span> - value_at_1))
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> - np.tanh(x * scale) ** <span class="hljs-number">2</span>

    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f&quot;Unknown sigmoid type <span class="hljs-subst">{sigmoid!r}</span>.&quot;</span>)


<span class="hljs-keyword">def</span> <span class="hljs-title function_">tolerance</span>(<span class="hljs-params">
    x: X,
    bounds: <span class="hljs-built_in">tuple</span>[<span class="hljs-built_in">float</span>, <span class="hljs-built_in">float</span>] = (<span class="hljs-params"><span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span></span>),
    margin: <span class="hljs-built_in">float</span> | np.floating[<span class="hljs-type">Any</span>] = <span class="hljs-number">0.0</span>,
    sigmoid: SIGMOID_TYPE = <span class="hljs-string">&quot;gaussian&quot;</span>,
    value_at_margin: <span class="hljs-built_in">float</span> = _DEFAULT_VALUE_AT_MARGIN,
</span>) -&gt; X:
    <span class="hljs-string">&quot;&quot;&quot;Returns 1 when `x` falls inside the bounds, between 0 and 1 otherwise.

    Args:
        x: The input.
        bounds: A tuple of floats specifying inclusive `(lower, upper)` bounds for
        the target interval. These can be infinite if the interval is unbounded
        at one or both ends, or they can be equal to one another if the target
        value is exact.
        margin: Parameter that controls how steeply the output decreases as
        `x` moves out-of-bounds.
        * If `margin == 0` then the output will be 0 for all values of `x`
            outside of `bounds`.
        * If `margin &gt; 0` then the output will decrease sigmoidally with
            increasing distance from the nearest bound.
        sigmoid: Choice of sigmoid type. Valid values are &#x27;gaussian&#x27;, &#x27;hyperbolic&#x27;,
        &#x27;long_tail&#x27;, &#x27;reciprocal&#x27;, &#x27;cosine&#x27;, &#x27;linear&#x27;, &#x27;quadratic&#x27;, &#x27;tanh_squared&#x27;.
        value_at_margin: A value between 0 and 1 specifying the output when
        the distance from `x` to the nearest bound is equal to `margin`. Ignored
        if `margin == 0`.

    Returns:
        A float or numpy array with values between 0.0 and 1.0.

    Raises:
        ValueError: If `bounds[0] &gt; bounds[1]`.
        ValueError: If `margin` is negative.
    &quot;&quot;&quot;</span>
    lower, upper = bounds
    <span class="hljs-keyword">if</span> lower &gt; upper:
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;Lower bound must be &lt;= upper bound.&quot;</span>)
    <span class="hljs-keyword">if</span> margin &lt; <span class="hljs-number">0</span>:
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f&quot;`margin` must be non-negative. Current value: <span class="hljs-subst">{margin}</span>&quot;</span>)

    in_bounds = np.logical_and(lower &lt;= x, x &lt;= upper)
    <span class="hljs-keyword">if</span> margin == <span class="hljs-number">0</span>:
        value = np.where(in_bounds, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>)
    <span class="hljs-keyword">else</span>:
        d = np.where(x &lt; lower, lower - x, x - upper) / margin
        value = np.where(in_bounds, <span class="hljs-number">1.0</span>, _sigmoids(d, value_at_margin, sigmoid))

    <span class="hljs-keyword">return</span> value.item() <span class="hljs-keyword">if</span> np.isscalar(x) <span class="hljs-keyword">else</span> value


<span class="hljs-keyword">def</span> <span class="hljs-title function_">inverse_tolerance</span>(<span class="hljs-params">
    x: X,
    bounds: <span class="hljs-built_in">tuple</span>[<span class="hljs-built_in">float</span>, <span class="hljs-built_in">float</span>] = (<span class="hljs-params"><span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span></span>),
    margin: <span class="hljs-built_in">float</span> = <span class="hljs-number">0.0</span>,
    sigmoid: SIGMOID_TYPE = <span class="hljs-string">&quot;reciprocal&quot;</span>,
</span>) -&gt; X:
    <span class="hljs-string">&quot;&quot;&quot;Returns 0 when `x` falls inside the bounds, between 1 and 0 otherwise.

    Args:
        x: The input
        bounds: A tuple of floats specifying inclusive `(lower, upper)` bounds for
        the target interval. These can be infinite if the interval is unbounded
        at one or both ends, or they can be equal to one another if the target
        value is exact.
        margin: Parameter that controls how steeply the output decreases as
        `x` moves out-of-bounds.
        * If `margin == 0` then the output will be 0 for all values of `x`
            outside of `bounds`.
        * If `margin &gt; 0` then the output will decrease sigmoidally with
            increasing distance from the nearest bound.
        sigmoid: Choice of sigmoid type. Valid values are &#x27;gaussian&#x27;, &#x27;hyperbolic&#x27;,
        &#x27;long_tail&#x27;, &#x27;reciprocal&#x27;, &#x27;cosine&#x27;, &#x27;linear&#x27;, &#x27;quadratic&#x27;, &#x27;tanh_squared&#x27;.
        value_at_margin: A value between 0 and 1 specifying the output when
        the distance from `x` to the nearest bound is equal to `margin`. Ignored
        if `margin == 0`.

    Returns:
        A float or numpy array with values between 0.0 and 1.0.

    Raises:
        ValueError: If `bounds[0] &gt; bounds[1]`.
        ValueError: If `margin` is negative.
    &quot;&quot;&quot;</span>
    bound = tolerance(
        x, bounds=bounds, margin=margin, sigmoid=sigmoid, value_at_margin=<span class="hljs-number">0</span>
    )
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> - bound


<span class="hljs-keyword">def</span> <span class="hljs-title function_">rect_prism_tolerance</span>(<span class="hljs-params">
    curr: npt.NDArray[np.float_],
    zero: npt.NDArray[np.float_],
    one: npt.NDArray[np.float_],
</span>) -&gt; <span class="hljs-built_in">float</span>:
    <span class="hljs-string">&quot;&quot;&quot;Computes a reward if curr is inside a rectangular prism region.

    All inputs are 3D points with shape (3,).

    Args:
        curr: The point that the prism reward region is being applied for.
        zero: The diagonal opposite corner of the prism with reward 0.
        one: The corner of the prism with reward 1.

    Returns:
        A reward if curr is inside the prism, 1.0 otherwise.
    &quot;&quot;&quot;</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">in_range</span>(<span class="hljs-params">a, b, c</span>):
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">float</span>(b &lt;= a &lt;= c) <span class="hljs-keyword">if</span> c &gt;= b <span class="hljs-keyword">else</span> <span class="hljs-built_in">float</span>(c &lt;= a &lt;= b)

    in_prism = (
        in_range(curr[<span class="hljs-number">0</span>], zero[<span class="hljs-number">0</span>], one[<span class="hljs-number">0</span>])
        <span class="hljs-keyword">and</span> in_range(curr[<span class="hljs-number">1</span>], zero[<span class="hljs-number">1</span>], one[<span class="hljs-number">1</span>])
        <span class="hljs-keyword">and</span> in_range(curr[<span class="hljs-number">2</span>], zero[<span class="hljs-number">2</span>], one[<span class="hljs-number">2</span>])
    )
    <span class="hljs-keyword">if</span> in_prism:
        diff = one - zero
        x_scale = (curr[<span class="hljs-number">0</span>] - zero[<span class="hljs-number">0</span>]) / diff[<span class="hljs-number">0</span>]
        y_scale = (curr[<span class="hljs-number">1</span>] - zero[<span class="hljs-number">1</span>]) / diff[<span class="hljs-number">1</span>]
        z_scale = (curr[<span class="hljs-number">2</span>] - zero[<span class="hljs-number">2</span>]) / diff[<span class="hljs-number">2</span>]
        <span class="hljs-keyword">return</span> x_scale * y_scale * z_scale
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-number">1.0</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">hamacher_product</span>(<span class="hljs-params">a: <span class="hljs-built_in">float</span>, b: <span class="hljs-built_in">float</span></span>) -&gt; <span class="hljs-built_in">float</span>:
    <span class="hljs-string">&quot;&quot;&quot;Returns the hamacher (t-norm) product of a and b.

    Computes (a * b) / ((a + b) - (a * b)).

    Args:
        a: 1st term of the hamacher product.
        b: 2nd term of the hamacher product.

    Returns:
        The hammacher product of a and b

    Raises:
        ValueError: a and b must range between 0 and 1
    &quot;&quot;&quot;</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ((<span class="hljs-number">0.0</span> &lt;= a &lt;= <span class="hljs-number">1.0</span>) <span class="hljs-keyword">and</span> (<span class="hljs-number">0.0</span> &lt;= b &lt;= <span class="hljs-number">1.0</span>)):
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f&quot;a (<span class="hljs-subst">{b}</span>) and b (<span class="hljs-subst">{b}</span>) must range between 0 and 1&quot;</span>)

    denominator = a + b - (a * b)
    h_prod = ((a * b) / denominator) <span class="hljs-keyword">if</span> denominator &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>

    <span class="hljs-keyword">assert</span> <span class="hljs-number">0.0</span> &lt;= h_prod &lt;= <span class="hljs-number">1.0</span>
    <span class="hljs-keyword">return</span> h_prod
</code></pre>
<h3 id="ppo_testxmlbasic_scenexml">ppo_test/xml/basic_scene.xml</h3>
<p><em>大小: 3.1 KB | Token: 807</em></p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">mujocoinclude</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">timestep</span>=<span class="hljs-string">&#x27;0.0025&#x27;</span> <span class="hljs-attr">iterations</span>=<span class="hljs-string">&quot;150&quot;</span> <span class="hljs-attr">tolerance</span>=<span class="hljs-string">&quot;1e-10&quot;</span> <span class="hljs-attr">solver</span>=<span class="hljs-string">&quot;Newton&quot;</span> <span class="hljs-attr">jacobian</span>=<span class="hljs-string">&quot;dense&quot;</span> <span class="hljs-attr">cone</span>=<span class="hljs-string">&quot;elliptic&quot;</span>/&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">asset</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- night sky --&gt;</span>
        <span class="hljs-comment">&lt;!-- &lt;texture name=&quot;skybox&quot; type=&quot;skybox&quot; builtin=&quot;gradient&quot; rgb1=&quot;.08 .09 .10&quot; rgb2=&quot;0 0 0&quot;
               width=&quot;800&quot; height=&quot;800&quot; mark=&quot;random&quot; markrgb=&quot;.8 .8 .8&quot;/&gt; --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">texture</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;skybox&quot;</span> <span class="hljs-attr">builtin</span>=<span class="hljs-string">&quot;gradient&quot;</span> <span class="hljs-attr">rgb1</span>=<span class="hljs-string">&quot;.50 .495 .48&quot;</span> <span class="hljs-attr">rgb2</span>=<span class="hljs-string">&quot;.50 .495 .48&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;32&quot;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;32&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">texture</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;T_table&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;cube&quot;</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;./textures/wood2.png&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">texture</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;T_floor&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;2d&quot;</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;./textures/floor2.png&quot;</span>/&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">material</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;basic_floor&quot;</span> <span class="hljs-attr">texture</span>=<span class="hljs-string">&quot;T_floor&quot;</span> <span class="hljs-attr">texrepeat</span>=<span class="hljs-string">&quot;12 12&quot;</span> <span class="hljs-attr">shininess</span>=<span class="hljs-string">&quot;.3&quot;</span> <span class="hljs-attr">specular</span>=<span class="hljs-string">&quot;0.5&quot;</span>
                  <span class="hljs-attr">reflectance</span>=<span class="hljs-string">&quot;0.2&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">material</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;table_wood&quot;</span> <span class="hljs-attr">texture</span>=<span class="hljs-string">&quot;T_table&quot;</span> <span class="hljs-attr">shininess</span>=<span class="hljs-string">&quot;.3&quot;</span> <span class="hljs-attr">specular</span>=<span class="hljs-string">&quot;0.5&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">material</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;table_col&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.3 0.3 1.0 0.5&quot;</span> <span class="hljs-attr">shininess</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">specular</span>=<span class="hljs-string">&quot;0&quot;</span>/&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">mesh</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;./table/tablebody.stl&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;tablebody&quot;</span> <span class="hljs-attr">scale</span>=<span class="hljs-string">&quot;1 1 1&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mesh</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;./table/tabletop.stl&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;tabletop&quot;</span> <span class="hljs-attr">scale</span>=<span class="hljs-string">&quot;1 1 1&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">asset</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">asset</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">texture</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;T_wallmetal&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;cube&quot;</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;./textures/metal.png&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">material</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;wall_metal&quot;</span> <span class="hljs-attr">texture</span>=<span class="hljs-string">&quot;T_wallmetal&quot;</span> <span class="hljs-attr">shininess</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">reflectance</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">specular</span>=<span class="hljs-string">&quot;.5&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">asset</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">visual</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">map</span> <span class="hljs-attr">fogstart</span>=<span class="hljs-string">&quot;1.5&quot;</span> <span class="hljs-attr">fogend</span>=<span class="hljs-string">&quot;5&quot;</span> <span class="hljs-attr">force</span>=<span class="hljs-string">&quot;0.1&quot;</span> <span class="hljs-attr">znear</span>=<span class="hljs-string">&quot;0.01&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">quality</span> <span class="hljs-attr">shadowsize</span>=<span class="hljs-string">&quot;4096&quot;</span> <span class="hljs-attr">offsamples</span>=<span class="hljs-string">&quot;4&quot;</span>/&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">headlight</span> <span class="hljs-attr">ambient</span>=<span class="hljs-string">&quot;0.4 0.4 0.4&quot;</span>/&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-name">visual</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">worldbody</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">light</span> <span class="hljs-attr">castshadow</span>=<span class="hljs-string">&quot;false&quot;</span> <span class="hljs-attr">directional</span>=<span class="hljs-string">&#x27;true&#x27;</span> <span class="hljs-attr">diffuse</span>=<span class="hljs-string">&#x27;.3 .3 .3&#x27;</span> <span class="hljs-attr">specular</span>=<span class="hljs-string">&#x27;0.3 0.3 0.3&#x27;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&#x27;-1 -1 1&#x27;</span>
               <span class="hljs-attr">dir</span>=<span class="hljs-string">&#x27;1 1 -1&#x27;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">light</span> <span class="hljs-attr">directional</span>=<span class="hljs-string">&#x27;true&#x27;</span> <span class="hljs-attr">diffuse</span>=<span class="hljs-string">&#x27;.3 .3 .3&#x27;</span> <span class="hljs-attr">specular</span>=<span class="hljs-string">&#x27;0.3 0.3 0.3&#x27;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&#x27;1 -1 1&#x27;</span> <span class="hljs-attr">dir</span>=<span class="hljs-string">&#x27;-1 1 -1&#x27;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">light</span> <span class="hljs-attr">castshadow</span>=<span class="hljs-string">&quot;false&quot;</span> <span class="hljs-attr">directional</span>=<span class="hljs-string">&#x27;true&#x27;</span> <span class="hljs-attr">diffuse</span>=<span class="hljs-string">&#x27;.3 .3 .3&#x27;</span> <span class="hljs-attr">specular</span>=<span class="hljs-string">&#x27;0.3 0.3 0.3&#x27;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&#x27;0 1 1&#x27;</span>
               <span class="hljs-attr">dir</span>=<span class="hljs-string">&#x27;0 -1 -1&#x27;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;tablelink&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 .6 0&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">material</span>=<span class="hljs-string">&quot;table_wood&quot;</span> <span class="hljs-attr">group</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;box&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;.7 .4 .027&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 -.027&quot;</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;0&quot;</span>
                  <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;0&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">material</span>=<span class="hljs-string">&quot;table_wood&quot;</span> <span class="hljs-attr">group</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">mesh</span>=<span class="hljs-string">&quot;tablebody&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 -0.65&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;mesh&quot;</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;0&quot;</span>
                  <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;0&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">material</span>=<span class="hljs-string">&quot;table_col&quot;</span> <span class="hljs-attr">group</span>=<span class="hljs-string">&quot;4&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0.0 0.0 -0.46&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.7 0.4 0.46&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;box&quot;</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;1&quot;</span>
                  <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;0&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;RetainingWall&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0.0 0.6 0.06&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">material</span>=<span class="hljs-string">&quot;wall_metal&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;box&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;.7 .01 .06&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0. -0.39 0.&quot;</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">condim</span>=<span class="hljs-string">&quot;3&quot;</span>
                  <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;0&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">material</span>=<span class="hljs-string">&quot;wall_metal&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;box&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;.7 .01 .06&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0. 0.39 0.&quot;</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">condim</span>=<span class="hljs-string">&quot;3&quot;</span>
                  <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;0&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">material</span>=<span class="hljs-string">&quot;wall_metal&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;box&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;.01 .38 .06&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;-.69 0. 0.&quot;</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">condim</span>=<span class="hljs-string">&quot;3&quot;</span>
                  <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;0&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">material</span>=<span class="hljs-string">&quot;wall_metal&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;box&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;.01 .38 .06&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;.69 0. 0.&quot;</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">condim</span>=<span class="hljs-string">&quot;3&quot;</span>
                  <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;0&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;floor&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;4 4 .1&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 -.913&quot;</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;plane&quot;</span> <span class="hljs-attr">material</span>=<span class="hljs-string">&quot;basic_floor&quot;</span>
              <span class="hljs-attr">condim</span>=<span class="hljs-string">&quot;3&quot;</span>/&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-name">worldbody</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">mujocoinclude</span>&gt;</span>
</code></pre>
<h3 id="ppo_testxmlpeg_block_dependenciesxml">ppo_test/xml/peg_block_dependencies.xml</h3>
<p><em>大小: 1.2 KB | Token: 318</em></p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">mujocoinclude</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">compiler</span> <span class="hljs-attr">angle</span>=<span class="hljs-string">&quot;radian&quot;</span> <span class="hljs-attr">inertiafromgeom</span>=<span class="hljs-string">&quot;auto&quot;</span> <span class="hljs-attr">inertiagrouprange</span>=<span class="hljs-string">&quot;4 5&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">asset</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">texture</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;T_peg_block_wood&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;cube&quot;</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;./textures/wood1.png&quot;</span>/&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">material</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;peg_block_col&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.3 0.3 1.0 0.5&quot;</span> <span class="hljs-attr">shininess</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">specular</span>=<span class="hljs-string">&quot;0&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">material</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;peg_block_wood&quot;</span> <span class="hljs-attr">texture</span>=<span class="hljs-string">&quot;T_peg_block_wood&quot;</span> <span class="hljs-attr">shininess</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">reflectance</span>=<span class="hljs-string">&quot;.7&quot;</span> <span class="hljs-attr">specular</span>=<span class="hljs-string">&quot;.5&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">material</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;peg_block_red&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;.55 0 0 1&quot;</span> <span class="hljs-attr">shininess</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">reflectance</span>=<span class="hljs-string">&quot;.7&quot;</span> <span class="hljs-attr">specular</span>=<span class="hljs-string">&quot;.5&quot;</span>/&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-name">asset</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">default</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">default</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;peg_block_base&quot;</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">joint</span> <span class="hljs-attr">armature</span>=<span class="hljs-string">&quot;0.001&quot;</span> <span class="hljs-attr">damping</span>=<span class="hljs-string">&quot;2&quot;</span> <span class="hljs-attr">limited</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">group</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;mesh&quot;</span>/&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">position</span> <span class="hljs-attr">ctrllimited</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">ctrlrange</span>=<span class="hljs-string">&quot;0 1.57&quot;</span>/&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">default</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;peg_block_viz&quot;</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">condim</span>=<span class="hljs-string">&quot;4&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;mesh&quot;</span>/&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">default</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">default</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;peg_block_col&quot;</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">condim</span>=<span class="hljs-string">&quot;3&quot;</span> <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">group</span>=<span class="hljs-string">&quot;4&quot;</span> <span class="hljs-attr">material</span>=<span class="hljs-string">&quot;peg_block_col&quot;</span> <span class="hljs-attr">solimp</span>=<span class="hljs-string">&quot;0.99 0.99 0.01&quot;</span> <span class="hljs-attr">solref</span>=<span class="hljs-string">&quot;0.01 1&quot;</span>/&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">default</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">default</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">default</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">asset</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">mesh</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;./peg_block/block_inner.stl&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;block_inner&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mesh</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;./peg_block/block_outer.stl&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;block_outer&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">asset</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">mujocoinclude</span>&gt;</span>
</code></pre>
<h3 id="ppo_testxmlpeg_blockxml">ppo_test/xml/peg_block.xml</h3>
<p><em>大小: 1.3 KB | Token: 340</em></p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">mujocoinclude</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">childclass</span>=<span class="hljs-string">&quot;peg_block_base&quot;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">material</span>=<span class="hljs-string">&quot;peg_block_red&quot;</span> <span class="hljs-attr">mesh</span>=<span class="hljs-string">&quot;block_inner&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0.095&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">material</span>=<span class="hljs-string">&quot;peg_block_wood&quot;</span> <span class="hljs-attr">mesh</span>=<span class="hljs-string">&quot;block_outer&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0.1&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;peg_block_col&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0.195&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.09 0.1 0.005&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;box&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;1000&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;peg_block_col&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0.05&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.09 0.096 0.05&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;box&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;1000&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;peg_block_col&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;-0.06 0 0.13&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.03 0.096 0.03&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;box&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;1000&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;peg_block_col&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0.06 0 0.13&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.03 0.096 0.03&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;box&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;1000&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;peg_block_col&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0.175&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.09 0.096 0.015&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;box&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;1000&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;peg_block_col&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0.095 0 0.1&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.005 0.1 0.1&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;box&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;1000&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;peg_block_col&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;-0.095 0 0.1&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.005 0.1 0.1&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;box&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;1000&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">site</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hole&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 -.096 0.13&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.005&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0 0.8 0 1&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">site</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;bottom_right_corner_collision_box_1&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0.1 -0.11 0.01&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.0001&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">site</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;top_left_corner_collision_box_1&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;-0.1 -.15 0.096&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.0001&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">site</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;bottom_right_corner_collision_box_2&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0.1 -0.11 0.16&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.0001&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">site</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;top_left_corner_collision_box_2&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;-0.1 -.17 0.19&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.0001&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mujocoinclude</span>&gt;</span>
</code></pre>
<h3 id="ppo_testxmlpeg_insert_dependenciesxml">ppo_test/xml/peg_insert_dependencies.xml</h3>
<p><em>大小: 1006 B | Token: 252</em></p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">mujocoinclude</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">compiler</span> <span class="hljs-attr">angle</span>=<span class="hljs-string">&quot;radian&quot;</span> <span class="hljs-attr">inertiafromgeom</span>=<span class="hljs-string">&quot;auto&quot;</span> <span class="hljs-attr">inertiagrouprange</span>=<span class="hljs-string">&quot;4 5&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">asset</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">texture</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;T_peg_wood&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;cube&quot;</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;./textures/wood1.png&quot;</span>/&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">material</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;peg_col&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.3 0.3 1.0 0.5&quot;</span> <span class="hljs-attr">shininess</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">specular</span>=<span class="hljs-string">&quot;0&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">material</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;peg_green&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0 .5 0 1&quot;</span> <span class="hljs-attr">shininess</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">reflectance</span>=<span class="hljs-string">&quot;.7&quot;</span> <span class="hljs-attr">specular</span>=<span class="hljs-string">&quot;.5&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">material</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;peg_black&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;.15 .15 .15 1&quot;</span> <span class="hljs-attr">shininess</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">reflectance</span>=<span class="hljs-string">&quot;.7&quot;</span> <span class="hljs-attr">specular</span>=<span class="hljs-string">&quot;.5&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">material</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;peg_wood&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;.55 .55 .55 1&quot;</span> <span class="hljs-attr">texture</span>=<span class="hljs-string">&quot;T_peg_wood&quot;</span> <span class="hljs-attr">shininess</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">reflectance</span>=<span class="hljs-string">&quot;.7&quot;</span> <span class="hljs-attr">specular</span>=<span class="hljs-string">&quot;.5&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">asset</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">default</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">default</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;peg_base&quot;</span>&gt;</span>
          <span class="hljs-comment">&lt;!-- &lt;joint armature=&quot;0.001&quot; damping=&quot;2&quot;/&gt; --&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">group</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;mesh&quot;</span>/&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">default</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;peg_col&quot;</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">condim</span>=<span class="hljs-string">&quot;3&quot;</span> <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">group</span>=<span class="hljs-string">&quot;4&quot;</span> <span class="hljs-attr">material</span>=<span class="hljs-string">&quot;peg_col&quot;</span> <span class="hljs-attr">solimp</span>=<span class="hljs-string">&quot;0.99 0.99 0.01&quot;</span> <span class="hljs-attr">solref</span>=<span class="hljs-string">&quot;0.01 1&quot;</span>/&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">default</span>&gt;</span>

      <span class="hljs-tag">&lt;/<span class="hljs-name">default</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">default</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">mujocoinclude</span>&gt;</span>
</code></pre>
<h3 id="ppo_testxmlsawyer_peg_insertion_sidexml">ppo_test/xml/sawyer_peg_insertion_side.xml</h3>
<p><em>大小: 1.6 KB | Token: 415</em></p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">mujoco</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;./basic_scene.xml&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;./peg_block_dependencies.xml&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;./peg_insert_dependencies.xml&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;./xyz_base_dependencies.xml&quot;</span>/&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">worldbody</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;./xyz_base.xml&quot;</span>/&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;peg&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0.6 0.03&quot;</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">inertial</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">diaginertia</span>=<span class="hljs-string">&quot;0.001 0.001 0.001&quot;</span>/&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;peg&quot;</span> <span class="hljs-attr">euler</span>=<span class="hljs-string">&quot;0 1.57 0&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.015 0.015 0.12&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;box&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;.1&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.3 1 0.3 1&quot;</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">group</span>=<span class="hljs-string">&quot;1&quot;</span>/&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">joint</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;free&quot;</span> <span class="hljs-attr">limited</span>=<span class="hljs-string">&quot;false&quot;</span> <span class="hljs-attr">damping</span>=<span class="hljs-string">&quot;0.005&quot;</span>/&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">site</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;pegHead&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;-0.1 0 0&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.005&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.8 0 0 1&quot;</span>/&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;force_viz&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;cylinder&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.01 0.01&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;-0.1 0 0&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0 0 1 1&quot;</span> <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">group</span>=<span class="hljs-string">&quot;1&quot;</span>/&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">site</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;pegEnd&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0.1 0 0&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.005&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.8 0 0 1&quot;</span>/&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">site</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;pegGrasp&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;.03 .0 .01&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.005&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.8 0 0 1&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;box&quot;</span> <span class="hljs-attr">euler</span>=<span class="hljs-string">&quot;0 0 1.57&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;-0.3 0.6 0&quot;</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;./peg_block.xml&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">site</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;goal&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0.6 0.05&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.01&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.8 0 0 1&quot;</span>/&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-name">worldbody</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">actuator</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">position</span> <span class="hljs-attr">ctrllimited</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">ctrlrange</span>=<span class="hljs-string">&quot;-1 1&quot;</span> <span class="hljs-attr">joint</span>=<span class="hljs-string">&quot;r_close&quot;</span> <span class="hljs-attr">kp</span>=<span class="hljs-string">&quot;1000&quot;</span>  <span class="hljs-attr">user</span>=<span class="hljs-string">&quot;1&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">position</span> <span class="hljs-attr">ctrllimited</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">ctrlrange</span>=<span class="hljs-string">&quot;-1 1&quot;</span> <span class="hljs-attr">joint</span>=<span class="hljs-string">&quot;l_close&quot;</span> <span class="hljs-attr">kp</span>=<span class="hljs-string">&quot;1000&quot;</span>  <span class="hljs-attr">user</span>=<span class="hljs-string">&quot;1&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">actuator</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">visual</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">rgba</span> <span class="hljs-attr">force</span>=<span class="hljs-string">&quot;1 1 0 1&quot;</span>/&gt;</span> 
    <span class="hljs-tag">&lt;/<span class="hljs-name">visual</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">equality</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">weld</span> <span class="hljs-attr">body1</span>=<span class="hljs-string">&quot;mocap&quot;</span> <span class="hljs-attr">body2</span>=<span class="hljs-string">&quot;hand&quot;</span> <span class="hljs-attr">solref</span>=<span class="hljs-string">&quot;0.002 1&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">weld</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">equality</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">sensor</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">force</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;pegHead_force&quot;</span> <span class="hljs-attr">site</span>=<span class="hljs-string">&quot;pegHead&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">sensor</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">mujoco</span>&gt;</span>
</code></pre>
<h3 id="ppo_testxmlxyz_base_dependenciesxml">ppo_test/xml/xyz_base_dependencies.xml</h3>
<p><em>大小: 1.4 KB | Token: 366</em></p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">mujocoinclude</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">compiler</span> <span class="hljs-attr">angle</span>=<span class="hljs-string">&quot;radian&quot;</span> <span class="hljs-attr">inertiafromgeom</span>=<span class="hljs-string">&quot;auto&quot;</span> <span class="hljs-attr">inertiagrouprange</span>=<span class="hljs-string">&quot;4 5&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">asset</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">material</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;xyz_col&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.3 0.3 1.0 0.5&quot;</span> <span class="hljs-attr">shininess</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">specular</span>=<span class="hljs-string">&quot;0.5&quot;</span>/&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">mesh</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;./xyz_base/base.stl&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;base&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">mesh</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;./xyz_base/eGripperBase.stl&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;eGripperBase&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">mesh</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;./xyz_base/head.stl&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;head&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">mesh</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;./xyz_base/l0.stl&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;l0&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">mesh</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;./xyz_base/l1.stl&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;l1&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">mesh</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;./xyz_base/l2.stl&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;l2&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">mesh</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;./xyz_base/l3.stl&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;l3&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">mesh</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;./xyz_base/l4.stl&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;l4&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">mesh</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;./xyz_base/l5.stl&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;l5&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">mesh</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;./xyz_base/l6.stl&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;l6&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">mesh</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;./xyz_base/pedestal.stl&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;pedestal&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">asset</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">default</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">default</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;xyz_base&quot;</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">joint</span> <span class="hljs-attr">armature</span>=<span class="hljs-string">&quot;0.001&quot;</span> <span class="hljs-attr">damping</span>=<span class="hljs-string">&quot;2&quot;</span> <span class="hljs-attr">limited</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">group</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;mesh&quot;</span>/&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">position</span> <span class="hljs-attr">ctrllimited</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">ctrlrange</span>=<span class="hljs-string">&quot;0 1.57&quot;</span>/&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">default</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;base_viz&quot;</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">condim</span>=<span class="hljs-string">&quot;4&quot;</span> <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">group</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">margin</span>=<span class="hljs-string">&quot;0.001&quot;</span> <span class="hljs-attr">solimp</span>=<span class="hljs-string">&quot;.8 .9 .01&quot;</span> <span class="hljs-attr">solref</span>=<span class="hljs-string">&quot;.02 1&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;mesh&quot;</span>/&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">default</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">default</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;base_col&quot;</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">condim</span>=<span class="hljs-string">&quot;4&quot;</span> <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">group</span>=<span class="hljs-string">&quot;4&quot;</span> <span class="hljs-attr">margin</span>=<span class="hljs-string">&quot;0.001&quot;</span> <span class="hljs-attr">material</span>=<span class="hljs-string">&quot;xyz_col&quot;</span> <span class="hljs-attr">solimp</span>=<span class="hljs-string">&quot;.8 .9 .01&quot;</span> <span class="hljs-attr">solref</span>=<span class="hljs-string">&quot;.02 1&quot;</span>/&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">default</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">default</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">default</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">mujocoinclude</span>&gt;</span>
</code></pre>
<h3 id="ppo_testxmlxyz_basexml">ppo_test/xml/xyz_base.xml</h3>
<p><em>大小: 19.0 KB | Token: 5.3K</em></p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">mujocoinclude</span>&gt;</span>
  <span class="hljs-comment">&lt;!--
  Usage:

  &lt;mujoco&gt;
  	&lt;compiler meshdir=&quot;../meshes/sawyer&quot; ...&gt;&lt;/compiler&gt;
  	&lt;include file=&quot;shared_config.xml&quot;&gt;&lt;/include&gt;
      (new stuff)
  	&lt;worldbody&gt;
  		&lt;include file=&quot;sawyer_xyz_base.xml&quot;&gt;&lt;/include&gt;
          (new stuff)
  	&lt;/worldbody&gt;
  &lt;/mujoco&gt;
  --&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">camera</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0.5 1.5&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;topview&quot;</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">camera</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;corner&quot;</span> <span class="hljs-attr">mode</span>=<span class="hljs-string">&quot;fixed&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;-1.1 -0.4 0.6&quot;</span> <span class="hljs-attr">xyaxes</span>=<span class="hljs-string">&quot;-1 1 0 -0.2 -0.2 -1&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">camera</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;corner2&quot;</span> <span class="hljs-attr">fovy</span>=<span class="hljs-string">&quot;60&quot;</span> <span class="hljs-attr">mode</span>=<span class="hljs-string">&quot;fixed&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;1.3 -0.2 1.1&quot;</span> <span class="hljs-attr">euler</span>=<span class="hljs-string">&quot;3.9 2.3 0.6&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">camera</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;corner3&quot;</span> <span class="hljs-attr">fovy</span>=<span class="hljs-string">&quot;45&quot;</span> <span class="hljs-attr">mode</span>=<span class="hljs-string">&quot;fixed&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0.9 0 1.5&quot;</span> <span class="hljs-attr">euler</span>=<span class="hljs-string">&quot;3.5 2.7 1&quot;</span>/&gt;</span>
      <span class="hljs-comment">&lt;!--&lt;geom name=&quot;floor&quot; type=&quot;plane&quot; pos=&quot;0 0 -.9&quot; size=&quot;10 10 10&quot;--&gt;</span>
            <span class="hljs-comment">&lt;!--rgba=&quot;0 0 0 1&quot; contype=&quot;15&quot; conaffinity=&quot;15&quot; /&gt;--&gt;</span>
      <span class="hljs-comment">&lt;!--&lt;geom name=&quot;tableTop&quot; type=&quot;box&quot; pos=&quot;0 0.6 -0.45&quot; size=&quot;0.4 0.2 0.45&quot;
            rgba=&quot;.6 .6 .5 1&quot; contype=&quot;15&quot; conaffinity=&quot;15&quot; /&gt;--&gt;</span>
      <span class="hljs-comment">&lt;!-- &lt;geom name=&quot;tableTop&quot; type=&quot;plane&quot; pos=&quot;0 0.6 0&quot; size=&quot;0.4 0.4 0.5&quot; --&gt;</span>
            <span class="hljs-comment">&lt;!-- rgba=&quot;.6 .6 .5 1&quot; contype=&quot;1&quot; conaffinity=&quot;1&quot; friction=&quot;2 0.1 0.002&quot; material=&quot;light_wood_v3&quot;/&gt; --&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;base&quot;</span> <span class="hljs-attr">childclass</span>=<span class="hljs-string">&quot;xyz_base&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">site</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;basesite&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.01&quot;</span> /&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">inertial</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">diaginertia</span>=<span class="hljs-string">&quot;0 0 0&quot;</span> /&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;controller_box&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">inertial</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;-0.325 0 -0.38&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;46.64&quot;</span> <span class="hljs-attr">diaginertia</span>=<span class="hljs-string">&quot;1.71363 1.27988 0.809981&quot;</span> /&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.11 0.2 0.265&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;-0.325 0 -0.38&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;box&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.2 0.2 0.2 1&quot;</span>/&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;pedestal_feet&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">inertial</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;-0.1225 0 -0.758&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;167.09&quot;</span> <span class="hljs-attr">diaginertia</span>=<span class="hljs-string">&quot;8.16095 9.59375 15.0785&quot;</span> /&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.385 0.35 0.155&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;-0.1225 0 -0.758&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;box&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.2 0.2 0.2 1&quot;</span>
                    <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;0&quot;</span>
                    <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;0&quot;</span>
              /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;torso&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">inertial</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;0.0001&quot;</span> <span class="hljs-attr">diaginertia</span>=<span class="hljs-string">&quot;1e-08 1e-08 1e-08&quot;</span> /&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.05 0.05 0.05&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;box&quot;</span> <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">group</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.2 0.2 0.2 1&quot;</span> /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;pedestal&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">inertial</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0.659267 -0.259505 -0.260945 0.655692&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;60.864&quot;</span> <span class="hljs-attr">diaginertia</span>=<span class="hljs-string">&quot;6.0869 5.81635 4.20915&quot;</span> /&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0.26 0.345 -0.91488&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0.5 0.5 -0.5 -0.5&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;mesh&quot;</span> <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">group</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.2 0.2 0.2 1&quot;</span> <span class="hljs-attr">mesh</span>=<span class="hljs-string">&quot;pedestal&quot;</span> /&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.18 0.31&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;-0.02 0 -0.29&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;cylinder&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.2 0.2 0.2 0&quot;</span> /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;right_arm_base_link&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">inertial</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;-0.0006241 -2.8025e-05 0.065404&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;-0.209285 0.674441 0.227335 0.670558&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;2.0687&quot;</span> <span class="hljs-attr">diaginertia</span>=<span class="hljs-string">&quot;0.00740351 0.00681776 0.00672942&quot;</span> /&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;mesh&quot;</span> <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">group</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.5 0.1 0.1 1&quot;</span> <span class="hljs-attr">mesh</span>=<span class="hljs-string">&quot;base&quot;</span> /&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.08 0.12&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0.12&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;cylinder&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.5 0.1 0.1 0&quot;</span> /&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;right_l0&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0.08&quot;</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">inertial</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0.024366 0.010969 0.14363&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0.894823 0.00899958 -0.170275 0.412573&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;5.3213&quot;</span> <span class="hljs-attr">diaginertia</span>=<span class="hljs-string">&quot;0.0651588 0.0510944 0.0186218&quot;</span> /&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">joint</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;right_j0&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span> <span class="hljs-attr">axis</span>=<span class="hljs-string">&quot;0 0 1&quot;</span> <span class="hljs-attr">limited</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">range</span>=<span class="hljs-string">&quot;-3.0503 3.0503&quot;</span> <span class="hljs-attr">damping</span>=<span class="hljs-string">&quot;5&quot;</span>/&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;mesh&quot;</span> <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">group</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.5 0.1 0.1 1&quot;</span> <span class="hljs-attr">mesh</span>=<span class="hljs-string">&quot;l0&quot;</span> /&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;head&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0.2965&quot;</span>&gt;</span>
                      <span class="hljs-tag">&lt;<span class="hljs-name">inertial</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0.0053207 -2.6549e-05 0.1021&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0.999993 7.08405e-05 -0.00359857 -0.000626247&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;1.5795&quot;</span> <span class="hljs-attr">diaginertia</span>=<span class="hljs-string">&quot;0.0118334 0.00827089 0.00496574&quot;</span> /&gt;</span>
                      <span class="hljs-comment">&lt;!-- &lt;joint name=&quot;head_pan&quot; pos=&quot;0 0 0&quot; axis=&quot;0 0 1&quot; limited=&quot;true&quot; range=&quot;-5.0952 0.9064&quot; damping=&quot;10&quot;/&gt; --&gt;</span>
                      <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;mesh&quot;</span> <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">group</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.5 0.1 0.1 1&quot;</span> <span class="hljs-attr">mesh</span>=<span class="hljs-string">&quot;head&quot;</span> /&gt;</span>
                      <span class="hljs-comment">&lt;!-- &lt;geom size=&quot;0.18&quot; pos=&quot;0 0 0.08&quot; rgba=&quot;0.5 0.1 0.1 0&quot; /&gt; --&gt;</span>
                      <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;screen&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0.03 0 0.105&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0.5 0.5 0.5 0.5&quot;</span>&gt;</span>
                          <span class="hljs-tag">&lt;<span class="hljs-name">inertial</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;0.0001&quot;</span> <span class="hljs-attr">diaginertia</span>=<span class="hljs-string">&quot;1e-08 1e-08 1e-08&quot;</span> /&gt;</span>
                          <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.12 0.07 0.001&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;box&quot;</span> <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">group</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.2 0.2 0.2 0&quot;</span> /&gt;</span>
                          <span class="hljs-comment">&lt;!-- &lt;geom size=&quot;0.001&quot; rgba=&quot;0.2 0.2 0.2 0&quot; /&gt; --&gt;</span>
                      <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
                      <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;head_camera&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0.0228027 0 0.216572&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0.342813 -0.618449 0.618449 -0.342813&quot;</span>&gt;</span>
                          <span class="hljs-tag">&lt;<span class="hljs-name">inertial</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0.0228027 0 0.216572&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0.342813 -0.618449 0.618449 -0.342813&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">diaginertia</span>=<span class="hljs-string">&quot;0 0 0&quot;</span> /&gt;</span>
                          <span class="hljs-tag">&lt;<span class="hljs-name">site</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;headsite&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.01&quot;</span> /&gt;</span>
                      <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
                  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;right_torso_itb&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;-0.055 0 0.22&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0.707107 0 -0.707107 0&quot;</span>&gt;</span>
                      <span class="hljs-tag">&lt;<span class="hljs-name">inertial</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;0.0001&quot;</span> <span class="hljs-attr">diaginertia</span>=<span class="hljs-string">&quot;1e-08 1e-08 1e-08&quot;</span> /&gt;</span>
                  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;right_l1&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0.081 0.05 0.237&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0.5 -0.5 0.5 0.5&quot;</span>&gt;</span>
                      <span class="hljs-tag">&lt;<span class="hljs-name">inertial</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;-0.0030849 -0.026811 0.092521&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0.424888 0.891987 0.132364 -0.0794296&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;4.505&quot;</span> <span class="hljs-attr">diaginertia</span>=<span class="hljs-string">&quot;0.0224339 0.0221624 0.0097097&quot;</span> /&gt;</span>
                      <span class="hljs-comment">&lt;!--&lt;joint name=&quot;right_j1&quot; pos=&quot;0 0 0&quot; axis=&quot;0 0 1&quot; limited=&quot;true&quot; range=&quot;-3.8095 2.2736&quot; damping=&quot;10&quot;/&gt;--&gt;</span>
                      <span class="hljs-tag">&lt;<span class="hljs-name">joint</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;right_j1&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span> <span class="hljs-attr">axis</span>=<span class="hljs-string">&quot;0 0 1&quot;</span>
                             <span class="hljs-attr">limited</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">range</span>=<span class="hljs-string">&quot;-3.8 -0.5&quot;</span>
                             <span class="hljs-attr">damping</span>=<span class="hljs-string">&quot;10&quot;</span>/&gt;</span>
                      <span class="hljs-comment">&lt;!--&lt;joint name=&quot;right_j1&quot; pos=&quot;0 0 0&quot; axis=&quot;0 0 1&quot; limited=&quot;true&quot; range=&quot;0.8095 2.2736&quot; damping=&quot;10&quot;/&gt;--&gt;</span>
                      <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;mesh&quot;</span> <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">group</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.5 0.1 0.1 1&quot;</span> <span class="hljs-attr">mesh</span>=<span class="hljs-string">&quot;l1&quot;</span> /&gt;</span>
                      <span class="hljs-comment">&lt;!-- &lt;geom size=&quot;0.07&quot; pos=&quot;0 0 0.1225&quot; rgba=&quot;0.5 0.1 0.1 0&quot; /&gt; --&gt;</span>
                      <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;right_l2&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 -0.14 0.1425&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0.707107 0.707107 0 0&quot;</span>&gt;</span>
                          <span class="hljs-tag">&lt;<span class="hljs-name">inertial</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;-0.00016044 -0.014967 0.13582&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0.707831 -0.0524761 0.0516007 0.702537&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;1.745&quot;</span> <span class="hljs-attr">diaginertia</span>=<span class="hljs-string">&quot;0.0257928 0.025506 0.00292515&quot;</span> /&gt;</span>
                          <span class="hljs-tag">&lt;<span class="hljs-name">joint</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;right_j2&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span> <span class="hljs-attr">axis</span>=<span class="hljs-string">&quot;0 0 1&quot;</span> <span class="hljs-attr">limited</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">range</span>=<span class="hljs-string">&quot;-3.0426 3.0426&quot;</span> <span class="hljs-attr">damping</span>=<span class="hljs-string">&quot;5&quot;</span>/&gt;</span>
                          <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;mesh&quot;</span> <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">group</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.5 0.1 0.1 1&quot;</span> <span class="hljs-attr">mesh</span>=<span class="hljs-string">&quot;l2&quot;</span> /&gt;</span>
                          <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.06 0.17&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0.08&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;cylinder&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.5 0.1 0.1 0&quot;</span> /&gt;</span>
                          <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;right_l3&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 -0.042 0.26&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0.707107 -0.707107 0 0&quot;</span>&gt;</span>
                              <span class="hljs-tag">&lt;<span class="hljs-name">site</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;armsite&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.01&quot;</span> /&gt;</span>
                              <span class="hljs-tag">&lt;<span class="hljs-name">inertial</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;-0.0048135 -0.0281 -0.084154&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0.902999 0.385391 -0.0880901 0.168247&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;2.5097&quot;</span> <span class="hljs-attr">diaginertia</span>=<span class="hljs-string">&quot;0.0102404 0.0096997 0.00369622&quot;</span> /&gt;</span>
                              <span class="hljs-tag">&lt;<span class="hljs-name">joint</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;right_j3&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span> <span class="hljs-attr">axis</span>=<span class="hljs-string">&quot;0 0 1&quot;</span> <span class="hljs-attr">limited</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">range</span>=<span class="hljs-string">&quot;-3.0439 3.0439&quot;</span> <span class="hljs-attr">damping</span>=<span class="hljs-string">&quot;5&quot;</span>/&gt;</span>
                              <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;mesh&quot;</span> <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">group</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.5 0.1 0.1 1&quot;</span> <span class="hljs-attr">mesh</span>=<span class="hljs-string">&quot;l3&quot;</span> /&gt;</span>
                              <span class="hljs-comment">&lt;!-- &lt;geom size=&quot;0.06&quot; pos=&quot;0 -0.01 -0.12&quot; rgba=&quot;0.5 0.1 0.1 0&quot; /&gt; --&gt;</span>
                              <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;right_l4&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 -0.125 -0.1265&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0.707107 0.707107 0 0&quot;</span>&gt;</span>
                                  <span class="hljs-tag">&lt;<span class="hljs-name">inertial</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;-0.0018844 0.0069001 0.1341&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0.803612 0.031257 -0.0298334 0.593582&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;1.1136&quot;</span> <span class="hljs-attr">diaginertia</span>=<span class="hljs-string">&quot;0.0136549 0.0135493 0.00127353&quot;</span> /&gt;</span>
                                  <span class="hljs-tag">&lt;<span class="hljs-name">joint</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;right_j4&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span> <span class="hljs-attr">axis</span>=<span class="hljs-string">&quot;0 0 1&quot;</span> <span class="hljs-attr">limited</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">range</span>=<span class="hljs-string">&quot;-2.9761 2.9761&quot;</span> <span class="hljs-attr">damping</span>=<span class="hljs-string">&quot;5&quot;</span> /&gt;</span>
                                  <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;mesh&quot;</span> <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">group</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.5 0.1 0.1 1&quot;</span> <span class="hljs-attr">mesh</span>=<span class="hljs-string">&quot;l4&quot;</span> /&gt;</span>
                                  <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.045 0.15&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0.11&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;cylinder&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.5 0.1 0.1 0&quot;</span> /&gt;</span>
                                  <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;right_arm_itb&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;-0.055 0 0.075&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0.707107 0 -0.707107 0&quot;</span>&gt;</span>
                                      <span class="hljs-tag">&lt;<span class="hljs-name">inertial</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;0.0001&quot;</span> <span class="hljs-attr">diaginertia</span>=<span class="hljs-string">&quot;1e-08 1e-08 1e-08&quot;</span> /&gt;</span>
                                  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
                                  <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;right_l5&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0.031 0.275&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0.707107 -0.707107 0 0&quot;</span>&gt;</span>
                                      <span class="hljs-tag">&lt;<span class="hljs-name">inertial</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0.0061133 -0.023697 0.076416&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0.404076 0.9135 0.0473125 0.00158335&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;1.5625&quot;</span> <span class="hljs-attr">diaginertia</span>=<span class="hljs-string">&quot;0.00474131 0.00422857 0.00190672&quot;</span> /&gt;</span>
                                      <span class="hljs-tag">&lt;<span class="hljs-name">joint</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;right_j5&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span> <span class="hljs-attr">axis</span>=<span class="hljs-string">&quot;0 0 1&quot;</span> <span class="hljs-attr">limited</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">range</span>=<span class="hljs-string">&quot;-2.9761 2.9761&quot;</span> <span class="hljs-attr">damping</span>=<span class="hljs-string">&quot;5&quot;</span>/&gt;</span>
                                      <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;mesh&quot;</span> <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">group</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.5 0.1 0.1 1&quot;</span> <span class="hljs-attr">mesh</span>=<span class="hljs-string">&quot;l5&quot;</span> /&gt;</span>
                                      <span class="hljs-comment">&lt;!-- &lt;geom size=&quot;0.06&quot; pos=&quot;0 0 0.1&quot; rgba=&quot;0.5 0.1 0.1 0&quot; /&gt; --&gt;</span>
                                      <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;right_hand_camera&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0.039552 -0.033 0.0695&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0.707107 0 0.707107 0&quot;</span>&gt;</span>
                                          <span class="hljs-tag">&lt;<span class="hljs-name">inertial</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0.039552 -0.033 0.0695&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0.707107 0 0.707107 0&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">diaginertia</span>=<span class="hljs-string">&quot;0 0 0&quot;</span> /&gt;</span>
                                      <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
                                      <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;right_wrist&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0.10541&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0.707107 0.707107 0 0&quot;</span>&gt;</span>
                                          <span class="hljs-tag">&lt;<span class="hljs-name">inertial</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0.10541&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0.707107 0.707107 0 0&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">diaginertia</span>=<span class="hljs-string">&quot;0 0 0&quot;</span> /&gt;</span>
                                      <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
                                      <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;right_l6&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 -0.11 0.1053&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0.0616248 0.06163 -0.704416 0.704416&quot;</span>&gt;</span>
                                          <span class="hljs-tag">&lt;<span class="hljs-name">inertial</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;-8.0726e-06 0.0085838 -0.0049566&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0.479044 0.515636 -0.513069 0.491322&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;0.3292&quot;</span> <span class="hljs-attr">diaginertia</span>=<span class="hljs-string">&quot;0.000360258 0.000311068 0.000214974&quot;</span> /&gt;</span>
                                          <span class="hljs-tag">&lt;<span class="hljs-name">joint</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;right_j6&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span> <span class="hljs-attr">axis</span>=<span class="hljs-string">&quot;0 0 1&quot;</span> <span class="hljs-attr">limited</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">range</span>=<span class="hljs-string">&quot;-4.7124 4.7124&quot;</span> <span class="hljs-attr">damping</span>=<span class="hljs-string">&quot;5&quot;</span>/&gt;</span>
                                          <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;mesh&quot;</span> <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;4&quot;</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;2&quot;</span> <span class="hljs-attr">group</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.5 0.1 0.1 1&quot;</span> <span class="hljs-attr">mesh</span>=<span class="hljs-string">&quot;l6&quot;</span> /&gt;</span>
                                          <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.055 0.025&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0.015 -0.01&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;cylinder&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.5 0.1 0.1 0&quot;</span> /&gt;</span>
                                          <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;right_hand&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0.0245&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0.707107 0 0 0.707107&quot;</span>&gt;</span>
                                              <span class="hljs-tag">&lt;<span class="hljs-name">inertial</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;1e-08 1e-08 1e-08&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0.820473 0.339851 -0.17592 0.424708&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;1e-08&quot;</span> <span class="hljs-attr">diaginertia</span>=<span class="hljs-string">&quot;1e-08 1e-08 1e-08&quot;</span> /&gt;</span>
                                              <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;mesh&quot;</span> <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">group</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.5 0.1 0.1 1&quot;</span> <span class="hljs-attr">pos</span>= <span class="hljs-string">&quot;0 0 0.03&quot;</span> <span class="hljs-attr">mesh</span>=<span class="hljs-string">&quot;eGripperBase&quot;</span> /&gt;</span>

                                              <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.035 0.014&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0.015&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;cylinder&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0 0 0 1&quot;</span>/&gt;</span>
                                              <span class="hljs-comment">&lt;!-- &lt;geom size=&quot;0.035 0.015&quot; pos=&quot;0 0 0.02&quot; type=&quot;cylinder&quot; rgba=&quot;0.2 0.2 0.2 0&quot;/&gt; --&gt;</span>

  <span class="hljs-comment">&lt;!--  ================= BEGIN GRIPPER ================= /--&gt;</span>
                                              <span class="hljs-comment">&lt;!-- &lt;body name=&quot;hand&quot; pos=&quot;0 0 0&quot;
                                                    quat=&quot;-1 0 1 0&quot;&gt;
                                                  &lt;geom class=&quot;1&quot; name=&quot;Geomclaw&quot; type=&quot;box&quot; size=&quot;0.01 0.04 0.01&quot;/&gt;
                                                      &lt;body name=&quot;rightclaw&quot; pos=&quot;.03 -.03 0.0&quot; &gt;
                                                          &lt;inertial diaginertia=&quot;0.1 0.1 0.1&quot; mass=&quot;4&quot; pos=&quot;-0.01 0 0&quot;&gt;&lt;/inertial&gt;
                                                          &lt;geom
                                                                  name=&quot;rightclaw_it&quot; condim=&quot;4&quot; contype=&quot;2&quot; conaffinity=&quot;2&quot; class=&quot;1&quot; mass=&quot;0.08&quot; type=&quot;box&quot; pos=&quot;0 0 0&quot; size=&quot;0.025 0.005 0.02&quot; rgba=&quot;0.0 1.0 0.0 1.0&quot; friction=&quot;1 0.05 0.01&quot;
                                                                  euler=&quot;0 0 0.2&quot;
                                                          /&gt;
                                                          &lt;joint name=&quot;rc_close&quot; type=&quot;slide&quot; pos=&quot;0 0 0&quot; axis=&quot;0 1 0&quot; range=&quot;0 .04&quot; user=&quot;008&quot; limited=&quot;true&quot;/&gt;
                                                          &lt;site name=&quot;endeffector2&quot; pos=&quot;.015 .01 0&quot; size=&quot;0.008&quot; rgba=&quot;0.0 0.0 0.0 0.0&quot; /&gt;
                                                      &lt;/body&gt;
                                                      &lt;body name=&quot;leftclaw&quot; pos=&quot;.03 .03 0&quot;&gt;
                                                          &lt;inertial diaginertia=&quot;0.1 0.1 0.1&quot; mass=&quot;4&quot; pos=&quot;-0.01 0 0&quot;&gt;&lt;/inertial&gt;
                                                          &lt;geom
                                                                  name=&quot;leftclaw_it&quot; condim=&quot;4&quot; contype=&quot;2&quot; conaffinity=&quot;2&quot; class=&quot;1&quot; type=&quot;box&quot; mass=&quot;0.08&quot; pos=&quot;0 0 0&quot; size=&quot;0.025 0.005 0.02&quot; rgba=&quot;0.0 1.0 0.0 1.0&quot; friction=&quot;1 0.05 0.01&quot;
                                                                  euler=&quot;0 0 -0.2&quot;
                                                          /&gt;
                                                          &lt;joint name=&quot;lc_close&quot; type=&quot;slide&quot; pos=&quot;0 0 0&quot; axis=&quot;0 -1 0&quot; range=&quot;-.04 0&quot; user=&quot;008&quot; limited=&quot;true&quot;/&gt;
                                                          &lt;site name=&quot;endeffector&quot; pos=&quot;.015 -.01 0&quot; size=&quot;0.008&quot; rgba=&quot;0.0 0.0 0.0 0.0&quot;  /&gt;
                                                      &lt;/body&gt;
                                              &lt;/body&gt; --&gt;</span>
                                              <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hand&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0.12&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;-1 0 1 0&quot;</span>&gt;</span>
                                                  <span class="hljs-tag">&lt;<span class="hljs-name">camera</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;behindGripper&quot;</span> <span class="hljs-attr">mode</span>=<span class="hljs-string">&quot;track&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 -0.5&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0 1 0 0&quot;</span> <span class="hljs-attr">fovy</span>=<span class="hljs-string">&quot;60&quot;</span> /&gt;</span>
                                                  <span class="hljs-tag">&lt;<span class="hljs-name">camera</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;gripperPOV&quot;</span> <span class="hljs-attr">mode</span>=<span class="hljs-string">&quot;track&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0.04 -0.06 0&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;-1 -1.3 0 0&quot;</span> <span class="hljs-attr">fovy</span>=<span class="hljs-string">&quot;90&quot;</span> /&gt;</span>

                                                  <span class="hljs-tag">&lt;<span class="hljs-name">site</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;endEffector&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0.04 0 0&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.01&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&#x27;1 1 1 0&#x27;</span> /&gt;</span>
                                                  <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;rail&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;box&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;-0.05 0 0&quot;</span> <span class="hljs-attr">density</span>=<span class="hljs-string">&quot;7850&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.005 0.055 0.005&quot;</span>  <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.5 0.5 0.5 1.0&quot;</span> <span class="hljs-attr">condim</span>=<span class="hljs-string">&quot;3&quot;</span> <span class="hljs-attr">friction</span>=<span class="hljs-string">&quot;2 0.1 0.002&quot;</span>   /&gt;</span>

                                                  <span class="hljs-comment">&lt;!--IMPORTANT: For rougher contact with gripper, set higher friciton values for the other interacting objects --&gt;</span>
                                                  <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;rightclaw&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 -0.05 0&quot;</span> &gt;</span>

                                                      <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;base_col&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;rightclaw_it&quot;</span> <span class="hljs-attr">condim</span>=<span class="hljs-string">&quot;4&quot;</span> <span class="hljs-attr">margin</span>=<span class="hljs-string">&quot;0.001&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;box&quot;</span> <span class="hljs-attr">user</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.045 0.003 0.015&quot;</span>  <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;1 1 1 1.0&quot;</span>   /&gt;</span>

                                                      <span class="hljs-tag">&lt;<span class="hljs-name">joint</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;r_close&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span> <span class="hljs-attr">axis</span>=<span class="hljs-string">&quot;0 1 0&quot;</span> <span class="hljs-attr">range</span>= <span class="hljs-string">&quot;0 0.04&quot;</span> <span class="hljs-attr">armature</span>=<span class="hljs-string">&quot;100&quot;</span> <span class="hljs-attr">damping</span>=<span class="hljs-string">&quot;1000&quot;</span> <span class="hljs-attr">limited</span>=<span class="hljs-string">&quot;true&quot;</span>  <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;slide&quot;</span>/&gt;</span>

                                                      <span class="hljs-comment">&lt;!-- &lt;site name=&quot;rightEndEffector&quot; pos=&quot;0.0 0.005 0&quot; size=&quot;0.044 0.008 0.012&quot; type=&#x27;box&#x27; /&gt; --&gt;</span>
                                                      <span class="hljs-comment">&lt;!-- &lt;site name=&quot;rightEndEffector&quot; pos=&quot;0.035 0 0&quot; size=&quot;0.01&quot; rgba=&quot;1.0 0.0 0.0 1.0&quot;/&gt; --&gt;</span>
                                                      <span class="hljs-tag">&lt;<span class="hljs-name">site</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;rightEndEffector&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0.045 0 0&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.01&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;1.0 0.0 0.0 1.0&quot;</span>/&gt;</span>
                                                      <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;rightpad&quot;</span> <span class="hljs-attr">pos</span> =<span class="hljs-string">&quot;0 .003 0&quot;</span> &gt;</span>
                                                          <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;rightpad_geom&quot;</span> <span class="hljs-attr">condim</span>=<span class="hljs-string">&quot;4&quot;</span> <span class="hljs-attr">margin</span>=<span class="hljs-string">&quot;0.001&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;box&quot;</span> <span class="hljs-attr">user</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.045 0.003 0.015&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;1 1 1 1.0&quot;</span> <span class="hljs-attr">solimp</span>=<span class="hljs-string">&quot;0.95 0.99 0.01&quot;</span> <span class="hljs-attr">solref</span>=<span class="hljs-string">&quot;0.01 1&quot;</span> <span class="hljs-attr">friction</span>=<span class="hljs-string">&quot;2 0.1 0.002&quot;</span> <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;1&quot;</span>/&gt;</span>
                                                      <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

                                                  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

                                                  <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;leftclaw&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0.05 0&quot;</span>&gt;</span>
                                                      <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;base_col&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;leftclaw_it&quot;</span> <span class="hljs-attr">condim</span>=<span class="hljs-string">&quot;4&quot;</span> <span class="hljs-attr">margin</span>=<span class="hljs-string">&quot;0.001&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;box&quot;</span> <span class="hljs-attr">user</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.045 0.003 0.015&quot;</span>  <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0 1 1 1.0&quot;</span>  /&gt;</span>
                                                      <span class="hljs-tag">&lt;<span class="hljs-name">joint</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;l_close&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span> <span class="hljs-attr">axis</span>=<span class="hljs-string">&quot;0 1 0&quot;</span> <span class="hljs-attr">range</span>= <span class="hljs-string">&quot;-0.03 0&quot;</span> <span class="hljs-attr">armature</span>=<span class="hljs-string">&quot;100&quot;</span> <span class="hljs-attr">damping</span>=<span class="hljs-string">&quot;1000&quot;</span> <span class="hljs-attr">limited</span>=<span class="hljs-string">&quot;true&quot;</span>  <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;slide&quot;</span>/&gt;</span>
                                                      <span class="hljs-comment">&lt;!-- &lt;site name=&quot;leftEndEffector&quot; pos=&quot;0.0 -0.005 0&quot; size=&quot;0.044 0.008 0.012&quot; type=&#x27;box&#x27; /&gt; --&gt;</span>
                                                      <span class="hljs-comment">&lt;!-- &lt;site name=&quot;leftEndEffector&quot; pos=&quot;0.035 0 0&quot; size=&quot;0.01&quot; rgba=&quot;1.0 0.0 0.0 1.0&quot;/&gt; --&gt;</span>
                                                      <span class="hljs-tag">&lt;<span class="hljs-name">site</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;leftEndEffector&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0.045 0 0&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.01&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;1.0 0.0 0.0 1.0&quot;</span>/&gt;</span>
                                                      <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;leftpad&quot;</span> <span class="hljs-attr">pos</span> =<span class="hljs-string">&quot;0 -.003 0&quot;</span> &gt;</span>
                                                          <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;leftpad_geom&quot;</span> <span class="hljs-attr">condim</span>=<span class="hljs-string">&quot;4&quot;</span> <span class="hljs-attr">margin</span>=<span class="hljs-string">&quot;0.001&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;box&quot;</span> <span class="hljs-attr">user</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.045 0.003 0.015&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0 1 1 1.0&quot;</span> <span class="hljs-attr">solimp</span>=<span class="hljs-string">&quot;0.95 0.99 0.01&quot;</span> <span class="hljs-attr">solref</span>=<span class="hljs-string">&quot;0.01 1&quot;</span> <span class="hljs-attr">friction</span>=<span class="hljs-string">&quot;2 0.1 0.002&quot;</span>  <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;1&quot;</span> /&gt;</span>
                                                      <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

                                                  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
                                              <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-comment">&lt;!--  ================= END GRIPPER ================= /--&gt;</span>
                                          <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
                                      <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
                                  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
                                  <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;right_l4_2&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span>&gt;</span>
                                      <span class="hljs-tag">&lt;<span class="hljs-name">inertial</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;1e-08 1e-08 1e-08&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0.820473 0.339851 -0.17592 0.424708&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;1e-08&quot;</span> <span class="hljs-attr">diaginertia</span>=<span class="hljs-string">&quot;1e-08 1e-08 1e-08&quot;</span> /&gt;</span>
                                      <span class="hljs-comment">&lt;!-- &lt;geom size=&quot;0.06&quot; pos=&quot;0 0.01 0.26&quot;
                                            rgba=&quot;0.2 0.2 0.2 0&quot;
                                            contype=&quot;0&quot;
                                            conaffinity=&quot;0&quot;
                                      /&gt; --&gt;</span>
                                  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
                              <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
                          <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
                          <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;right_l2_2&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span>&gt;</span>
                              <span class="hljs-tag">&lt;<span class="hljs-name">inertial</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;1e-08 1e-08 1e-08&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0.820473 0.339851 -0.17592 0.424708&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;1e-08&quot;</span> <span class="hljs-attr">diaginertia</span>=<span class="hljs-string">&quot;1e-08 1e-08 1e-08&quot;</span> /&gt;</span>
                              <span class="hljs-comment">&lt;!-- &lt;geom size=&quot;0.06&quot; pos=&quot;0 0 0.26&quot; rgba=&quot;0.2 0.2 0.2 0&quot;
                                    contype=&quot;0&quot;
                                    conaffinity=&quot;0&quot;
                              /&gt; --&gt;</span>
                          <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
                      <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
                      <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;right_l1_2&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span>&gt;</span>
                          <span class="hljs-tag">&lt;<span class="hljs-name">inertial</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;1e-08 1e-08 1e-08&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;0.820473 0.339851 -0.17592 0.424708&quot;</span> <span class="hljs-attr">mass</span>=<span class="hljs-string">&quot;1e-08&quot;</span> <span class="hljs-attr">diaginertia</span>=<span class="hljs-string">&quot;1e-08 1e-08 1e-08&quot;</span> /&gt;</span>
                          <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.07 0.07&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0.035&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;cylinder&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.2 0.2 0.2 0&quot;</span>/&gt;</span>
                      <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
                  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">mocap</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;mocap&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span> <span class="hljs-attr">quat</span>=<span class="hljs-string">&quot;1 0 0 0&quot;</span>&gt;</span>
          <span class="hljs-comment">&lt;!--For debugging, set the alpha to 1--&gt;</span>
          <span class="hljs-comment">&lt;!-- &lt;geom conaffinity=&quot;0&quot; contype=&quot;0&quot; pos=&quot;0 0 0&quot; rgba=&quot;0.5 0.5 0.5 1&quot; size=&quot;0.1 0.02 0.02&quot; solimp=&quot;0.99 0.99 0.01&quot; type=&quot;box&quot;&gt;&lt;/geom&gt; --&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">geom</span> <span class="hljs-attr">conaffinity</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">contype</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.0 0.5 0.5 0&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.01&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;sphere&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">geom</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">site</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;mocap&quot;</span> <span class="hljs-attr">pos</span>=<span class="hljs-string">&quot;0 0 0&quot;</span> <span class="hljs-attr">rgba</span>=<span class="hljs-string">&quot;0.0 0.5 0.5 0&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;0.01&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;sphere&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">site</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">mujocoinclude</span>&gt;</span>
</code></pre>
<h3 id="ppo_testinitpy">ppo_test/<strong>init</strong>.py</h3>
<p><em>大小: 19.6 KB | Token: 5.5K</em></p>
<pre><code class="language-python"><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> annotations

<span class="hljs-keyword">import</span> abc
<span class="hljs-keyword">import</span> pickle
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> OrderedDict
<span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> partial
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Any</span>, <span class="hljs-type">Literal</span>

<span class="hljs-keyword">import</span> gymnasium <span class="hljs-keyword">as</span> gym 
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> numpy.typing <span class="hljs-keyword">as</span> npt

<span class="hljs-comment"># noqa: D104</span>
<span class="hljs-keyword">from</span> gymnasium.envs.registration <span class="hljs-keyword">import</span> register

<span class="hljs-keyword">import</span> ppo_test.env_dict <span class="hljs-keyword">as</span> _env_dict
<span class="hljs-keyword">from</span> ppo_test.env_dict <span class="hljs-keyword">import</span> (
    ALL_V3_ENVIRONMENTS,
    ALL_V3_ENVIRONMENTS_GOAL_HIDDEN,
    ALL_V3_ENVIRONMENTS_GOAL_OBSERVABLE,
)
<span class="hljs-keyword">from</span> ppo_test.sawyer_xyz_env <span class="hljs-keyword">import</span> SawyerXYZEnv 
<span class="hljs-keyword">from</span> ppo_test.types <span class="hljs-keyword">import</span> Task 
<span class="hljs-keyword">from</span> ppo_test.wrappers <span class="hljs-keyword">import</span> (
    AutoTerminateOnSuccessWrapper,
    CheckpointWrapper,
    NormalizeRewardsExponential,
    OneHotWrapper,
    PseudoRandomTaskSelectWrapper,
    RandomTaskSelectWrapper,
    RNNBasedMetaRLWrapper,
)


<span class="hljs-keyword">class</span> <span class="hljs-title class_">MetaWorldEnv</span>(abc.ABC):
    <span class="hljs-string">&quot;&quot;&quot;Environment that requires a task before use.

    Takes no arguments to its constructor, and raises an exception if used
    before `set_task` is called.
    &quot;&quot;&quot;</span>

<span class="hljs-meta">    @abc.abstractmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">set_task</span>(<span class="hljs-params">self, task: Task</span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">&quot;&quot;&quot;Sets the task.
        Args:
            task: The task to set.
        Raises:
            ValueError: If `task.env_name` is different from the current task.
        &quot;&quot;&quot;</span>
        <span class="hljs-keyword">raise</span> NotImplementedError


<span class="hljs-keyword">class</span> <span class="hljs-title class_">Benchmark</span>(abc.ABC):
    <span class="hljs-string">&quot;&quot;&quot;A Benchmark.

    When used to evaluate an algorithm, only a single instance should be used.
    &quot;&quot;&quot;</span>

    _train_classes: _env_dict.EnvDict
    _test_classes: _env_dict.EnvDict
    _train_tasks: <span class="hljs-built_in">list</span>[Task]
    _test_tasks: <span class="hljs-built_in">list</span>[Task]

<span class="hljs-meta">    @abc.abstractmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">pass</span>

<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">train_classes</span>(<span class="hljs-params">self</span>) -&gt; _env_dict.EnvDict:
        <span class="hljs-string">&quot;&quot;&quot;Returns all of the environment classes used for training.&quot;&quot;&quot;</span>
        <span class="hljs-keyword">return</span> self._train_classes

<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_classes</span>(<span class="hljs-params">self</span>) -&gt; _env_dict.EnvDict:
        <span class="hljs-string">&quot;&quot;&quot;Returns all of the environment classes used for testing.&quot;&quot;&quot;</span>
        <span class="hljs-keyword">return</span> self._test_classes

<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">train_tasks</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">list</span>[Task]:
        <span class="hljs-string">&quot;&quot;&quot;Returns all of the training tasks for this benchmark.&quot;&quot;&quot;</span>
        <span class="hljs-keyword">return</span> self._train_tasks

<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_tasks</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">list</span>[Task]:
        <span class="hljs-string">&quot;&quot;&quot;Returns all of the test tasks for this benchmark.&quot;&quot;&quot;</span>
        <span class="hljs-keyword">return</span> self._test_tasks


_ML_OVERRIDE = <span class="hljs-built_in">dict</span>(partially_observable=<span class="hljs-literal">True</span>)
<span class="hljs-string">&quot;&quot;&quot;The overrides for the Meta-Learning benchmarks. Disables the inclusion of the goal position in the observation.&quot;&quot;&quot;</span>

_MT_OVERRIDE = <span class="hljs-built_in">dict</span>(partially_observable=<span class="hljs-literal">False</span>)
<span class="hljs-string">&quot;&quot;&quot;The overrides for the Multi-Task benchmarks. Enables the inclusion of the goal position in the observation.&quot;&quot;&quot;</span>

_N_GOALS = <span class="hljs-number">50</span>
<span class="hljs-string">&quot;&quot;&quot;The number of goals to generate for each environment.&quot;&quot;&quot;</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">_encode_task</span>(<span class="hljs-params">env_name, data</span>) -&gt; Task:
    <span class="hljs-string">&quot;&quot;&quot;Instantiates a new `Task` object after pickling the data.

    Args:
        env_name: The name of the environment.
        data: The task data (will be pickled).

    Returns:
        A `Task` object.
    &quot;&quot;&quot;</span>
    <span class="hljs-keyword">return</span> Task(env_name=env_name, data=pickle.dumps(data))


<span class="hljs-keyword">def</span> <span class="hljs-title function_">_make_tasks</span>(<span class="hljs-params">
    classes: _env_dict.EnvDict,
    args_kwargs: _env_dict.EnvArgsKwargsDict,
    kwargs_override: <span class="hljs-built_in">dict</span>,
    seed: <span class="hljs-built_in">int</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
</span>) -&gt; <span class="hljs-built_in">list</span>[Task]:
    <span class="hljs-string">&quot;&quot;&quot;Initialises goals for a given set of environments.

    Args:
        classes: The environment classes as an `EnvDict`.
        args_kwargs: The environment arguments and keyword arguments.
        kwargs_override: Any kwarg overrides.
        seed: The random seed to use.

    Returns:
        A flat list of `Task` objects, `_N_GOALS` for each environment in `classes`.
    &quot;&quot;&quot;</span>
    <span class="hljs-comment"># Cache existing random state</span>
    <span class="hljs-keyword">if</span> seed <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
        st0 = np.random.get_state()
        np.random.seed(seed)

    tasks = []
    <span class="hljs-keyword">for</span> env_name, args <span class="hljs-keyword">in</span> args_kwargs.items():
        kwargs = args[<span class="hljs-string">&quot;kwargs&quot;</span>].copy()
        <span class="hljs-keyword">assert</span> <span class="hljs-built_in">isinstance</span>(kwargs, <span class="hljs-built_in">dict</span>)
        <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(args[<span class="hljs-string">&quot;args&quot;</span>]) == <span class="hljs-number">0</span>

        <span class="hljs-comment"># Init env</span>
        env = classes[env_name]()
        env._freeze_rand_vec = <span class="hljs-literal">False</span>
        env._set_task_called = <span class="hljs-literal">True</span>
        rand_vecs: <span class="hljs-built_in">list</span>[npt.NDArray[<span class="hljs-type">Any</span>]] = []

        <span class="hljs-comment"># Set task</span>
        <span class="hljs-keyword">del</span> kwargs[<span class="hljs-string">&quot;task_id&quot;</span>]
        env._set_task_inner(**kwargs)

        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(_N_GOALS):  <span class="hljs-comment"># Generate random goals</span>
            env.reset()
            <span class="hljs-keyword">assert</span> env._last_rand_vec <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>
            rand_vecs.append(env._last_rand_vec)
        unique_task_rand_vecs = np.unique(np.array(rand_vecs), axis=<span class="hljs-number">0</span>)
        <span class="hljs-keyword">assert</span> (
            unique_task_rand_vecs.shape[<span class="hljs-number">0</span>] == _N_GOALS
        ), <span class="hljs-string">f&quot;Only generated <span class="hljs-subst">{unique_task_rand_vecs.shape[<span class="hljs-number">0</span>]}</span> unique goals, not <span class="hljs-subst">{_N_GOALS}</span>&quot;</span>
        env.close()

        <span class="hljs-comment"># Create a task for each random goal</span>
        <span class="hljs-keyword">for</span> rand_vec <span class="hljs-keyword">in</span> rand_vecs:
            kwargs = args[<span class="hljs-string">&quot;kwargs&quot;</span>].copy()
            <span class="hljs-keyword">assert</span> <span class="hljs-built_in">isinstance</span>(kwargs, <span class="hljs-built_in">dict</span>)
            <span class="hljs-keyword">del</span> kwargs[<span class="hljs-string">&quot;task_id&quot;</span>]

            kwargs.update(<span class="hljs-built_in">dict</span>(rand_vec=rand_vec, env_cls=classes[env_name]))
            kwargs.update(kwargs_override)

            tasks.append(_encode_task(env_name, kwargs))

        <span class="hljs-keyword">del</span> env

    <span class="hljs-comment"># Restore random state</span>
    <span class="hljs-keyword">if</span> seed <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
        np.random.set_state(st0)

    <span class="hljs-keyword">return</span> tasks


<span class="hljs-comment"># MT Benchmarks</span>


<span class="hljs-keyword">class</span> <span class="hljs-title class_">MT1</span>(<span class="hljs-title class_ inherited__">Benchmark</span>):
    <span class="hljs-string">&quot;&quot;&quot;
    The MT1 benchmark.
    A goal-conditioned RL environment for a single Metaworld task.
    &quot;&quot;&quot;</span>

    ENV_NAMES = <span class="hljs-built_in">list</span>(_env_dict.ALL_V3_ENVIRONMENTS.keys())

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, env_name, seed=<span class="hljs-literal">None</span></span>):
        <span class="hljs-built_in">super</span>().__init__()
        <span class="hljs-keyword">if</span> env_name <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> _env_dict.ALL_V3_ENVIRONMENTS:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f&quot;<span class="hljs-subst">{env_name}</span> is not a V3 environment&quot;</span>)
        cls = _env_dict.ALL_V3_ENVIRONMENTS[env_name]
        self._train_classes = OrderedDict([(env_name, cls)])
        self._test_classes = OrderedDict([(env_name, cls)])
        args_kwargs = _env_dict.ML1_args_kwargs[env_name]

        self._train_tasks = _make_tasks(
            self._train_classes, {env_name: args_kwargs}, _MT_OVERRIDE, seed=seed
        )

        self._test_tasks = []

<span class="hljs-comment"># ML Benchmarks</span>


<span class="hljs-keyword">class</span> <span class="hljs-title class_">ML1</span>(<span class="hljs-title class_ inherited__">Benchmark</span>):
    <span class="hljs-string">&quot;&quot;&quot;
    The ML1 benchmark.
    A meta-RL environment for a single Metaworld task.
    The train and test set contain different goal positions.
    The goal position is not part of the observation.
    &quot;&quot;&quot;</span>

    ENV_NAMES = <span class="hljs-built_in">list</span>(_env_dict.ALL_V3_ENVIRONMENTS.keys())

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, env_name, seed=<span class="hljs-literal">None</span></span>):
        <span class="hljs-built_in">super</span>().__init__()
        <span class="hljs-keyword">if</span> env_name <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> _env_dict.ALL_V3_ENVIRONMENTS:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f&quot;<span class="hljs-subst">{env_name}</span> is not a V3 environment&quot;</span>)

        cls = _env_dict.ALL_V3_ENVIRONMENTS[env_name]
        self._train_classes = OrderedDict([(env_name, cls)])
        self._test_classes = self._train_classes
        args_kwargs = _env_dict.ML1_args_kwargs[env_name]

        self._train_tasks = _make_tasks(
            self._train_classes, {env_name: args_kwargs}, _ML_OVERRIDE, seed=seed
        )
        self._test_tasks = _make_tasks(
            self._test_classes,
            {env_name: args_kwargs},
            _ML_OVERRIDE,
            seed=(seed + <span class="hljs-number">1</span> <span class="hljs-keyword">if</span> seed <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">else</span> seed),
        )

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomML</span>(<span class="hljs-title class_ inherited__">Benchmark</span>):
    <span class="hljs-string">&quot;&quot;&quot;
    A custom meta RL benchmark.
    Provide the desired train and test env names during initialisation.
    &quot;&quot;&quot;</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, train_envs: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>], test_envs: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>], seed=<span class="hljs-literal">None</span></span>):
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(<span class="hljs-built_in">set</span>(train_envs).intersection(<span class="hljs-built_in">set</span>(test_envs))) != <span class="hljs-number">0</span>:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;The test tasks cannot contain any of the train tasks.&quot;</span>)

        self._train_classes = _env_dict._get_env_dict(train_envs)
        train_kwargs = _env_dict._get_args_kwargs(
            ALL_V3_ENVIRONMENTS, self._train_classes
        )

        self._test_classes = _env_dict._get_env_dict(test_envs)
        test_kwargs = _env_dict._get_args_kwargs(
            ALL_V3_ENVIRONMENTS, self._test_classes
        )

        self._train_tasks = _make_tasks(
            self._train_classes, train_kwargs, _ML_OVERRIDE, seed=seed
        )
        self._test_tasks = _make_tasks(
            self._test_classes, test_kwargs, _ML_OVERRIDE, seed=seed
        )


<span class="hljs-keyword">def</span> <span class="hljs-title function_">_init_each_env</span>(<span class="hljs-params">
    env_cls: <span class="hljs-built_in">type</span>[SawyerXYZEnv],
    tasks: <span class="hljs-built_in">list</span>[Task],
    seed: <span class="hljs-built_in">int</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
    max_episode_steps: <span class="hljs-built_in">int</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
    terminate_on_success: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>,
    use_one_hot: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>,
    env_id: <span class="hljs-built_in">int</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
    num_tasks: <span class="hljs-built_in">int</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
    recurrent_info_in_obs: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>,
    normalize_reward_in_recurrent_info: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">True</span>,
    task_select: <span class="hljs-type">Literal</span>[<span class="hljs-string">&quot;random&quot;</span>, <span class="hljs-string">&quot;pseudorandom&quot;</span>] = <span class="hljs-string">&quot;random&quot;</span>,
    reward_normalization_method: <span class="hljs-type">Literal</span>[<span class="hljs-string">&quot;gymnasium&quot;</span>, <span class="hljs-string">&quot;exponential&quot;</span>] | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
    normalize_observations: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>,
    reward_alpha: <span class="hljs-built_in">float</span> = <span class="hljs-number">0.001</span>,
    render_mode: <span class="hljs-type">Literal</span>[<span class="hljs-string">&quot;human&quot;</span>, <span class="hljs-string">&quot;rgb_array&quot;</span>, <span class="hljs-string">&quot;depth_array&quot;</span>] | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
    camera_name: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
    camera_id: <span class="hljs-built_in">int</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
    width: <span class="hljs-built_in">int</span> = <span class="hljs-number">480</span>,
    height: <span class="hljs-built_in">int</span> = <span class="hljs-number">480</span>,
</span>) -&gt; gym.Env:
    env: gym.Env = env_cls(
        render_mode=render_mode,
        camera_name=camera_name,
        camera_id=camera_id,
        width=width,
        height=height,
    )
    <span class="hljs-keyword">if</span> seed <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
        env.seed(seed) 
    env = gym.wrappers.TimeLimit(env, max_episode_steps <span class="hljs-keyword">or</span> env.max_path_length) 
    env = AutoTerminateOnSuccessWrapper(env)
    env.toggle_terminate_on_success(terminate_on_success)
    <span class="hljs-keyword">if</span> use_one_hot:
        <span class="hljs-keyword">assert</span> env_id <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>, <span class="hljs-string">&quot;Need to pass env_id through constructor&quot;</span>
        <span class="hljs-keyword">assert</span> num_tasks <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>, <span class="hljs-string">&quot;Need to pass num_tasks through constructor&quot;</span>
        env = OneHotWrapper(env, env_id, num_tasks)
    <span class="hljs-keyword">if</span> recurrent_info_in_obs:
        env = RNNBasedMetaRLWrapper(
            env, normalize_reward=normalize_reward_in_recurrent_info
        )
    <span class="hljs-keyword">if</span> reward_normalization_method == <span class="hljs-string">&quot;gymnasium&quot;</span>:
        env = gym.wrappers.NormalizeReward(env)
    <span class="hljs-keyword">elif</span> reward_normalization_method == <span class="hljs-string">&quot;exponential&quot;</span>:
        env = NormalizeRewardsExponential(reward_alpha=reward_alpha, env=env)
    <span class="hljs-keyword">if</span> normalize_observations:
        env = gym.wrappers.NormalizeObservation(env)
    env = gym.wrappers.RecordEpisodeStatistics(env)

    <span class="hljs-keyword">if</span> task_select != <span class="hljs-string">&quot;random&quot;</span>:
        env = PseudoRandomTaskSelectWrapper(env, tasks)
    <span class="hljs-keyword">else</span>:
        env = RandomTaskSelectWrapper(env, tasks)

    env = CheckpointWrapper(env, <span class="hljs-string">f&quot;<span class="hljs-subst">{env_cls}</span>_<span class="hljs-subst">{env_id}</span>&quot;</span>)
    <span class="hljs-keyword">if</span> seed <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
        env.action_space.seed(seed)
    <span class="hljs-keyword">return</span> env


<span class="hljs-keyword">def</span> <span class="hljs-title function_">make_mt_envs</span>(<span class="hljs-params">
    name: <span class="hljs-built_in">str</span>,
    seed: <span class="hljs-built_in">int</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
    num_tasks: <span class="hljs-built_in">int</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
    vector_strategy: <span class="hljs-type">Literal</span>[<span class="hljs-string">&quot;sync&quot;</span>, <span class="hljs-string">&quot;async&quot;</span>] = <span class="hljs-string">&quot;sync&quot;</span>,
    autoreset_mode: gym.vector.AutoresetMode | <span class="hljs-built_in">str</span> = gym.vector.AutoresetMode.SAME_STEP,
    **kwargs,
</span>) -&gt; gym.Env | gym.vector.VectorEnv:
    benchmark: Benchmark
    <span class="hljs-keyword">if</span> name <span class="hljs-keyword">in</span> ALL_V3_ENVIRONMENTS.keys():
        benchmark = MT1(name, seed=seed)
        tasks = [task <span class="hljs-keyword">for</span> task <span class="hljs-keyword">in</span> benchmark.train_tasks]
        <span class="hljs-keyword">return</span> _init_each_env(
            env_cls=benchmark.train_classes[name],
            tasks=tasks,
            seed=seed,
            num_tasks=num_tasks <span class="hljs-keyword">or</span> <span class="hljs-number">1</span>,
            **kwargs,
        )
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">raise</span> ValueError(
            <span class="hljs-string">&quot;Invalid MT env name. Must either be a valid Metaworld task name (e.g. &#x27;reach-v3&#x27;), &#x27;MT10&#x27; or &#x27;MT50&#x27;.&quot;</span>
        )


<span class="hljs-keyword">def</span> <span class="hljs-title function_">_make_ml_envs_inner</span>(<span class="hljs-params">
    benchmark: Benchmark,
    meta_batch_size: <span class="hljs-built_in">int</span>,
    seed: <span class="hljs-built_in">int</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
    total_tasks_per_cls: <span class="hljs-built_in">int</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
    split: <span class="hljs-type">Literal</span>[<span class="hljs-string">&quot;train&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>] = <span class="hljs-string">&quot;train&quot;</span>,
    vector_strategy: <span class="hljs-type">Literal</span>[<span class="hljs-string">&quot;sync&quot;</span>, <span class="hljs-string">&quot;async&quot;</span>] = <span class="hljs-string">&quot;sync&quot;</span>,
    autoreset_mode: gym.vector.AutoresetMode | <span class="hljs-built_in">str</span> = gym.vector.AutoresetMode.SAME_STEP,
    **kwargs,
</span>):
    all_classes = (
        benchmark.train_classes <span class="hljs-keyword">if</span> split == <span class="hljs-string">&quot;train&quot;</span> <span class="hljs-keyword">else</span> benchmark.test_classes
    )
    all_tasks = benchmark.train_tasks <span class="hljs-keyword">if</span> split == <span class="hljs-string">&quot;train&quot;</span> <span class="hljs-keyword">else</span> benchmark.test_tasks
    <span class="hljs-keyword">assert</span> (
        meta_batch_size % <span class="hljs-built_in">len</span>(all_classes) == <span class="hljs-number">0</span>
    ), <span class="hljs-string">&quot;meta_batch_size must be divisible by envs_per_task&quot;</span>
    tasks_per_env = meta_batch_size // <span class="hljs-built_in">len</span>(all_classes)

    env_tuples = []
    <span class="hljs-keyword">for</span> env_name, env_cls <span class="hljs-keyword">in</span> all_classes.items():
        tasks = [task <span class="hljs-keyword">for</span> task <span class="hljs-keyword">in</span> all_tasks <span class="hljs-keyword">if</span> task.env_name == env_name]
        <span class="hljs-keyword">if</span> total_tasks_per_cls <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            tasks = tasks[:total_tasks_per_cls]
        subenv_tasks = [tasks[i::tasks_per_env] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, tasks_per_env)]
        <span class="hljs-keyword">for</span> tasks_for_subenv <span class="hljs-keyword">in</span> subenv_tasks:
            <span class="hljs-keyword">assert</span> (
                <span class="hljs-built_in">len</span>(tasks_for_subenv) == <span class="hljs-built_in">len</span>(tasks) // tasks_per_env
            ), <span class="hljs-string">f&quot;Invalid division of subtasks, expected <span class="hljs-subst">{<span class="hljs-built_in">len</span>(tasks) // tasks_per_env}</span> got <span class="hljs-subst">{<span class="hljs-built_in">len</span>(tasks_for_subenv)}</span>&quot;</span>
            env_tuples.append((env_cls, tasks_for_subenv))

    vectorizer: <span class="hljs-built_in">type</span>[gym.vector.SyncVectorEnv | gym.vector.AsyncVectorEnv] = <span class="hljs-built_in">getattr</span>(
        gym.vector, <span class="hljs-string">f&quot;<span class="hljs-subst">{vector_strategy.capitalize()}</span>VectorEnv&quot;</span>
    )
    <span class="hljs-keyword">return</span> vectorizer(
        [
            partial(
                _init_each_env,
                env_cls=env_cls,
                tasks=tasks,
                seed=seed,
                **kwargs,
            )
            <span class="hljs-keyword">for</span> env_cls, tasks <span class="hljs-keyword">in</span> env_tuples
        ],
        autoreset_mode=autoreset_mode,
    )


<span class="hljs-keyword">def</span> <span class="hljs-title function_">make_ml_envs</span>(<span class="hljs-params">
    name: <span class="hljs-built_in">str</span>,
    seed: <span class="hljs-built_in">int</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
    meta_batch_size: <span class="hljs-built_in">int</span> = <span class="hljs-number">20</span>,
    total_tasks_per_cls: <span class="hljs-built_in">int</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
    split: <span class="hljs-type">Literal</span>[<span class="hljs-string">&quot;train&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>] = <span class="hljs-string">&quot;train&quot;</span>,
    vector_strategy: <span class="hljs-type">Literal</span>[<span class="hljs-string">&quot;sync&quot;</span>, <span class="hljs-string">&quot;async&quot;</span>] = <span class="hljs-string">&quot;sync&quot;</span>,
    autoreset_mode: gym.vector.AutoresetMode | <span class="hljs-built_in">str</span> = gym.vector.AutoresetMode.SAME_STEP,
    **kwargs,
</span>) -&gt; gym.vector.VectorEnv:
    benchmark: Benchmark
    <span class="hljs-keyword">if</span> name <span class="hljs-keyword">in</span> ALL_V3_ENVIRONMENTS.keys():
        benchmark = ML1(name, seed=seed)
    <span class="hljs-keyword">elif</span> name == <span class="hljs-string">&quot;ML10&quot;</span> <span class="hljs-keyword">or</span> name == <span class="hljs-string">&quot;ML45&quot;</span> <span class="hljs-keyword">or</span> name == <span class="hljs-string">&quot;ML25&quot;</span>:
        benchmark = <span class="hljs-built_in">globals</span>()[name](seed=seed)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">raise</span> ValueError(
            <span class="hljs-string">&quot;Invalid ML env name. Must either be a valid Metaworld task name (e.g. &#x27;reach-v3&#x27;), &#x27;ML10&#x27;, &#x27;ML25&#x27;, or &#x27;ML45&#x27;.&quot;</span>
        )
    <span class="hljs-keyword">return</span> _make_ml_envs_inner(
        benchmark,
        meta_batch_size=meta_batch_size,
        seed=seed,
        total_tasks_per_cls=total_tasks_per_cls,
        split=split,
        vector_strategy=vector_strategy,
        autoreset_mode=autoreset_mode,
        **kwargs,
    )


make_ml_envs_train = partial(
    make_ml_envs,
    terminate_on_success=<span class="hljs-literal">False</span>,
    task_select=<span class="hljs-string">&quot;pseudorandom&quot;</span>,
    split=<span class="hljs-string">&quot;train&quot;</span>,
)
make_ml_envs_test = partial(
    make_ml_envs, terminate_on_success=<span class="hljs-literal">True</span>, task_select=<span class="hljs-string">&quot;pseudorandom&quot;</span>, split=<span class="hljs-string">&quot;test&quot;</span>
)


<span class="hljs-keyword">def</span> <span class="hljs-title function_">register_mw_envs</span>() -&gt; <span class="hljs-literal">None</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_mt_bench_vector_entry_point</span>(<span class="hljs-params">
        mt_bench: <span class="hljs-built_in">str</span>,
        vector_strategy: <span class="hljs-type">Literal</span>[<span class="hljs-string">&quot;sync&quot;</span>, <span class="hljs-string">&quot;async&quot;</span>],
        autoreset_mode: gym.vector.AutoresetMode
        | <span class="hljs-built_in">str</span> = gym.vector.AutoresetMode.SAME_STEP,
        seed=<span class="hljs-literal">None</span>,
        use_one_hot=<span class="hljs-literal">False</span>,
        num_envs=<span class="hljs-literal">None</span>,
        **lamb_kwargs,
    </span>):
        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;num_goals&quot;</span> <span class="hljs-keyword">in</span> lamb_kwargs:
            <span class="hljs-keyword">global</span> _N_GOALS
            _N_GOALS = lamb_kwargs[<span class="hljs-string">&quot;num_goals&quot;</span>]
            <span class="hljs-keyword">del</span> lamb_kwargs[<span class="hljs-string">&quot;num_goals&quot;</span>]
        <span class="hljs-keyword">return</span> make_mt_envs( 
            mt_bench,
            seed=seed,
            use_one_hot=use_one_hot,
            vector_strategy=vector_strategy, 
            autoreset_mode=autoreset_mode,
            **lamb_kwargs,
        )

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_ml_bench_vector_entry_point</span>(<span class="hljs-params">
        ml_bench: <span class="hljs-built_in">str</span>,
        split: <span class="hljs-type">Literal</span>[<span class="hljs-string">&quot;train&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>],
        vector_strategy: <span class="hljs-type">Literal</span>[<span class="hljs-string">&quot;sync&quot;</span>, <span class="hljs-string">&quot;async&quot;</span>],
        autoreset_mode: gym.vector.AutoresetMode
        | <span class="hljs-built_in">str</span> = gym.vector.AutoresetMode.SAME_STEP,
        total_tasks_per_cls: <span class="hljs-built_in">int</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
        seed: <span class="hljs-built_in">int</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
        meta_batch_size: <span class="hljs-built_in">int</span> = <span class="hljs-number">20</span>,
        num_envs=<span class="hljs-literal">None</span>,
        **lamb_kwargs,
    </span>):
        env_generator = make_ml_envs_train <span class="hljs-keyword">if</span> split == <span class="hljs-string">&quot;train&quot;</span> <span class="hljs-keyword">else</span> make_ml_envs_test
        <span class="hljs-keyword">return</span> env_generator(
            ml_bench,
            seed=seed,
            meta_batch_size=meta_batch_size,
            total_tasks_per_cls=total_tasks_per_cls,
            vector_strategy=vector_strategy,
            split=split,
            autoreset_mode=autoreset_mode,
            **lamb_kwargs,
        )

    register(
        <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;Meta-World/MT1&quot;</span>,
        entry_point=<span class="hljs-keyword">lambda</span> env_name, use_one_hot=<span class="hljs-literal">False</span>, vector_strategy=<span class="hljs-string">&quot;sync&quot;</span>, autoreset_mode=gym.vector.AutoresetMode.SAME_STEP, seed=<span class="hljs-literal">None</span>, num_envs=<span class="hljs-literal">None</span>, **kwargs: _mt_bench_vector_entry_point(
            env_name,
            vector_strategy,
            autoreset_mode,
            seed,
            use_one_hot,
            num_envs,
            **kwargs,
        ),
        kwargs={},
    )

    <span class="hljs-keyword">for</span> split <span class="hljs-keyword">in</span> [<span class="hljs-string">&quot;train&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>]:
        register(
            <span class="hljs-built_in">id</span>=<span class="hljs-string">f&quot;Meta-World/ML1-<span class="hljs-subst">{split}</span>&quot;</span>,
            vector_entry_point=<span class="hljs-keyword">lambda</span> env_name, vector_strategy=<span class="hljs-string">&quot;sync&quot;</span>, autoreset_mode=gym.vector.AutoresetMode.SAME_STEP, total_tasks_per_cls=<span class="hljs-literal">None</span>, meta_batch_size=<span class="hljs-number">20</span>, seed=<span class="hljs-literal">None</span>, num_envs=<span class="hljs-literal">None</span>, **kwargs: _ml_bench_vector_entry_point(
                env_name,
                split,  <span class="hljs-comment"># type: ignore[arg-<span class="hljs-built_in">type</span>]</span>
                vector_strategy,
                autoreset_mode,
                total_tasks_per_cls,
                seed,
                meta_batch_size,
                num_envs,
                **kwargs,
            ),
            kwargs={},
        )
    register(
        <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;Meta-World/goal_hidden&quot;</span>,
        entry_point=<span class="hljs-keyword">lambda</span> env_name, seed: ALL_V3_ENVIRONMENTS_GOAL_HIDDEN[
            env_name + <span class="hljs-string">&quot;-goal-hidden&quot;</span> <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;-goal-hidden&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> env_name <span class="hljs-keyword">else</span> env_name
        ]( 
            seed=seed,
        ),
        kwargs={},
    )

    register(
        <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;Meta-World/goal_observable&quot;</span>,
        entry_point=<span class="hljs-keyword">lambda</span> env_name, seed: ALL_V3_ENVIRONMENTS_GOAL_OBSERVABLE[
            env_name + <span class="hljs-string">&quot;-goal-observable&quot;</span>
            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;-goal-observable&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> env_name
            <span class="hljs-keyword">else</span> env_name
        ]( 
            seed=seed
        ),
        kwargs={},
    )
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_custom_mt_vector_entry_point</span>(<span class="hljs-params">
        vector_strategy: <span class="hljs-built_in">str</span>,
        envs_list: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>],
        seed=<span class="hljs-literal">None</span>,
        autoreset_mode: gym.vector.AutoresetMode
        | <span class="hljs-built_in">str</span> = gym.vector.AutoresetMode.SAME_STEP,
        use_one_hot: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>,
        num_envs=<span class="hljs-literal">None</span>,
        **lamb_kwargs,
    </span>):
        vectorizer: <span class="hljs-built_in">type</span>[gym.vector.VectorEnv] = <span class="hljs-built_in">getattr</span>(
            gym.vector, <span class="hljs-string">f&quot;<span class="hljs-subst">{vector_strategy.capitalize()}</span>VectorEnv&quot;</span>
        )
        <span class="hljs-keyword">return</span> vectorizer( 
            [
                partial( 
                    make_mt_envs,
                    env_name,
                    num_tasks=<span class="hljs-built_in">len</span>(envs_list),
                    env_id=idx,
                    seed=<span class="hljs-literal">None</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> seed <span class="hljs-keyword">else</span> seed + idx,
                    use_one_hot=use_one_hot,
                    **lamb_kwargs,
                )
                <span class="hljs-keyword">for</span> idx, env_name <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(envs_list)
            ],
            autoreset_mode=autoreset_mode,
        )

    register(
        <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;Meta-World/custom-mt-envs&quot;</span>,
        vector_entry_point=<span class="hljs-keyword">lambda</span> vector_strategy, envs_list, autoreset_mode=gym.vector.AutoresetMode.SAME_STEP, seed=<span class="hljs-literal">None</span>, use_one_hot=<span class="hljs-literal">False</span>, num_envs=<span class="hljs-literal">None</span>, **kwargs: _custom_mt_vector_entry_point(
            vector_strategy,
            envs_list,
            seed,
            autoreset_mode,
            use_one_hot,
            num_envs,
            **kwargs,
        ),
        kwargs={},
    )

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_custom_ml_vector_entry_point</span>(<span class="hljs-params">
        vector_strategy: <span class="hljs-built_in">str</span>,
        train_envs: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>],
        test_envs: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>],
        autoreset_mode: gym.vector.AutoresetMode
        | <span class="hljs-built_in">str</span> = gym.vector.AutoresetMode.SAME_STEP,
        total_tasks_per_cls: <span class="hljs-built_in">int</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
        meta_batch_size: <span class="hljs-built_in">int</span> = <span class="hljs-number">20</span>,
        seed=<span class="hljs-literal">None</span>,
        num_envs=<span class="hljs-literal">None</span>,
        **lamb_kwargs,
    </span>):
        <span class="hljs-keyword">return</span> _make_ml_envs_inner( 
            CustomML(train_envs, test_envs, seed=seed),
            meta_batch_size=meta_batch_size,
            vector_strategy=vector_strategy, 
            autoreset_mode=autoreset_mode,
            total_tasks_per_cls=total_tasks_per_cls,
            seed=seed,
            **lamb_kwargs,
        )

    register(
        <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;Meta-World/custom-ml-envs&quot;</span>,
        vector_entry_point=<span class="hljs-keyword">lambda</span> vector_strategy, train_envs, test_envs, autoreset_mode=gym.vector.AutoresetMode.SAME_STEP, total_tasks_per_cls=<span class="hljs-literal">None</span>, meta_batch_size=<span class="hljs-number">20</span>, seed=<span class="hljs-literal">None</span>, num_envs=<span class="hljs-literal">None</span>, **kwargs: _custom_ml_vector_entry_point(
            vector_strategy,
            train_envs,
            test_envs,
            autoreset_mode,
            total_tasks_per_cls,
            meta_batch_size,
            seed,
            num_envs,
            **kwargs,
        ),
        kwargs={},
    )


register_mw_envs()
__all__: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>] = []
</code></pre>
<h3 id="ppo_testasset_path_utilspy">ppo_test/asset_path_utils.py</h3>
<p><em>大小: 532 B | Token: 147</em></p>
<pre><code class="language-python"><span class="hljs-string">&quot;&quot;&quot;Set of utilities for retrieving asset paths for the environments.&quot;&quot;&quot;</span>

<span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> annotations

<span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path

_CURRENT_FILE_DIR = Path(__file__).parent.absolute()

ENV_ASSET_DIR_V3 = _CURRENT_FILE_DIR / <span class="hljs-string">&#x27;xml&#x27;</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">full_V3_path_for</span>(<span class="hljs-params">file_name: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">&quot;&quot;&quot;Retrieves the full, absolute path for a given V3 asset

    Args:
        file_name: Name of the asset file. Can include subdirectories.

    Returns:
        The full path to the asset file.
    &quot;&quot;&quot;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span>(ENV_ASSET_DIR_V3 / file_name)
</code></pre>
<h3 id="ppo_testenv_dictpy">ppo_test/env_dict.py</h3>
<p><em>大小: 5.8 KB | Token: 1.6K</em></p>
<pre><code class="language-python"><span class="hljs-string">&quot;&quot;&quot;Dictionaries mapping environment name strings to environment classes,
and organising them into various collections and splits for the benchmarks.&quot;&quot;&quot;</span>

<span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> annotations

<span class="hljs-keyword">import</span> re
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> OrderedDict
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Dict</span>, <span class="hljs-type">List</span>, <span class="hljs-type">Literal</span>
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> OrderedDict <span class="hljs-keyword">as</span> Typing_OrderedDict
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Sequence</span>, <span class="hljs-type">Union</span>

<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">from</span> typing_extensions <span class="hljs-keyword">import</span> TypeAlias

<span class="hljs-comment"># from metaworld import envs</span>
<span class="hljs-keyword">from</span> ppo_test.sawyer_xyz_env <span class="hljs-keyword">import</span> SawyerXYZEnv
<span class="hljs-keyword">from</span> ppo_test.sawyer_peg_insertion_side_v3 <span class="hljs-keyword">import</span> SawyerPegInsertionSideEnvV3

<span class="hljs-comment"># Utils</span>

EnvDict: TypeAlias = <span class="hljs-string">&quot;Typing_OrderedDict[str, type[SawyerXYZEnv]]&quot;</span>
TrainTestEnvDict: TypeAlias = <span class="hljs-string">&quot;Typing_OrderedDict[Literal[&#x27;train&#x27;, &#x27;test&#x27;], EnvDict]&quot;</span>
EnvArgsKwargsDict: TypeAlias = (
    <span class="hljs-string">&quot;Dict[str, Dict[Literal[&#x27;args&#x27;, &#x27;kwargs&#x27;], Union[List, Dict]]]&quot;</span>
)

ENV_CLS_MAP = {
    <span class="hljs-string">&quot;peg-insert-side-v3&quot;</span>: SawyerPegInsertionSideEnvV3,
}


<span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_env_dict</span>(<span class="hljs-params">env_names: <span class="hljs-type">Sequence</span>[<span class="hljs-built_in">str</span>]</span>) -&gt; EnvDict:
    <span class="hljs-string">&quot;&quot;&quot;Returns an `OrderedDict` containing `(env_name, env_cls)` tuples for the given env_names.

    Args:
        env_names: The environment names

    Returns:
        The appropriate `OrderedDict.
    &quot;&quot;&quot;</span>
    <span class="hljs-keyword">return</span> OrderedDict([(env_name, ENV_CLS_MAP[env_name]) <span class="hljs-keyword">for</span> env_name <span class="hljs-keyword">in</span> env_names])


<span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_train_test_env_dict</span>(<span class="hljs-params">
    train_env_names: <span class="hljs-type">Sequence</span>[<span class="hljs-built_in">str</span>], test_env_names: <span class="hljs-type">Sequence</span>[<span class="hljs-built_in">str</span>]
</span>) -&gt; TrainTestEnvDict:
    <span class="hljs-string">&quot;&quot;&quot;Returns an `OrderedDict` containing two sub-keys (&quot;train&quot; and &quot;test&quot; at positions 0 and 1),
    each containing the appropriate `OrderedDict` for the train and test classes of the benchmark.

    Args:
        train_env_names: The train environment names.
        test_env_names: The test environment names

    Returns:
        The appropriate `OrderedDict`.
    &quot;&quot;&quot;</span>
    <span class="hljs-keyword">return</span> OrderedDict(
        (
            (<span class="hljs-string">&quot;train&quot;</span>, _get_env_dict(train_env_names)),
            (<span class="hljs-string">&quot;test&quot;</span>, _get_env_dict(test_env_names)),
        )
    )


<span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_args_kwargs</span>(<span class="hljs-params">all_envs: EnvDict, env_subset: EnvDict</span>) -&gt; EnvArgsKwargsDict:
    <span class="hljs-string">&quot;&quot;&quot;Returns containing a `dict` of &quot;args&quot; and &quot;kwargs&quot; for each environment in a given list of environments.
    Specifically, sets an empty &quot;args&quot; array and a &quot;kwargs&quot; dictionary with a &quot;task_id&quot; key for each env.

    Args:
        all_envs: The full list of envs
        env_subset: The subset of envs to get args and kwargs for

    Returns:
        The args and kwargs dictionary.
    &quot;&quot;&quot;</span>
    <span class="hljs-keyword">return</span> {
        key: <span class="hljs-built_in">dict</span>(args=[], kwargs={<span class="hljs-string">&quot;task_id&quot;</span>: <span class="hljs-built_in">list</span>(all_envs.keys()).index(key)})
        <span class="hljs-keyword">for</span> key, _ <span class="hljs-keyword">in</span> env_subset.items()
    }


<span class="hljs-keyword">def</span> <span class="hljs-title function_">_create_hidden_goal_envs</span>(<span class="hljs-params">all_envs: EnvDict</span>) -&gt; EnvDict:
    <span class="hljs-string">&quot;&quot;&quot;Create versions of the environments with the goal hidden.

    Args:
        all_envs: The full list of envs in the benchmark.

    Returns:
        An `EnvDict` where the classes have been modified to hide the goal.
    &quot;&quot;&quot;</span>
    hidden_goal_envs = {}
    <span class="hljs-keyword">for</span> env_name, env_cls <span class="hljs-keyword">in</span> all_envs.items():
        d = {}

        <span class="hljs-keyword">def</span> <span class="hljs-title function_">initialize</span>(<span class="hljs-params">env, seed=<span class="hljs-literal">None</span></span>):
            <span class="hljs-keyword">if</span> seed <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
                st0 = np.random.get_state()
                np.random.seed(seed)
            <span class="hljs-built_in">super</span>(<span class="hljs-built_in">type</span>(env), env).__init__()
            env._partially_observable = <span class="hljs-literal">True</span>
            <span class="hljs-keyword">del</span> env.sawyer_observation_space
            env._freeze_rand_vec = <span class="hljs-literal">False</span>
            env._set_task_called = <span class="hljs-literal">True</span>
            env.reset()
            env._freeze_rand_vec = <span class="hljs-literal">True</span>
            <span class="hljs-keyword">if</span> seed <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
                env.seed(seed=seed)
                np.random.set_state(st0)

        d[<span class="hljs-string">&quot;__init__&quot;</span>] = initialize
        hg_env_name = re.sub(
            <span class="hljs-string">r&quot;(^|[-])\s*([a-zA-Z])&quot;</span>, <span class="hljs-keyword">lambda</span> p: p.group(<span class="hljs-number">0</span>).upper(), env_name
        )
        hg_env_name = hg_env_name.replace(<span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)
        hg_env_key = <span class="hljs-string">f&quot;<span class="hljs-subst">{env_name}</span>-goal-hidden&quot;</span>
        hg_env_name = <span class="hljs-string">f&quot;<span class="hljs-subst">{hg_env_name}</span>GoalHidden&quot;</span>
        HiddenGoalEnvCls = <span class="hljs-built_in">type</span>(hg_env_name, (env_cls,), d)
        hidden_goal_envs[hg_env_key] = HiddenGoalEnvCls

    <span class="hljs-keyword">return</span> OrderedDict(hidden_goal_envs)


<span class="hljs-keyword">def</span> <span class="hljs-title function_">_create_observable_goal_envs</span>(<span class="hljs-params">all_envs: EnvDict</span>) -&gt; EnvDict:
    <span class="hljs-string">&quot;&quot;&quot;Create versions of the environments with the goal observable.

    Args:
        all_envs: The full list of envs in the benchmark.

    Returns:
        An `EnvDict` where the classes have been modified to make the goal observable.
    &quot;&quot;&quot;</span>
    observable_goal_envs = {}
    <span class="hljs-keyword">for</span> env_name, env_cls <span class="hljs-keyword">in</span> all_envs.items():
        d = {}

        <span class="hljs-keyword">def</span> <span class="hljs-title function_">initialize</span>(<span class="hljs-params">env, *args, **kwargs</span>):
            seed = kwargs.pop(<span class="hljs-string">&#x27;seed&#x27;</span>, <span class="hljs-literal">None</span>)
            render_mode = kwargs.pop(<span class="hljs-string">&#x27;render_mode&#x27;</span>, <span class="hljs-literal">None</span>)
            <span class="hljs-keyword">if</span> seed <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
                st0 = np.random.get_state()
                np.random.seed(seed)

            <span class="hljs-built_in">super</span>(<span class="hljs-built_in">type</span>(env), env).__init__(*args, **kwargs)
            env._partially_observable = <span class="hljs-literal">False</span>
            env._freeze_rand_vec = <span class="hljs-literal">False</span>
            <span class="hljs-keyword">del</span> env.sawyer_observation_space
            env._set_task_called = <span class="hljs-literal">True</span>
            env.render_mode = render_mode
            env.reset()
            env._freeze_rand_vec = <span class="hljs-literal">True</span>
            <span class="hljs-keyword">if</span> seed <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
                env.seed(seed)
                np.random.set_state(st0)

        d[<span class="hljs-string">&quot;__init__&quot;</span>] = initialize
        og_env_name = re.sub(
            <span class="hljs-string">r&quot;(^|[-])\s*([a-zA-Z])&quot;</span>, <span class="hljs-keyword">lambda</span> p: p.group(<span class="hljs-number">0</span>).upper(), env_name
        )
        og_env_name = og_env_name.replace(<span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)

        og_env_key = <span class="hljs-string">f&quot;<span class="hljs-subst">{env_name}</span>-goal-observable&quot;</span>
        og_env_name = <span class="hljs-string">f&quot;<span class="hljs-subst">{og_env_name}</span>GoalObservable&quot;</span>
        ObservableGoalEnvCls = <span class="hljs-built_in">type</span>(og_env_name, (env_cls,), d)
        observable_goal_envs[og_env_key] = ObservableGoalEnvCls

    <span class="hljs-keyword">return</span> OrderedDict(observable_goal_envs)


<span class="hljs-comment"># V3 DICTS</span>

ALL_V3_ENVIRONMENTS = _get_env_dict(
    [
        <span class="hljs-string">&quot;peg-insert-side-v3&quot;</span>,
    ]
)


ALL_V3_ENVIRONMENTS_GOAL_HIDDEN = _create_hidden_goal_envs(ALL_V3_ENVIRONMENTS)
ALL_V3_ENVIRONMENTS_GOAL_OBSERVABLE = _create_observable_goal_envs(ALL_V3_ENVIRONMENTS)

<span class="hljs-comment"># ML Dicts</span>

ML1_V3 = _get_train_test_env_dict(
    <span class="hljs-built_in">list</span>(ALL_V3_ENVIRONMENTS.keys()), <span class="hljs-built_in">list</span>(ALL_V3_ENVIRONMENTS.keys())
)
ML1_args_kwargs = _get_args_kwargs(ALL_V3_ENVIRONMENTS, ML1_V3[<span class="hljs-string">&quot;train&quot;</span>])
</code></pre>
<h3 id="ppo_testevaluationpy">ppo_test/evaluation.py</h3>
<p><em>大小: 5.5 KB | Token: 1.5K</em></p>
<pre><code class="language-python"><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> annotations

<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> NamedTuple, Protocol

<span class="hljs-keyword">import</span> gymnasium <span class="hljs-keyword">as</span> gym
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> numpy.typing <span class="hljs-keyword">as</span> npt

<span class="hljs-keyword">from</span> env_dict <span class="hljs-keyword">import</span> ALL_V3_ENVIRONMENTS


<span class="hljs-keyword">class</span> <span class="hljs-title class_">Agent</span>(<span class="hljs-title class_ inherited__">Protocol</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">eval_action</span>(<span class="hljs-params">
        self, observations: npt.NDArray[np.float64]
    </span>) -&gt; npt.NDArray[np.float64]:
        ...

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">reset</span>(<span class="hljs-params">self, env_mask: npt.NDArray[np.bool_]</span>) -&gt; <span class="hljs-literal">None</span>:
        ...


<span class="hljs-keyword">class</span> <span class="hljs-title class_">MetaLearningAgent</span>(Agent, Protocol):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">init</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-literal">None</span>:
        ...

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">adapt_action</span>(<span class="hljs-params">
        self, observations: npt.NDArray[np.float64]
    </span>) -&gt; <span class="hljs-built_in">tuple</span>[npt.NDArray[np.float64], <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, npt.NDArray]]:
        ...

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">step</span>(<span class="hljs-params">self, timestep: Timestep</span>) -&gt; <span class="hljs-literal">None</span>:
        ...

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">adapt</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-literal">None</span>:
        ...


<span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_task_names</span>(<span class="hljs-params">
    envs: gym.vector.SyncVectorEnv | gym.vector.AsyncVectorEnv,
</span>) -&gt; <span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>]:
    metaworld_cls_to_task_name = {v.__name__: k <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> ALL_V3_ENVIRONMENTS.items()}
    <span class="hljs-keyword">return</span> [
        metaworld_cls_to_task_name[task_name]
        <span class="hljs-keyword">for</span> task_name <span class="hljs-keyword">in</span> envs.get_attr(<span class="hljs-string">&quot;task_name&quot;</span>)
    ]


<span class="hljs-keyword">def</span> <span class="hljs-title function_">evaluation</span>(<span class="hljs-params">
    agent: Agent,
    eval_envs: gym.vector.SyncVectorEnv | gym.vector.AsyncVectorEnv,
    num_episodes: <span class="hljs-built_in">int</span> = <span class="hljs-number">50</span>,
</span>) -&gt; <span class="hljs-built_in">tuple</span>[<span class="hljs-built_in">float</span>, <span class="hljs-built_in">float</span>, <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">float</span>], <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">list</span>[<span class="hljs-built_in">float</span>]]]:
    terminate_on_success = np.<span class="hljs-built_in">all</span>(eval_envs.get_attr(<span class="hljs-string">&quot;terminate_on_success&quot;</span>)).item()
    eval_envs.call(<span class="hljs-string">&quot;toggle_terminate_on_success&quot;</span>, <span class="hljs-literal">True</span>)

    obs: npt.NDArray[np.float64]
    obs, _ = eval_envs.reset()
    agent.reset(np.ones(eval_envs.num_envs, dtype=np.bool_))

    task_names = _get_task_names(eval_envs)
    successes = {task_name: <span class="hljs-number">0</span> <span class="hljs-keyword">for</span> task_name <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span>(task_names)}
    episodic_returns: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">list</span>[<span class="hljs-built_in">float</span>]] = {
        task_name: [] <span class="hljs-keyword">for</span> task_name <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span>(task_names)
    }

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">eval_done</span>(<span class="hljs-params">returns</span>):
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">all</span>(<span class="hljs-built_in">len</span>(r) &gt;= num_episodes <span class="hljs-keyword">for</span> _, r <span class="hljs-keyword">in</span> returns.items())

    <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> eval_done(episodic_returns):
        actions = agent.eval_action(obs)
        obs, _, terminations, truncations, infos = eval_envs.step(actions)

        dones = np.logical_or(terminations, truncations)
        agent.reset(dones)

        <span class="hljs-keyword">for</span> i, env_ended <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(dones):
            <span class="hljs-keyword">if</span> env_ended:
                episodic_returns[task_names[i]].append(
                    <span class="hljs-built_in">float</span>(infos[<span class="hljs-string">&quot;final_info&quot;</span>][<span class="hljs-string">&quot;episode&quot;</span>][<span class="hljs-string">&quot;r&quot;</span>][i])
                )
                <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(episodic_returns[task_names[i]]) &lt;= num_episodes:
                    successes[task_names[i]] += <span class="hljs-built_in">int</span>(infos[<span class="hljs-string">&quot;final_info&quot;</span>][<span class="hljs-string">&quot;success&quot;</span>][i])

    episodic_returns = {
        task_name: returns[:num_episodes]
        <span class="hljs-keyword">for</span> task_name, returns <span class="hljs-keyword">in</span> episodic_returns.items()
    }

    success_rate_per_task = {
        task_name: task_successes / num_episodes
        <span class="hljs-keyword">for</span> task_name, task_successes <span class="hljs-keyword">in</span> successes.items()
    }
    mean_success_rate = np.mean(<span class="hljs-built_in">list</span>(success_rate_per_task.values()))
    mean_returns = np.mean(<span class="hljs-built_in">list</span>(episodic_returns.values()))

    eval_envs.call(<span class="hljs-string">&quot;toggle_terminate_on_success&quot;</span>, terminate_on_success)

    <span class="hljs-keyword">return</span> (
        <span class="hljs-built_in">float</span>(mean_success_rate),
        <span class="hljs-built_in">float</span>(mean_returns),
        success_rate_per_task,
        episodic_returns,
    )


<span class="hljs-keyword">def</span> <span class="hljs-title function_">metalearning_evaluation</span>(<span class="hljs-params">
    agent: MetaLearningAgent,
    eval_envs: gym.vector.SyncVectorEnv | gym.vector.AsyncVectorEnv,
    num_evals: <span class="hljs-built_in">int</span> = <span class="hljs-number">10</span>,  <span class="hljs-comment"># Assuming 40 goals per test task and meta batch size of 20</span>
    adaptation_steps: <span class="hljs-built_in">int</span> = <span class="hljs-number">1</span>,
    adaptation_episodes: <span class="hljs-built_in">int</span> = <span class="hljs-number">10</span>,
    evaluation_episodes: <span class="hljs-built_in">int</span> = <span class="hljs-number">3</span>,
</span>) -&gt; <span class="hljs-built_in">tuple</span>[<span class="hljs-built_in">float</span>, <span class="hljs-built_in">float</span>, <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">float</span>]]:
    eval_envs.call(<span class="hljs-string">&quot;toggle_sample_tasks_on_reset&quot;</span>, <span class="hljs-literal">False</span>)
    eval_envs.call(<span class="hljs-string">&quot;toggle_terminate_on_success&quot;</span>, <span class="hljs-literal">False</span>)
    task_names = _get_task_names(eval_envs)

    total_mean_success_rate = <span class="hljs-number">0.0</span>
    total_mean_return = <span class="hljs-number">0.0</span>
    success_rate_per_task = np.zeros((num_evals, <span class="hljs-built_in">len</span>(<span class="hljs-built_in">set</span>(task_names))))

    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_evals):
        obs: npt.NDArray[np.float64]

        eval_envs.call(<span class="hljs-string">&quot;sample_tasks&quot;</span>)
        agent.init()

        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(adaptation_steps):
            obs, _ = eval_envs.reset()
            episodes_elapsed = np.zeros((eval_envs.num_envs,), dtype=np.uint16)

            <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> (episodes_elapsed &gt;= adaptation_episodes).<span class="hljs-built_in">all</span>():
                actions, aux_policy_outs = agent.adapt_action(obs)
                next_obs, rewards, terminations, truncations, _ = eval_envs.step(
                    actions
                )
                agent.step(
                    Timestep(
                        obs,
                        actions,
                        rewards,
                        terminations,
                        truncations,
                        aux_policy_outs,
                    )
                )
                episodes_elapsed += np.logical_or(terminations, truncations)
                obs = next_obs

            agent.adapt()

        <span class="hljs-comment"># Evaluation</span>
        mean_success_rate, mean_return, _success_rate_per_task, _ = evaluation(
            agent, eval_envs, evaluation_episodes
        )
        total_mean_success_rate += mean_success_rate
        total_mean_return += mean_return
        success_rate_per_task[i] = np.array(<span class="hljs-built_in">list</span>(_success_rate_per_task.values()))

    success_rates = (success_rate_per_task).mean(axis=<span class="hljs-number">0</span>)
    task_success_rates = {
        task_name: success_rates[i] <span class="hljs-keyword">for</span> i, task_name <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-built_in">set</span>(task_names))
    }

    <span class="hljs-keyword">return</span> (
        total_mean_success_rate / num_evals,
        total_mean_return / num_evals,
        task_success_rates,
    )


<span class="hljs-keyword">class</span> <span class="hljs-title class_">Timestep</span>(<span class="hljs-title class_ inherited__">NamedTuple</span>):
    observation: npt.NDArray
    action: npt.NDArray
    reward: npt.NDArray
    terminated: npt.NDArray
    truncated: npt.NDArray
    aux_policy_outputs: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, npt.NDArray]
</code></pre>
<h3 id="ppo_testsawyer_peg_insertion_side_v3py">ppo_test/sawyer_peg_insertion_side_v3.py</h3>
<p><em>大小: 10.2 KB | Token: 2.8K</em></p>
<pre><code class="language-python"><span class="hljs-comment"># metaworld/sawyer_peg_insertion_side_v3.py</span>

<span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> annotations

<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Any</span>

<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> numpy.typing <span class="hljs-keyword">as</span> npt
<span class="hljs-keyword">from</span> gymnasium.spaces <span class="hljs-keyword">import</span> Box
<span class="hljs-keyword">from</span> scipy.spatial.transform <span class="hljs-keyword">import</span> Rotation

<span class="hljs-keyword">from</span> ppo_test.asset_path_utils <span class="hljs-keyword">import</span> full_V3_path_for
<span class="hljs-keyword">from</span> ppo_test.sawyer_xyz_env <span class="hljs-keyword">import</span> RenderMode, SawyerXYZEnv
<span class="hljs-keyword">from</span> ppo_test.types <span class="hljs-keyword">import</span> InitConfigDict
<span class="hljs-keyword">from</span> ppo_test.utils <span class="hljs-keyword">import</span> reward_utils


<span class="hljs-keyword">class</span> <span class="hljs-title class_">SawyerPegInsertionSideEnvV3</span>(<span class="hljs-title class_ inherited__">SawyerXYZEnv</span>):
    TARGET_RADIUS: <span class="hljs-built_in">float</span> = <span class="hljs-number">0.07</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">
        self,
        render_mode: RenderMode | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
        camera_name: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
        camera_id: <span class="hljs-built_in">int</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
        height: <span class="hljs-built_in">int</span> = <span class="hljs-number">480</span>,
        width: <span class="hljs-built_in">int</span> = <span class="hljs-number">480</span>,
    </span>) -&gt; <span class="hljs-literal">None</span>:

        hand_low = (-<span class="hljs-number">0.5</span>, <span class="hljs-number">0.40</span>, <span class="hljs-number">0.05</span>)
        hand_high = (<span class="hljs-number">0.5</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0.5</span>)
        obj_low = (<span class="hljs-number">0.0</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.02</span>)
        obj_high = (<span class="hljs-number">0.2</span>, <span class="hljs-number">0.7</span>, <span class="hljs-number">0.02</span>)
        goal_low = (-<span class="hljs-number">0.35</span>, <span class="hljs-number">0.4</span>, -<span class="hljs-number">0.001</span>)
        goal_high = (-<span class="hljs-number">0.25</span>, <span class="hljs-number">0.7</span>, <span class="hljs-number">0.001</span>)

        <span class="hljs-built_in">super</span>().__init__(
            hand_low=hand_low,
            hand_high=hand_high,
            render_mode=render_mode,
            camera_name=camera_name,
            camera_id=camera_id,
            height=height,
            width=width,
        )

        self.goal = np.array([-<span class="hljs-number">0.3</span>, <span class="hljs-number">0.6</span>, <span class="hljs-number">0.0</span>])

        self.obj_init_pos = np.array([<span class="hljs-number">0</span>, <span class="hljs-number">0.6</span>, <span class="hljs-number">0.02</span>])
        self.hand_init_pos = np.array([<span class="hljs-number">0</span>, <span class="hljs-number">0.6</span>, <span class="hljs-number">0.2</span>])
        self.hand_init_quat = Rotation.from_euler(<span class="hljs-string">&#x27;xyz&#x27;</span>, [<span class="hljs-number">0</span>,<span class="hljs-number">45</span>,<span class="hljs-number">0</span>], degrees=<span class="hljs-literal">True</span>).as_quat()[[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>]]
        
        self._random_reset_space = Box(
            np.hstack((obj_low, goal_low)),
            np.hstack((obj_high, goal_high)),
            dtype=np.float64,
        )
        self.goal_space = Box(
            np.array(goal_low) + np.array([<span class="hljs-number">0.03</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.13</span>]),
            np.array(goal_high) + np.array([<span class="hljs-number">0.03</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.13</span>]),
            dtype=np.float64,
        )

        self.liftThresh = <span class="hljs-number">0.11</span>

        self.pegHead_force_id = self.model.sensor(<span class="hljs-string">&quot;pegHead_force&quot;</span>).<span class="hljs-built_in">id</span>

<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">model_name</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-keyword">return</span> full_V3_path_for(<span class="hljs-string">&quot;sawyer_peg_insertion_side.xml&quot;</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_pegHead_force</span>(<span class="hljs-params">self</span>) -&gt; npt.NDArray[np.float64]:
        <span class="hljs-string">&quot;&quot;&quot;获取pegHead所受的力 (Fx, Fy, Fz).&quot;&quot;&quot;</span>
        <span class="hljs-comment"># MuJoCo force sensors output a 3D vector</span>
        <span class="hljs-keyword">return</span> self.data.sensordata[self.pegHead_force_id : self.pegHead_force_id + <span class="hljs-number">3</span>]

<span class="hljs-meta">    @SawyerXYZEnv._Decorators.assert_task_is_set</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">evaluate_state</span>(<span class="hljs-params">
        self, obs: npt.NDArray[np.float64], action: npt.NDArray[np.float32]
    </span>) -&gt; <span class="hljs-built_in">tuple</span>[<span class="hljs-built_in">float</span>, <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]]:
        <span class="hljs-comment"># obs structure: hand_pos(3) + quat_hand(4) + gripper_distance_apart(1) + force(3) + peg_pos(3) + peg_rot(4) + unused_info(7) + _prev_obs(25) + goal_pos(3) = 53</span>
        obj = obs[<span class="hljs-number">11</span>:<span class="hljs-number">14</span>]

        <span class="hljs-keyword">assert</span> self._target_pos <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> self.obj_init_pos <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>
        
        <span class="hljs-comment"># Updated observation parsing for new 53-dimensional observation space</span>
        obj = obs[<span class="hljs-number">11</span>:<span class="hljs-number">14</span>]
        obj_head = self._get_site_pos(<span class="hljs-string">&quot;pegHead&quot;</span>)
        
        tcp_opened: <span class="hljs-built_in">float</span> = obs[<span class="hljs-number">7</span>] 
        tcp = self.tcp_center
        
        target = self._target_pos
        
        tcp_to_obj = <span class="hljs-built_in">float</span>(np.linalg.norm(obj - tcp))
        
        reward, tcp_open, obj_to_target, grasp_reward, in_place_reward = self.compute_reward(action, obj, tcp_opened)
        
        <span class="hljs-keyword">assert</span> self.obj_init_pos <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>
        grasp_success = <span class="hljs-built_in">float</span>(
            tcp_to_obj &lt; <span class="hljs-number">0.02</span>
            <span class="hljs-keyword">and</span> (tcp_open &gt; <span class="hljs-number">0</span>)
            <span class="hljs-keyword">and</span> (obj[<span class="hljs-number">2</span>] - <span class="hljs-number">0.01</span> &gt; self.obj_init_pos[<span class="hljs-number">2</span>])
        )
        
        success_arrive = <span class="hljs-built_in">float</span>(
            obj_to_target &lt;= <span class="hljs-number">0.07</span>
        )
        
        success = <span class="hljs-built_in">float</span>(
            success_arrive
            <span class="hljs-keyword">and</span> target[<span class="hljs-number">0</span>] - obj_head[<span class="hljs-number">0</span>] &gt;= <span class="hljs-number">0.05</span>
        )
            
        near_object = <span class="hljs-built_in">float</span>(tcp_to_obj &lt;= <span class="hljs-number">0.03</span>)

        <span class="hljs-comment"># 获取 pegHead 受力, 大小, 和方向</span>
        pegHead_force = self._get_pegHead_force()
        force_magnitude = np.linalg.norm(pegHead_force)
        <span class="hljs-comment"># 避免零除错误</span>
        force_direction = pegHead_force / (force_magnitude + <span class="hljs-number">1e-8</span>) <span class="hljs-keyword">if</span> force_magnitude &gt; <span class="hljs-number">1e-8</span> <span class="hljs-keyword">else</span> np.zeros_like(pegHead_force)

        <span class="hljs-comment"># --- 力可视化更新 ---</span>
        force_viz_geom_id = self.model.geom(<span class="hljs-string">&#x27;force_viz&#x27;</span>).<span class="hljs-built_in">id</span>
        VIZ_SCALE = <span class="hljs-number">50</span>  <span class="hljs-comment"># 可视化缩放因子</span>
        <span class="hljs-comment"># MuJoCo中圆柱体的长度是 2 * size[1]</span>
        self.model.geom_size[force_viz_geom_id][<span class="hljs-number">1</span>] = force_magnitude * VIZ_SCALE / <span class="hljs-number">2.0</span>
        
        <span class="hljs-keyword">if</span> force_magnitude &gt; <span class="hljs-number">1e-3</span>: <span class="hljs-comment"># 设置一个小的阈值以避免不必要的计算</span>
            <span class="hljs-comment"># 默认圆柱体是沿着Z轴的</span>
            z_axis = np.array([<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>])
            <span class="hljs-comment"># 计算将Z轴旋转到力的方向所需的旋转量</span>
            rot, _ = Rotation.align_vectors(force_direction.reshape(<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>), z_axis.reshape(<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>))
            <span class="hljs-comment"># 转换为 MuJoCo 的四元数格式 [w, x, y, z]</span>
            quat = rot.as_quat()[[<span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>]]
            self.model.geom_quat[force_viz_geom_id] = quat
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># 如果力很小，就让圆柱体变得非常短（隐藏）</span>
            self.model.geom_size[force_viz_geom_id][<span class="hljs-number">1</span>] = <span class="hljs-number">0.0</span>

        info = {
            <span class="hljs-string">&quot;success&quot;</span>: success,
            <span class="hljs-string">&quot;near_object&quot;</span>: near_object,
            <span class="hljs-string">&quot;grasp_success&quot;</span>: grasp_success,
            <span class="hljs-string">&quot;grasp_reward&quot;</span>: grasp_reward,
            <span class="hljs-string">&quot;in_place_reward&quot;</span>: in_place_reward,
            <span class="hljs-string">&quot;obj_to_target&quot;</span>: obj_to_target,
            <span class="hljs-string">&quot;unscaled_reward&quot;</span>: reward,
            <span class="hljs-string">&quot;pegHead_force&quot;</span>: pegHead_force,             <span class="hljs-comment"># 原始力向量</span>
            <span class="hljs-string">&quot;pegHead_force_magnitude&quot;</span>: force_magnitude, <span class="hljs-comment"># 力的大小</span>
            <span class="hljs-string">&quot;pegHead_force_direction&quot;</span>: force_direction, <span class="hljs-comment"># 力的方向 (单位向量)</span>
        }

        <span class="hljs-keyword">return</span> reward, info

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_pos_objects</span>(<span class="hljs-params">self</span>) -&gt; npt.NDArray[<span class="hljs-type">Any</span>]:
        <span class="hljs-keyword">return</span> self._get_site_pos(<span class="hljs-string">&quot;pegGrasp&quot;</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_quat_objects</span>(<span class="hljs-params">self</span>) -&gt; npt.NDArray[<span class="hljs-type">Any</span>]:
        geom_xmat = self.data.site(<span class="hljs-string">&quot;pegGrasp&quot;</span>).xmat.reshape(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>)
        <span class="hljs-keyword">return</span> Rotation.from_matrix(geom_xmat).as_quat()

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">reset_model</span>(<span class="hljs-params">self</span>) -&gt; npt.NDArray[np.float64]:
        self._reset_hand()
        pos_peg, pos_box = np.split(self._get_state_rand_vec(), <span class="hljs-number">2</span>)
        <span class="hljs-keyword">while</span> np.linalg.norm(pos_peg[:<span class="hljs-number">2</span>] - pos_box[:<span class="hljs-number">2</span>]) &lt; <span class="hljs-number">0.1</span>:
            pos_peg, pos_box = np.split(self._get_state_rand_vec(), <span class="hljs-number">2</span>)
        self.obj_init_pos = pos_peg
        self.peg_head_pos_init = self._get_site_pos(<span class="hljs-string">&quot;pegHead&quot;</span>)
        self._set_obj_xyz(self.obj_init_pos)
        self.model.body(<span class="hljs-string">&quot;box&quot;</span>).pos = pos_box
        self.model.body(<span class="hljs-string">&quot;box&quot;</span>).quat = Rotation.from_euler(<span class="hljs-string">&#x27;xyz&#x27;</span>, [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">90</span>+<span class="hljs-number">5</span>], degrees=<span class="hljs-literal">True</span>).as_quat()[[<span class="hljs-number">3</span>,<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>]]
        self._target_pos = pos_box + np.array([<span class="hljs-number">0.03</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.13</span>])
        self.model.site(<span class="hljs-string">&quot;goal&quot;</span>).pos = self._target_pos

        self.objHeight = self.get_body_com(<span class="hljs-string">&quot;peg&quot;</span>).copy()[<span class="hljs-number">2</span>]
        self.heightTarget = self.objHeight + self.liftThresh
                
        <span class="hljs-keyword">return</span> self._get_obs()

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">compute_reward</span>(<span class="hljs-params">
        self, action: npt.NDArray[<span class="hljs-type">Any</span>], obj: npt.NDArray[<span class="hljs-type">Any</span>], tcp_opened: npt.NDArray[<span class="hljs-type">Any</span>]
    </span>) -&gt; <span class="hljs-built_in">tuple</span>[<span class="hljs-built_in">float</span>, <span class="hljs-built_in">float</span>, <span class="hljs-built_in">float</span>, <span class="hljs-built_in">float</span>, <span class="hljs-built_in">float</span>, <span class="hljs-built_in">float</span>, <span class="hljs-built_in">float</span>, <span class="hljs-built_in">float</span>]:

        target = self._target_pos
        tcp = self.tcp_center
        obj_head = self._get_site_pos(<span class="hljs-string">&quot;pegHead&quot;</span>)
        scale = np.array([<span class="hljs-number">1.0</span>, <span class="hljs-number">2.0</span>, <span class="hljs-number">2.0</span>])
        
        tcp_to_obj = <span class="hljs-built_in">float</span>(np.linalg.norm(obj - tcp))
        obj_to_target = <span class="hljs-built_in">float</span>(np.linalg.norm((obj_head - target) * scale))
        
        in_place_margin = <span class="hljs-built_in">float</span>(
            np.linalg.norm((self.peg_head_pos_init - target) * scale)
        )
        in_place = reward_utils.tolerance(
            obj_to_target,
            bounds=(<span class="hljs-number">0</span>, self.TARGET_RADIUS),
            margin=in_place_margin,
            sigmoid=<span class="hljs-string">&quot;long_tail&quot;</span>,
        )
        brc_col_box_1 = self._get_site_pos(<span class="hljs-string">&quot;bottom_right_corner_collision_box_1&quot;</span>)
        tlc_col_box_1 = self._get_site_pos(<span class="hljs-string">&quot;top_left_corner_collision_box_1&quot;</span>)

        brc_col_box_2 = self._get_site_pos(<span class="hljs-string">&quot;bottom_right_corner_collision_box_2&quot;</span>)
        tlc_col_box_2 = self._get_site_pos(<span class="hljs-string">&quot;top_left_corner_collision_box_2&quot;</span>)
        collision_box_bottom_1 = reward_utils.rect_prism_tolerance(
            curr=obj_head, one=tlc_col_box_1, zero=brc_col_box_1
        )
        collision_box_bottom_2 = reward_utils.rect_prism_tolerance(
            curr=obj_head, one=tlc_col_box_2, zero=brc_col_box_2
        )
        collision_boxes = reward_utils.hamacher_product(
            collision_box_bottom_2, collision_box_bottom_1
        )
        in_place = reward_utils.hamacher_product(in_place, collision_boxes)

        pad_success_margin = <span class="hljs-number">0.03</span>
        object_reach_radius = <span class="hljs-number">0.01</span>
        x_z_margin = <span class="hljs-number">0.005</span>
        obj_radius = <span class="hljs-number">0.0075</span>

        object_grasped = self._gripper_caging_reward(
            action,
            obj,
            object_reach_radius=object_reach_radius,
            obj_radius=obj_radius,
            pad_success_thresh=pad_success_margin,
            xz_thresh=x_z_margin,
            high_density=<span class="hljs-literal">True</span>,
        )
        <span class="hljs-keyword">if</span> (
            tcp_to_obj &lt; <span class="hljs-number">0.08</span>
            <span class="hljs-keyword">and</span> (tcp_opened &gt; <span class="hljs-number">0</span>)
            <span class="hljs-keyword">and</span> (obj[<span class="hljs-number">2</span>] - <span class="hljs-number">0.01</span> &gt; self.obj_init_pos[<span class="hljs-number">2</span>])
        ):
            object_grasped = <span class="hljs-number">1.0</span>
        in_place_and_object_grasped = reward_utils.hamacher_product(
            object_grasped, in_place
        )
        reward = in_place_and_object_grasped

        <span class="hljs-keyword">if</span> (
            tcp_to_obj &lt; <span class="hljs-number">0.08</span>
            <span class="hljs-keyword">and</span> (tcp_opened &gt; <span class="hljs-number">0</span>)
            <span class="hljs-keyword">and</span> (obj[<span class="hljs-number">2</span>] - <span class="hljs-number">0.01</span> &gt; self.obj_init_pos[<span class="hljs-number">2</span>])
        ):
            reward += <span class="hljs-number">1.0</span> + <span class="hljs-number">5</span> * in_place

        <span class="hljs-keyword">if</span> obj_to_target &lt;= <span class="hljs-number">0.07</span>:
            reward = <span class="hljs-number">10.0</span>

        <span class="hljs-keyword">return</span> (
            reward,
            tcp_opened,
            obj_to_target,
            object_grasped,
            in_place
        )

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_hole_info</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">tuple</span>[npt.NDArray[np.float64], npt.NDArray[np.float64]]:
        <span class="hljs-string">&quot;&quot;&quot;获取hole的位置和朝向信息&quot;&quot;&quot;</span>
        hole_pos = self._get_site_pos(<span class="hljs-string">&quot;hole&quot;</span>)
        <span class="hljs-comment"># 假设hole的朝向与box一致，这里简化处理</span>
        box_quat = self.data.body(<span class="hljs-string">&quot;box&quot;</span>).xquat
        <span class="hljs-keyword">return</span> hole_pos, box_quat

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_insertion_info</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]:
        <span class="hljs-string">&quot;&quot;&quot;获取插入相关信息&quot;&quot;&quot;</span>
        hole_pos, hole_quat = self.get_hole_info()
        peg_head_pos = self._get_site_pos(<span class="hljs-string">&quot;pegHead&quot;</span>)
        peg_quat = self._get_quat_objects()
        
        <span class="hljs-comment"># 计算插入深度</span>
        insertion_depth = np.dot(peg_head_pos - hole_pos, np.array([-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]))  <span class="hljs-comment"># 假设hole朝向为-y方向</span>
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">&quot;hole_pos&quot;</span>: hole_pos,
            <span class="hljs-string">&quot;hole_quat&quot;</span>: hole_quat,
            <span class="hljs-string">&quot;peg_head_pos&quot;</span>: peg_head_pos,
            <span class="hljs-string">&quot;peg_quat&quot;</span>: peg_quat,
            <span class="hljs-string">&quot;insertion_depth&quot;</span>: <span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, insertion_depth),
        }
</code></pre>
<h3 id="ppo_testsawyer_xyz_envpy">ppo_test/sawyer_xyz_env.py</h3>
<p><em>大小: 33.3 KB | Token: 9.4K</em></p>
<pre><code class="language-python"><span class="hljs-comment"># metaworld/sawyer_xyz_env.py</span>

<span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> annotations

<span class="hljs-keyword">import</span> abc
<span class="hljs-keyword">import</span> copy
<span class="hljs-keyword">import</span> pickle
<span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> cached_property
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Any</span>, <span class="hljs-type">Callable</span>, <span class="hljs-type">Literal</span>, SupportsFloat

<span class="hljs-keyword">import</span> mujoco
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> numpy.typing <span class="hljs-keyword">as</span> npt
<span class="hljs-keyword">from</span> gymnasium.envs.mujoco.mujoco_env <span class="hljs-keyword">import</span> MujocoEnv <span class="hljs-keyword">as</span> mjenv_gym
<span class="hljs-keyword">from</span> gymnasium.spaces <span class="hljs-keyword">import</span> Box, Discrete, Space
<span class="hljs-keyword">from</span> gymnasium.utils <span class="hljs-keyword">import</span> seeding
<span class="hljs-keyword">from</span> gymnasium.utils.ezpickle <span class="hljs-keyword">import</span> EzPickle
<span class="hljs-keyword">from</span> typing_extensions <span class="hljs-keyword">import</span> TypeAlias

<span class="hljs-keyword">from</span> ppo_test.types <span class="hljs-keyword">import</span> XYZ, EnvironmentStateDict, ObservationDict, Task
<span class="hljs-keyword">from</span> ppo_test.utils <span class="hljs-keyword">import</span> reward_utils
<span class="hljs-keyword">from</span> scipy.spatial.transform <span class="hljs-keyword">import</span> Rotation

RenderMode: TypeAlias = <span class="hljs-string">&quot;Literal[&#x27;human&#x27;, &#x27;rgb_array&#x27;, &#x27;depth_array&#x27;]&quot;</span>


<span class="hljs-keyword">class</span> <span class="hljs-title class_">SawyerMocapBase</span>(<span class="hljs-title class_ inherited__">mjenv_gym</span>):
    <span class="hljs-string">&quot;&quot;&quot;Provides some commonly-shared functions for Sawyer Mujoco envs that use mocap for XYZ control.&quot;&quot;&quot;</span>

    mocap_low = np.array([-<span class="hljs-number">0.2</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.06</span>, -<span class="hljs-number">1.0</span>, -<span class="hljs-number">1.0</span>, -<span class="hljs-number">1.0</span>, -<span class="hljs-number">1.0</span>])
    mocap_high = np.array([<span class="hljs-number">0.2</span>, <span class="hljs-number">0.7</span>, <span class="hljs-number">0.6</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>])
    metadata = {
        <span class="hljs-string">&quot;render_modes&quot;</span>: [
            <span class="hljs-string">&quot;human&quot;</span>,
            <span class="hljs-string">&quot;rgb_array&quot;</span>,
            <span class="hljs-string">&quot;depth_array&quot;</span>,
        ],
        <span class="hljs-string">&quot;render_fps&quot;</span>: <span class="hljs-number">80</span>,
    }

<span class="hljs-meta">    @cached_property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">sawyer_observation_space</span>(<span class="hljs-params">self</span>) -&gt; Space:
        <span class="hljs-keyword">raise</span> NotImplementedError

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">
        self,
        model_name: <span class="hljs-built_in">str</span>,
        frame_skip: <span class="hljs-built_in">int</span> = <span class="hljs-number">5</span>,
        render_mode: RenderMode | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
        camera_name: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
        camera_id: <span class="hljs-built_in">int</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
        width: <span class="hljs-built_in">int</span> = <span class="hljs-number">480</span>,
        height: <span class="hljs-built_in">int</span> = <span class="hljs-number">480</span>,
    </span>) -&gt; <span class="hljs-literal">None</span>:
        mjenv_gym.__init__(
            self,
            model_name,
            frame_skip=frame_skip,
            observation_space=self.sawyer_observation_space,
            render_mode=render_mode,
            camera_name=camera_name,
            camera_id=camera_id,
            width=width,
            height=height,
        )
        self.reset_mocap_welds()
        self.frame_skip = frame_skip

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_endeff_pos</span>(<span class="hljs-params">self</span>) -&gt; npt.NDArray[<span class="hljs-type">Any</span>]:
        <span class="hljs-string">&quot;&quot;&quot;Returns the position of the end effector.&quot;&quot;&quot;</span>
        <span class="hljs-keyword">return</span> self.data.body(<span class="hljs-string">&quot;hand&quot;</span>).xpos

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_endeff_quat</span>(<span class="hljs-params">self</span>) -&gt; npt.NDArray[<span class="hljs-type">Any</span>]:
        <span class="hljs-string">&quot;&quot;&quot;Returns the quaternion of the end effector.&quot;&quot;&quot;</span>
        <span class="hljs-keyword">return</span> self.data.body(<span class="hljs-string">&quot;hand&quot;</span>).xquat
        <span class="hljs-comment"># return self.data.mocap_quat[0][:]</span>
    

<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">tcp_center</span>(<span class="hljs-params">self</span>) -&gt; npt.NDArray[<span class="hljs-type">Any</span>]:
        <span class="hljs-string">&quot;&quot;&quot;The COM of the gripper&#x27;s 2 fingers.

        Returns:
            3-element position.
        &quot;&quot;&quot;</span>
        right_finger_pos = self.data.site(<span class="hljs-string">&quot;rightEndEffector&quot;</span>)
        left_finger_pos = self.data.site(<span class="hljs-string">&quot;leftEndEffector&quot;</span>)
        tcp_center = (right_finger_pos.xpos + left_finger_pos.xpos) / <span class="hljs-number">2.0</span>
        <span class="hljs-keyword">return</span> tcp_center

<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">model_name</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-keyword">raise</span> NotImplementedError

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_env_state</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">tuple</span>[npt.NDArray[np.float64], npt.NDArray[np.float64]]:
        <span class="hljs-string">&quot;&quot;&quot;Get the environment state.

        Returns:
            A tuple of (qpos, qvel).
        &quot;&quot;&quot;</span>
        qpos = np.copy(self.data.qpos)
        qvel = np.copy(self.data.qvel)
        <span class="hljs-keyword">return</span> copy.deepcopy((qpos, qvel))

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">set_env_state</span>(<span class="hljs-params">
        self, state: <span class="hljs-built_in">tuple</span>[npt.NDArray[np.float64], npt.NDArray[np.float64]]
    </span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">&quot;&quot;&quot;
        Set the environment state.

        Args:
            state: A tuple of (qpos, qvel).
        &quot;&quot;&quot;</span>
        qpos, qvel = state
        self.set_state(qpos, qvel)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getstate__</span>(<span class="hljs-params">self</span>) -&gt; EnvironmentStateDict:
        <span class="hljs-string">&quot;&quot;&quot;Returns the full state of the environment as a dict.

        Returns:
            A dictionary containing the env state from the `__dict__` method, the model name (path) and the mocap state `(qpos, qvel)`.
        &quot;&quot;&quot;</span>
        state = self.__dict__.copy()
        <span class="hljs-keyword">return</span> {<span class="hljs-string">&quot;state&quot;</span>: state, <span class="hljs-string">&quot;mjb&quot;</span>: self.model_name, <span class="hljs-string">&quot;mocap&quot;</span>: self.get_env_state()}

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__setstate__</span>(<span class="hljs-params">self, state: EnvironmentStateDict</span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">&quot;&quot;&quot;Sets the state of the environment from a dict exported through `__getstate__()`.

        Args:
            state: A dictionary containing the env state from the `__dict__` method, the model name (path) and the mocap state `(qpos, qvel)`.
        &quot;&quot;&quot;</span>
        self.__dict__ = state[<span class="hljs-string">&quot;state&quot;</span>]
        mjenv_gym.__init__(
            self,
            state[<span class="hljs-string">&quot;mjb&quot;</span>],
            frame_skip=self.frame_skip,
            observation_space=self.sawyer_observation_space,
            render_mode=self.render_mode,
            camera_name=self.camera_name,
            camera_id=self.camera_id,
            width=self.width,
            height=self.height,
        )
        self.set_env_state(state[<span class="hljs-string">&quot;mocap&quot;</span>])

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">reset_mocap_welds</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">&quot;&quot;&quot;Resets the mocap welds that we use for actuation.&quot;&quot;&quot;</span>
        <span class="hljs-keyword">if</span> self.model.nmocap &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> self.model.eq_data <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(self.model.eq_data.shape[<span class="hljs-number">0</span>]):
                <span class="hljs-keyword">if</span> self.model.eq_type[i] == mujoco.mjtEq.mjEQ_WELD:
                    self.model.eq_data[i] = np.array(
                        [<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, -<span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">5.0</span>]
                    )


<span class="hljs-keyword">class</span> <span class="hljs-title class_">SawyerXYZEnv</span>(SawyerMocapBase, EzPickle):
    <span class="hljs-string">&quot;&quot;&quot;The base environment for all Sawyer Mujoco envs that use mocap for XYZ control.&quot;&quot;&quot;</span>

    _HAND_POS_SPACE = Box(
        np.array([-<span class="hljs-number">0.525</span>, <span class="hljs-number">0.348</span>, -<span class="hljs-number">0.0525</span>]),
        np.array([+<span class="hljs-number">0.525</span>, <span class="hljs-number">1.025</span>, <span class="hljs-number">0.7</span>]),
        dtype=np.float64,
    )
    <span class="hljs-string">&quot;&quot;&quot;Bounds for hand position.&quot;&quot;&quot;</span>

    _HAND_QUAT_SPACE = Box(
        np.array([-<span class="hljs-number">1.0</span>, -<span class="hljs-number">1.0</span>, -<span class="hljs-number">1.0</span>, -<span class="hljs-number">1.0</span>]),
        np.array([<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>]),
        dtype=np.float64,
    )
    <span class="hljs-string">&quot;&quot;&quot;Bounds for hand quaternion.&quot;&quot;&quot;</span>

    max_path_length: <span class="hljs-built_in">int</span> = <span class="hljs-number">500</span>
    <span class="hljs-string">&quot;&quot;&quot;The maximum path length for the environment (the task horizon).&quot;&quot;&quot;</span>

    TARGET_RADIUS: <span class="hljs-built_in">float</span> = <span class="hljs-number">0.05</span>
    <span class="hljs-string">&quot;&quot;&quot;Upper bound for distance from the target when checking for task completion.&quot;&quot;&quot;</span>

    <span class="hljs-keyword">class</span> <span class="hljs-title class_">_Decorators</span>:
<span class="hljs-meta">        @classmethod</span>
        <span class="hljs-keyword">def</span> <span class="hljs-title function_">assert_task_is_set</span>(<span class="hljs-params">cls, func: <span class="hljs-type">Callable</span></span>) -&gt; <span class="hljs-type">Callable</span>:
            <span class="hljs-string">&quot;&quot;&quot;Asserts that the task has been set in the environment before proceeding with the function call.
            To be used as a decorator for SawyerXYZEnv methods.&quot;&quot;&quot;</span>

            <span class="hljs-keyword">def</span> <span class="hljs-title function_">inner</span>(<span class="hljs-params">*args, **kwargs</span>) -&gt; <span class="hljs-type">Any</span>:
                env = args[<span class="hljs-number">0</span>]
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> env._set_task_called:
                    <span class="hljs-keyword">raise</span> RuntimeError(
                        <span class="hljs-string">&quot;You must call env.set_task before using env.&quot;</span> + func.__name__
                    )
                <span class="hljs-keyword">return</span> func(*args, **kwargs)

            <span class="hljs-keyword">return</span> inner

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">
        self,
        frame_skip: <span class="hljs-built_in">int</span> = <span class="hljs-number">5</span>,
        hand_low: XYZ = (<span class="hljs-params">-<span class="hljs-number">0.2</span>, <span class="hljs-number">0.55</span>, <span class="hljs-number">0.05</span></span>),
        hand_high: XYZ = (<span class="hljs-params"><span class="hljs-number">0.2</span>, <span class="hljs-number">0.75</span>, <span class="hljs-number">0.3</span></span>),
        mocap_low: XYZ | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
        mocap_high: XYZ | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
        render_mode: RenderMode | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
        camera_id: <span class="hljs-built_in">int</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
        camera_name: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
        width: <span class="hljs-built_in">int</span> = <span class="hljs-number">480</span>,
        height: <span class="hljs-built_in">int</span> = <span class="hljs-number">480</span>,
    </span>) -&gt; <span class="hljs-literal">None</span>:
        self.hand_low = np.array(hand_low)
        self.hand_high = np.array(hand_high)
        <span class="hljs-keyword">if</span> mocap_low <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            mocap_low = hand_low
        <span class="hljs-keyword">if</span> mocap_high <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            mocap_high = hand_high
        self.mocap_low = np.hstack((mocap_low, [-<span class="hljs-number">1.0</span>, -<span class="hljs-number">1.0</span>, -<span class="hljs-number">1.0</span>]))
        self.mocap_high = np.hstack((mocap_high, [<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>]))
        
        self.curr_path_length: <span class="hljs-built_in">int</span> = <span class="hljs-number">0</span>
        self.seeded_rand_vec: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>
        self._freeze_rand_vec: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">True</span>
        self._last_rand_vec: npt.NDArray[<span class="hljs-type">Any</span>] | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>
        self.obj_init_pos: npt.NDArray[<span class="hljs-type">Any</span>] | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>

        self._partially_observable: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">True</span>

        self.task_name = self.__class__.__name__
        self._obs_obj_max_len: <span class="hljs-built_in">int</span> = <span class="hljs-number">14</span>
        self._set_task_called: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>
        
        <span class="hljs-built_in">super</span>().__init__(
            self.model_name,
            frame_skip=frame_skip,
            render_mode=render_mode,
            camera_name=camera_name,
            camera_id=camera_id,
            width=width,
            height=height,
        )

        mujoco.mj_forward(
            self.model, self.data
        )  <span class="hljs-comment"># *** DO NOT REMOVE: EZPICKLE WON&#x27;T WORK *** #</span>
        
        self._did_see_sim_exception: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>
        self.init_left_pad: npt.NDArray[<span class="hljs-type">Any</span>] = self.get_body_com(<span class="hljs-string">&quot;leftpad&quot;</span>)
        self.init_right_pad: npt.NDArray[<span class="hljs-type">Any</span>] = self.get_body_com(<span class="hljs-string">&quot;rightpad&quot;</span>)

        self.action_space = Box(  <span class="hljs-comment"># type: ignore</span>
            np.array([-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>]),
            np.array([+<span class="hljs-number">1</span>, +<span class="hljs-number">1</span>, +<span class="hljs-number">1</span>, +<span class="hljs-number">1</span>, +<span class="hljs-number">1</span>, +<span class="hljs-number">1</span>, +<span class="hljs-number">1</span>]),
            dtype=np.float32,
        )

        self.hand_init_pos: npt.NDArray[<span class="hljs-type">Any</span>] | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>  <span class="hljs-comment"># OVERRIDE ME</span>
        self.hand_init_quat: npt.NDArray[<span class="hljs-type">Any</span>] | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>  <span class="hljs-comment"># OVERRIDE ME</span>
        self._target_pos: npt.NDArray[<span class="hljs-type">Any</span>] | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>  <span class="hljs-comment"># OVERRIDE ME</span>
        self._random_reset_space: Box | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>  <span class="hljs-comment"># OVERRIDE ME</span>
        self.goal_space: Box | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>  <span class="hljs-comment"># OVERRIDE ME</span>
        self._last_stable_obs: npt.NDArray[np.float64] | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>

        <span class="hljs-comment"># Note: It is unlikely that the positions and orientations stored</span>
        <span class="hljs-comment"># in this initiation of _prev_obs are correct. That being said, it</span>
        <span class="hljs-comment"># doesn&#x27;t seem to matter (it will only effect frame-stacking for the</span>
        <span class="hljs-comment"># very first observation)</span>
        <span class="hljs-comment"># The observation size is 3 (pos) + 4 (quat) + 1 (gripper) + 3 (force) + 14 (obj_padded) = 25</span>
        <span class="hljs-comment"># Stacked observation is 25 * 2 + 3 (goal) = 53</span>
        self.init_qpos = np.copy(self.data.qpos)
        self.init_qvel = np.copy(self.data.qvel)
        self._prev_obs = np.zeros(<span class="hljs-number">25</span>, dtype=np.float64)

        self.task_name = self.__class__.__name__

        EzPickle.__init__(
            self,
            self.model_name,
            frame_skip,
            hand_low,
            hand_high,
            mocap_low,
            mocap_high,
            render_mode,
            camera_id,
            camera_name,
            width,
            height,
        )

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">seed</span>(<span class="hljs-params">self, seed: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">list</span>[<span class="hljs-built_in">int</span>]:
        <span class="hljs-string">&quot;&quot;&quot;Seeds the environment.

        Args:
            seed: The seed to use.

        Returns:
            The seed used inside a 1 element list.
        &quot;&quot;&quot;</span>
        <span class="hljs-keyword">assert</span> seed <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>
        self.np_random, seed = seeding.np_random(seed)
        self.action_space.seed(seed)
        self.observation_space.seed(seed)
        <span class="hljs-keyword">assert</span> self.goal_space
        self.goal_space.seed(seed)
        <span class="hljs-keyword">return</span> [seed]

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_set_task_inner</span>() -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">&quot;&quot;&quot;Helper method to set additional task data. To be overridden by subclasses as appropriate.&quot;&quot;&quot;</span>
        <span class="hljs-comment"># Doesn&#x27;t absorb &quot;extra&quot; kwargs, to ensure nothing&#x27;s missed.</span>
        <span class="hljs-keyword">pass</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">set_task</span>(<span class="hljs-params">self, task: Task</span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">&quot;&quot;&quot;Sets the environment&#x27;s task.

        Args:
            task: The task to set.
        &quot;&quot;&quot;</span>
        self._set_task_called = <span class="hljs-literal">True</span>
        data = pickle.loads(task.data)
        <span class="hljs-keyword">assert</span> <span class="hljs-built_in">isinstance</span>(self, data[<span class="hljs-string">&quot;env_cls&quot;</span>])
        <span class="hljs-keyword">del</span> data[<span class="hljs-string">&quot;env_cls&quot;</span>]
        self._freeze_rand_vec = <span class="hljs-literal">True</span>
        self._last_rand_vec = data[<span class="hljs-string">&quot;rand_vec&quot;</span>]
        <span class="hljs-keyword">del</span> data[<span class="hljs-string">&quot;rand_vec&quot;</span>]
        new_observability = data[<span class="hljs-string">&quot;partially_observable&quot;</span>]
        <span class="hljs-keyword">if</span> new_observability != self._partially_observable:
            <span class="hljs-comment"># Force recomputation of the observation space</span>
            <span class="hljs-comment"># See https://docs.python.org/3/library/functools.html#functools.cached_property</span>
            <span class="hljs-keyword">del</span> self.sawyer_observation_space
        self._partially_observable = new_observability
        <span class="hljs-keyword">del</span> data[<span class="hljs-string">&quot;partially_observable&quot;</span>]
        self._set_task_inner(**data)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">set_xyz_action</span>(<span class="hljs-params">self, action: npt.NDArray[<span class="hljs-type">Any</span>]</span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">&quot;&quot;&quot;Adjusts the position of the mocap body from the given action.
        Moves each body axis in XYZ by the amount described by the action.

        Args:
            action: The action to apply (in offsets between :math:`[-1, 1]` for each axis in XYZ).
        &quot;&quot;&quot;</span>
        action = np.clip(action, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)
        pos_delta = action[:<span class="hljs-number">3</span>]
        new_mocap_pos = self.data.mocap_pos + pos_delta[<span class="hljs-literal">None</span>]
        new_mocap_pos[<span class="hljs-number">0</span>, :] = np.clip(
            new_mocap_pos[<span class="hljs-number">0</span>, :],
            self.mocap_low[:<span class="hljs-number">3</span>],
            self.mocap_high[:<span class="hljs-number">3</span>],
        )
        self.data.mocap_pos = new_mocap_pos
        
        
        current_mocap = self.data.mocap_quat[<span class="hljs-number">0</span>]
        new_mocap_r = Rotation.from_quat(current_mocap[[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">0</span>]]) * Rotation.from_euler(<span class="hljs-string">&#x27;xyz&#x27;</span>, action[<span class="hljs-number">3</span>:<span class="hljs-number">6</span>], degrees=<span class="hljs-literal">True</span>)
        new_mocap_quat = new_mocap_r.as_quat()[[<span class="hljs-number">3</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>]]
        self.data.mocap_quat[<span class="hljs-number">0</span>] = new_mocap_quat

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_set_obj_xyz</span>(<span class="hljs-params">self, pos: npt.NDArray[<span class="hljs-type">Any</span>]</span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">&quot;&quot;&quot;Sets the position of the object.

        Args:
            pos: The position to set as a numpy array of 3 elements (XYZ value).
        &quot;&quot;&quot;</span>
        qpos = self.data.qpos.flat.copy()
        qvel = self.data.qvel.flat.copy()
        qpos[<span class="hljs-number">9</span>:<span class="hljs-number">12</span>] = pos.copy() <span class="hljs-comment"># 前 9 个分别对应 7 个关节角度和 2 个夹爪的控制量</span>
        qvel[<span class="hljs-number">9</span>:<span class="hljs-number">15</span>] = <span class="hljs-number">0</span>
        self.set_state(qpos, qvel)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_site_pos</span>(<span class="hljs-params">self, site_name: <span class="hljs-built_in">str</span></span>) -&gt; npt.NDArray[np.float64]:
        <span class="hljs-string">&quot;&quot;&quot;Gets the position of a given site.

        Args:
            site_name: The name of the site to get the position of.

        Returns:
            Flat, 3 element array indicating site&#x27;s location.
        &quot;&quot;&quot;</span>
        <span class="hljs-keyword">return</span> self.data.site(site_name).xpos.copy()

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_set_pos_site</span>(<span class="hljs-params">self, name: <span class="hljs-built_in">str</span>, pos: npt.NDArray[<span class="hljs-type">Any</span>]</span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">&quot;&quot;&quot;Sets the position of a given site.

        Args:
            name: The site&#x27;s name
            pos: Flat, 3 element array indicating site&#x27;s location
        &quot;&quot;&quot;</span>
        <span class="hljs-keyword">assert</span> <span class="hljs-built_in">isinstance</span>(pos, np.ndarray)
        <span class="hljs-keyword">assert</span> pos.ndim == <span class="hljs-number">1</span>

        self.data.site(name).xpos = pos[:<span class="hljs-number">3</span>]

<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_target_site_config</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">list</span>[<span class="hljs-built_in">tuple</span>[<span class="hljs-built_in">str</span>, npt.NDArray[<span class="hljs-type">Any</span>]]]:
        <span class="hljs-string">&quot;&quot;&quot;Retrieves site name(s) and position(s) corresponding to env targets.&quot;&quot;&quot;</span>
        <span class="hljs-keyword">assert</span> self._target_pos <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>
        <span class="hljs-keyword">return</span> [(<span class="hljs-string">&quot;goal&quot;</span>, self._target_pos)]

<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">touching_main_object</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">bool</span>:
        <span class="hljs-string">&quot;&quot;&quot;Calls `touching_object` for the ID of the env&#x27;s main object.

        Returns:
            Whether the gripper is touching the object
        &quot;&quot;&quot;</span>
        <span class="hljs-keyword">return</span> self.touching_object(self._get_id_main_object())

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">touching_object</span>(<span class="hljs-params">self, object_geom_id: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">bool</span>:
        <span class="hljs-string">&quot;&quot;&quot;Determines whether the gripper is touching the object with given id.

        Args:
            object_geom_id: the ID of the object in question

        Returns:
            Whether the gripper is touching the object
        &quot;&quot;&quot;</span>

        leftpad_geom_id = self.data.geom(<span class="hljs-string">&quot;leftpad_geom&quot;</span>).<span class="hljs-built_in">id</span>
        rightpad_geom_id = self.data.geom(<span class="hljs-string">&quot;rightpad_geom&quot;</span>).<span class="hljs-built_in">id</span>

        leftpad_object_contacts = [
            x
            <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> self.data.contact
            <span class="hljs-keyword">if</span> (
                leftpad_geom_id <span class="hljs-keyword">in</span> (x.geom1, x.geom2)
                <span class="hljs-keyword">and</span> object_geom_id <span class="hljs-keyword">in</span> (x.geom1, x.geom2)
            )
        ]

        rightpad_object_contacts = [
            x
            <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> self.data.contact
            <span class="hljs-keyword">if</span> (
                rightpad_geom_id <span class="hljs-keyword">in</span> (x.geom1, x.geom2)
                <span class="hljs-keyword">and</span> object_geom_id <span class="hljs-keyword">in</span> (x.geom1, x.geom2)
            )
        ]

        leftpad_object_contact_force = <span class="hljs-built_in">sum</span>(
            self.data.efc_force[x.efc_address] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> leftpad_object_contacts
        )

        rightpad_object_contact_force = <span class="hljs-built_in">sum</span>(
            self.data.efc_force[x.efc_address] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> rightpad_object_contacts
        )

        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span> &lt; leftpad_object_contact_force <span class="hljs-keyword">and</span> <span class="hljs-number">0</span> &lt; rightpad_object_contact_force

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_id_main_object</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">int</span>:
        <span class="hljs-keyword">return</span> self.data.geom(<span class="hljs-string">&quot;objGeom&quot;</span>).<span class="hljs-built_in">id</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_pos_objects</span>(<span class="hljs-params">self</span>) -&gt; npt.NDArray[<span class="hljs-type">Any</span>]:
        <span class="hljs-string">&quot;&quot;&quot;Retrieves object position(s) from mujoco properties or instance vars.

        Returns:
            Flat array (usually 3 elements) representing the object(s)&#x27; position(s)
        &quot;&quot;&quot;</span>
        <span class="hljs-comment"># Throw error rather than making this an @abc.abstractmethod so that</span>
        <span class="hljs-comment"># V1 environments don&#x27;t have to implement it</span>
        <span class="hljs-keyword">raise</span> NotImplementedError

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_quat_objects</span>(<span class="hljs-params">self</span>) -&gt; npt.NDArray[<span class="hljs-type">Any</span>]:
        <span class="hljs-string">&quot;&quot;&quot;Retrieves object quaternion(s) from mujoco properties.

        Returns:
            Flat array (usually 4 elements) representing the object(s)&#x27; quaternion(s)
        &quot;&quot;&quot;</span>
        <span class="hljs-comment"># Throw error rather than making this an @abc.abstractmethod so that</span>
        <span class="hljs-comment"># V1 environments don&#x27;t have to implement it</span>
        <span class="hljs-keyword">raise</span> NotImplementedError

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_pos_goal</span>(<span class="hljs-params">self</span>) -&gt; npt.NDArray[<span class="hljs-type">Any</span>]:
        <span class="hljs-string">&quot;&quot;&quot;Retrieves goal position from mujoco properties or instance vars.

        Returns:
            Flat array (3 elements) representing the goal position
        &quot;&quot;&quot;</span>
        <span class="hljs-keyword">assert</span> <span class="hljs-built_in">isinstance</span>(self._target_pos, np.ndarray)
        <span class="hljs-keyword">assert</span> self._target_pos.ndim == <span class="hljs-number">1</span>
        <span class="hljs-keyword">return</span> self._target_pos

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_curr_obs_combined_no_goal</span>(<span class="hljs-params">self</span>) -&gt; npt.NDArray[np.float64]:
        <span class="hljs-string">&quot;&quot;&quot;Combines the end effector&#x27;s {pos, closed amount} and the object(s)&#x27; {pos, quat} into a single flat observation.

        Note: The goal&#x27;s position is *not* included in this.

        Returns:
            The flat observation array (18 elements + force data)
        &quot;&quot;&quot;</span>

        pos_hand = self.tcp_center
        quat_hand = self.get_endeff_quat() <span class="hljs-comment"># Get hand quaternion</span>

        finger_right, finger_left = (
            self.data.body(<span class="hljs-string">&quot;rightclaw&quot;</span>),
            self.data.body(<span class="hljs-string">&quot;leftclaw&quot;</span>),
        )
        <span class="hljs-comment"># the gripper can be at maximum about ~0.1 m apart.</span>
        <span class="hljs-comment"># dividing by 0.1 normalized the gripper distance between</span>
        <span class="hljs-comment"># 0 and 1. Further, we clip because sometimes the grippers</span>
        <span class="hljs-comment"># are slightly more than 0.1m apart (~0.00045 m)</span>
        <span class="hljs-comment"># clipping removes the effects of this random extra distance</span>
        <span class="hljs-comment"># that is produced by mujoco</span>

        gripper_distance_apart = np.linalg.norm(finger_right.xpos - finger_left.xpos)
        gripper_distance_apart = np.clip(gripper_distance_apart / <span class="hljs-number">0.1</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>)

        obs_obj_padded = np.zeros(self._obs_obj_max_len)
        obj_pos = self._get_pos_objects()
        <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(obj_pos) % <span class="hljs-number">3</span> == <span class="hljs-number">0</span>
        obj_pos_split = np.split(obj_pos, <span class="hljs-built_in">len</span>(obj_pos) // <span class="hljs-number">3</span>)

        obj_quat = self._get_quat_objects()
        <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(obj_quat) % <span class="hljs-number">4</span> == <span class="hljs-number">0</span>
        obj_quat_split = np.split(obj_quat, <span class="hljs-built_in">len</span>(obj_quat) // <span class="hljs-number">4</span>)
        obs_obj_padded[: <span class="hljs-built_in">len</span>(obj_pos) + <span class="hljs-built_in">len</span>(obj_quat)] = np.hstack(
            [np.hstack((pos, quat)) <span class="hljs-keyword">for</span> pos, quat <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(obj_pos_split, obj_quat_split)]
        )
        <span class="hljs-keyword">try</span>:
            pegHead_force = self._get_pegHead_force()
        <span class="hljs-keyword">except</span> NotImplementedError:
            pegHead_force = np.zeros(<span class="hljs-number">3</span>)
        <span class="hljs-keyword">return</span> np.hstack((pos_hand, quat_hand, gripper_distance_apart, pegHead_force, obs_obj_padded))


<span class="hljs-meta">    @cached_property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">sawyer_observation_space</span>(<span class="hljs-params">self</span>) -&gt; Box:
        obs_obj_max_len = self._obs_obj_max_len
        obj_low = np.full(obs_obj_max_len, -np.inf, dtype=np.float64)
        obj_high = np.full(obs_obj_max_len, +np.inf, dtype=np.float64)
        <span class="hljs-keyword">if</span> self._partially_observable:
            goal_low = np.zeros(<span class="hljs-number">3</span>)
            goal_high = np.zeros(<span class="hljs-number">3</span>)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">assert</span> (
                self.goal_space <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>
            ), <span class="hljs-string">&quot;The goal space must be defined to use full observability&quot;</span>
            goal_low = self.goal_space.low
            goal_high = self.goal_space.high
        gripper_low = -<span class="hljs-number">1.0</span>
        gripper_high = +<span class="hljs-number">1.0</span>
        
        force_low = np.full(<span class="hljs-number">3</span>, -np.inf, dtype=np.float64)
        force_high = np.full(<span class="hljs-number">3</span>, np.inf, dtype=np.float64)

        <span class="hljs-comment"># Current observation: pos_hand (3) + quat_hand (4) + gripper_distance_apart (1) + obs_obj_padded (14) + pegHead_force (3) = 25</span>
        <span class="hljs-comment"># Previous observation: 25</span>
        <span class="hljs-comment"># Goal: 3</span>
        <span class="hljs-comment"># Total: 25 + 25 + 3 = 53</span>
        <span class="hljs-keyword">return</span> Box(
            np.hstack(
                (
                    self._HAND_POS_SPACE.low, 
                    self._HAND_QUAT_SPACE.low,
                    gripper_low,
                    force_low,
                    obj_low,
                    self._HAND_POS_SPACE.low, 
                    self._HAND_QUAT_SPACE.low,
                    gripper_low,
                    force_low,
                    obj_low,
                    goal_low,
                )
            ),
            np.hstack(
                (
                    self._HAND_POS_SPACE.high,
                    self._HAND_QUAT_SPACE.high,
                    gripper_high,
                    force_high,
                    obj_high,
                    self._HAND_POS_SPACE.high,
                    self._HAND_QUAT_SPACE.high,
                    gripper_high,
                    force_high,
                    obj_high,
                    goal_high,
                )
            ),
            dtype=np.float64,
        )

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_obs</span>(<span class="hljs-params">self</span>) -&gt; npt.NDArray[np.float64]:
        pos_goal = self._get_pos_goal()
        <span class="hljs-keyword">if</span> self._partially_observable:
            pos_goal = np.zeros_like(pos_goal)
        curr_obs = self._get_curr_obs_combined_no_goal()
        obs = np.hstack((curr_obs, self._prev_obs, pos_goal))
        self._prev_obs = curr_obs
        <span class="hljs-keyword">return</span> obs

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_obs_dict</span>(<span class="hljs-params">self</span>) -&gt; ObservationDict:
        obs = self._get_obs()
        <span class="hljs-comment"># The state_achieved_goal should be the end-effector position (3) + quaternion (4) = 7 elements</span>
        <span class="hljs-comment"># The current observation is pos_hand (3) + quat_hand (4) + gripper_distance_apart (1) + 3 (force) + obs_obj_padded (14) = 25</span>
        <span class="hljs-comment"># The previous observation is 25 elements</span>
        <span class="hljs-comment"># The goal is 3 elements</span>
        <span class="hljs-comment"># Total observation is 25 + 25 + 3 = 53</span>
        <span class="hljs-comment"># state_achieved_goal should be the current end-effector pos and quat, which are the first 7 elements of curr_obs</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">dict</span>(
            state_observation=obs,
            state_desired_goal=self._get_pos_goal(),
            state_achieved_goal=obs[:<span class="hljs-number">7</span>], <span class="hljs-comment"># Updated to reflect hand pos and quat</span>
        )
        
<span class="hljs-meta">    @_Decorators.assert_task_is_set</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">step</span>(<span class="hljs-params">
        self, action: npt.NDArray[np.float32]
    </span>) -&gt; <span class="hljs-built_in">tuple</span>[npt.NDArray[np.float64], SupportsFloat, <span class="hljs-built_in">bool</span>, <span class="hljs-built_in">bool</span>, <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]]:
        <span class="hljs-string">&quot;&quot;&quot;Step the environment.

        Args:
            action: The action to take. Must be a 7 element array of floats.

        Returns:
            The (next_obs, reward, terminated, truncated, info) tuple.
        &quot;&quot;&quot;</span>
        <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(action) == <span class="hljs-number">7</span>, <span class="hljs-string">f&quot;Actions should be size 7, got <span class="hljs-subst">{<span class="hljs-built_in">len</span>(action)}</span>&quot;</span> <span class="hljs-comment"># Changed to 7</span>
        self.set_xyz_action(action[:<span class="hljs-number">6</span>]) <span class="hljs-comment"># Pass position and rotation actions</span>
        <span class="hljs-keyword">if</span> self.curr_path_length &gt;= self.max_path_length:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;You must reset the env manually once truncate==True&quot;</span>)
        self.do_simulation([action[-<span class="hljs-number">1</span>], -action[-<span class="hljs-number">1</span>]], n_frames=self.frame_skip)
        self.curr_path_length += <span class="hljs-number">1</span>

        <span class="hljs-comment"># Running the simulator can sometimes mess up site positions, so</span>
        <span class="hljs-comment"># re-position them here to make sure they&#x27;re accurate</span>
        <span class="hljs-keyword">for</span> site <span class="hljs-keyword">in</span> self._target_site_config:
            self._set_pos_site(*site)

        <span class="hljs-keyword">if</span> self._did_see_sim_exception:
            <span class="hljs-keyword">assert</span> self._last_stable_obs <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>
            <span class="hljs-keyword">return</span> (
                self._last_stable_obs,  <span class="hljs-comment"># observation just before going unstable</span>
                <span class="hljs-number">0.0</span>,  <span class="hljs-comment"># reward (penalize for causing instability)</span>
                <span class="hljs-literal">False</span>,  <span class="hljs-comment"># termination flag always False</span>
                <span class="hljs-literal">False</span>,
                {
                    <span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">False</span>,
                    <span class="hljs-string">&quot;near_object&quot;</span>: <span class="hljs-number">0.0</span>,
                    <span class="hljs-string">&quot;grasp_success&quot;</span>: <span class="hljs-literal">False</span>,
                    <span class="hljs-string">&quot;grasp_reward&quot;</span>: <span class="hljs-number">0.0</span>,
                    <span class="hljs-string">&quot;in_place_reward&quot;</span>: <span class="hljs-number">0.0</span>,
                    <span class="hljs-string">&quot;obj_to_target&quot;</span>: <span class="hljs-number">0.0</span>,
                    <span class="hljs-string">&quot;unscaled_reward&quot;</span>: <span class="hljs-number">0.0</span>,
                },
            )
        mujoco.mj_forward(self.model, self.data)
        
        self._last_stable_obs = self._get_obs()
        self._last_stable_obs = np.clip(
            self._last_stable_obs,
            a_max=self.sawyer_observation_space.high,
            a_min=self.sawyer_observation_space.low,
            dtype=np.float64,
        )
        
        <span class="hljs-keyword">assert</span> <span class="hljs-built_in">isinstance</span>(self._last_stable_obs, np.ndarray)
        reward, info = self.evaluate_state(self._last_stable_obs, action)
        <span class="hljs-comment"># step will never return a terminate==True if there is a success</span>
        <span class="hljs-comment"># but we can return truncate=True if the current path length == max path length</span>
        truncate = <span class="hljs-literal">False</span>
        <span class="hljs-keyword">if</span> self.curr_path_length == self.max_path_length:
            truncate = <span class="hljs-literal">True</span>
        <span class="hljs-keyword">return</span> (
            np.array(self._last_stable_obs, dtype=np.float64),
            reward,
            <span class="hljs-literal">False</span>,
            truncate,
            info,
        )

<span class="hljs-meta">    @abc.abstractmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">evaluate_state</span>(<span class="hljs-params">
        self, obs: npt.NDArray[np.float64], action: npt.NDArray[np.float32]
    </span>) -&gt; <span class="hljs-built_in">tuple</span>[<span class="hljs-built_in">float</span>, <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]]:
        <span class="hljs-string">&quot;&quot;&quot;
        Does the heavy-lifting for `step()` -- namely, calculating reward and populating the `info` dict with training metrics.

        Returns:
            Tuple of reward between 0 and 10 and a dictionary which contains useful metrics (success,
                near_object, grasp_success, grasp_reward, in_place_reward,
                obj_to_target, unscaled_reward)
        &quot;&quot;&quot;</span>
        <span class="hljs-keyword">raise</span> NotImplementedError

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">reset_model</span>(<span class="hljs-params">self</span>) -&gt; npt.NDArray[np.float64]:
        qpos = self.init_qpos
        qvel = self.init_qvel
        self.set_state(qpos, qvel)
        <span class="hljs-keyword">return</span> self._get_obs()

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">reset</span>(<span class="hljs-params">
        self, seed: <span class="hljs-built_in">int</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>, options: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>] | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>
    </span>) -&gt; <span class="hljs-built_in">tuple</span>[npt.NDArray[np.float64], <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]]:
        <span class="hljs-string">&quot;&quot;&quot;Resets the environment.

        Args:
            seed: The seed to use. Ignored, use `seed()` instead.
            options: Additional options to pass to the environment. Ignored.

        Returns:
            The `(obs, info)` tuple.
        &quot;&quot;&quot;</span>
        self.curr_path_length = <span class="hljs-number">0</span>
        self.reset_model()
        obs, info = <span class="hljs-built_in">super</span>().reset()
        <span class="hljs-keyword">assert</span> obs <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>, <span class="hljs-string">&quot;Observation should not be None after reset&quot;</span>
        curr_obs_len = self._HAND_POS_SPACE.shape[<span class="hljs-number">0</span>] + self._HAND_QUAT_SPACE.shape[<span class="hljs-number">0</span>] + <span class="hljs-number">1</span> + <span class="hljs-number">3</span> + self._obs_obj_max_len <span class="hljs-comment"># 3 for force</span>
        self._prev_obs = obs[:curr_obs_len].copy()        
        <span class="hljs-keyword">return</span> obs, info

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_reset_hand</span>(<span class="hljs-params">self, steps: <span class="hljs-built_in">int</span> = <span class="hljs-number">50</span></span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">&quot;&quot;&quot;Resets the hand position.

        Args:
            steps: The number of steps to take to reset the hand.
        &quot;&quot;&quot;</span>
        mocap_id = self.model.body_mocapid[self.data.body(<span class="hljs-string">&quot;mocap&quot;</span>).<span class="hljs-built_in">id</span>]
        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(steps):
            self.data.mocap_pos[mocap_id][:] = self.hand_init_pos
            self.data.mocap_quat[mocap_id][:] = self.hand_init_quat
            self.do_simulation([-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>], self.frame_skip)
        self.init_tcp = self.tcp_center

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_state_rand_vec</span>(<span class="hljs-params">self</span>) -&gt; npt.NDArray[np.float64]:
        <span class="hljs-string">&quot;&quot;&quot;Gets or generates a random vector for the hand position at reset.&quot;&quot;&quot;</span>
        <span class="hljs-keyword">if</span> self._freeze_rand_vec:
            <span class="hljs-keyword">assert</span> self._last_rand_vec <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>
            <span class="hljs-keyword">return</span> self._last_rand_vec
        <span class="hljs-keyword">elif</span> self.seeded_rand_vec:
            <span class="hljs-keyword">assert</span> self._random_reset_space <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>
            rand_vec = self.np_random.uniform(
                self._random_reset_space.low,
                self._random_reset_space.high,
                size=self._random_reset_space.low.size,
            )
            self._last_rand_vec = rand_vec
            <span class="hljs-keyword">return</span> rand_vec
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">assert</span> self._random_reset_space <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>
            rand_vec: npt.NDArray[np.float64] = np.random.uniform(  <span class="hljs-comment"># type: ignore</span>
                self._random_reset_space.low,
                self._random_reset_space.high,
                size=self._random_reset_space.low.size,
            ).astype(np.float64)
            self._last_rand_vec = rand_vec
            <span class="hljs-keyword">return</span> rand_vec

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_gripper_caging_reward</span>(<span class="hljs-params">
        self,
        action: npt.NDArray[np.float32],
        obj_pos: npt.NDArray[<span class="hljs-type">Any</span>],
        obj_radius: <span class="hljs-built_in">float</span>,
        pad_success_thresh: <span class="hljs-built_in">float</span>,
        object_reach_radius: <span class="hljs-built_in">float</span>,
        xz_thresh: <span class="hljs-built_in">float</span>,
        desired_gripper_effort: <span class="hljs-built_in">float</span> = <span class="hljs-number">1.0</span>,
        high_density: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>,
        medium_density: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>,
    </span>) -&gt; <span class="hljs-built_in">float</span>:
        <span class="hljs-string">&quot;&quot;&quot;Reward for agent grasping obj.

        Args:
            action(np.ndarray): (4,) array representing the action
                delta(x), delta(y), delta(z), gripper_effort
            obj_pos(np.ndarray): (3,) array representing the obj x,y,z
            obj_radius(float):radius of object&#x27;s bounding sphere
            pad_success_thresh(float): successful distance of gripper_pad
                to object
            object_reach_radius(float): successful distance of gripper center
                to the object.
            xz_thresh(float): successful distance of gripper in x_z axis to the
                object. Y axis not included since the caging function handles
                    successful grasping in the Y axis.
            desired_gripper_effort(float): desired gripper effort, defaults to 1.0.
            high_density(bool): flag for high-density. Cannot be used with medium-density.
            medium_density(bool): flag for medium-density. Cannot be used with high-density.

        Returns:
            the reward value
        &quot;&quot;&quot;</span>
        <span class="hljs-keyword">assert</span> (
            self.obj_init_pos <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>
        ), <span class="hljs-string">&quot;`obj_init_pos` must be initialized before calling this function.&quot;</span>

        <span class="hljs-keyword">if</span> high_density <span class="hljs-keyword">and</span> medium_density:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;Can only be either high_density or medium_density&quot;</span>)
        <span class="hljs-comment"># MARK: Left-right gripper information for caging reward----------------</span>
        left_pad = self.get_body_com(<span class="hljs-string">&quot;leftpad&quot;</span>)
        right_pad = self.get_body_com(<span class="hljs-string">&quot;rightpad&quot;</span>)

        <span class="hljs-comment"># get current positions of left and right pads (Y axis)</span>
        pad_y_lr = np.hstack((left_pad[<span class="hljs-number">1</span>], right_pad[<span class="hljs-number">1</span>]))
        <span class="hljs-comment"># compare *current* pad positions with *current* obj position (Y axis)</span>
        pad_to_obj_lr = np.<span class="hljs-built_in">abs</span>(pad_y_lr - obj_pos[<span class="hljs-number">1</span>])
        <span class="hljs-comment"># compare *current* pad positions with *initial* obj position (Y axis)</span>
        pad_to_objinit_lr = np.<span class="hljs-built_in">abs</span>(pad_y_lr - self.obj_init_pos[<span class="hljs-number">1</span>])

        <span class="hljs-comment"># Compute the left/right caging rewards. This is crucial for success,</span>
        <span class="hljs-comment"># yet counterintuitive mathematically because we invented it</span>
        <span class="hljs-comment"># accidentally.</span>
        <span class="hljs-comment">#</span>
        <span class="hljs-comment"># Before touching the object, `pad_to_obj_lr` (&quot;x&quot;) is always separated</span>
        <span class="hljs-comment"># from `caging_lr_margin` (&quot;the margin&quot;) by some small number,</span>
        <span class="hljs-comment"># `pad_success_thresh`.</span>
        <span class="hljs-comment">#</span>
        <span class="hljs-comment"># When far away from the object:</span>
        <span class="hljs-comment">#       x = margin + pad_success_thresh</span>
        <span class="hljs-comment">#       --&gt; Thus x is outside the margin, yielding very small reward.</span>
        <span class="hljs-comment">#           Here, any variation in the reward is due to the fact that</span>
        <span class="hljs-comment">#           the margin itself is shifting.</span>
        <span class="hljs-comment"># When near the object (within pad_success_thresh):</span>
        <span class="hljs-comment">#       x = pad_success_thresh - margin</span>
        <span class="hljs-comment">#       --&gt; Thus x is well within the margin. As long as x &gt; obj_radius,</span>
        <span class="hljs-comment">#           it will also be within the bounds, yielding maximum reward.</span>
        <span class="hljs-comment">#           Here, any variation in the reward is due to the gripper</span>
        <span class="hljs-comment">#           moving *too close* to the object (i.e, blowing past the</span>
        <span class="hljs-comment">#           obj_radius bound).</span>
        <span class="hljs-comment">#</span>
        <span class="hljs-comment"># Therefore, before touching the object, this is very nearly a binary</span>
        <span class="hljs-comment"># reward -- if the gripper is between obj_radius and pad_success_thresh,</span>
        <span class="hljs-comment"># it gets maximum reward. Otherwise, the reward very quickly falls off.</span>
        <span class="hljs-comment">#</span>
        <span class="hljs-comment"># After grasping the object and moving it away from initial position,</span>
        <span class="hljs-comment"># x remains (mostly) constant while the margin grows considerably. This</span>
        <span class="hljs-comment"># penalizes the agent if it moves *back* toward `obj_init_pos`, but</span>
        <span class="hljs-comment"># offers no encouragement for leaving that position in the first place.</span>
        <span class="hljs-comment"># That part is left to the reward functions of individual environments.</span>
        caging_lr_margin = np.<span class="hljs-built_in">abs</span>(pad_to_objinit_lr - pad_success_thresh)
        caging_lr = [
            reward_utils.tolerance(
                pad_to_obj_lr[i],  <span class="hljs-comment"># &quot;x&quot; in the description above</span>
                bounds=(obj_radius, pad_success_thresh),
                margin=caging_lr_margin[i],  <span class="hljs-comment"># &quot;margin&quot; in the description above</span>
                sigmoid=<span class="hljs-string">&quot;long_tail&quot;</span>,
            )
            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>)
        ]
        caging_y = reward_utils.hamacher_product(*caging_lr)

        <span class="hljs-comment"># MARK: X-Z gripper information for caging reward-----------------------</span>
        tcp = self.tcp_center
        xz = [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>]

        <span class="hljs-comment"># Compared to the caging_y reward, caging_xz is simple. The margin is</span>
        <span class="hljs-comment"># constant (something in the 0.3 to 0.5 range) and x shrinks as the</span>
        <span class="hljs-comment"># gripper moves towards the object. After picking up the object, the</span>
        <span class="hljs-comment"># reward is maximized and changes very little</span>
        caging_xz_margin = np.linalg.norm(self.obj_init_pos[xz] - self.init_tcp[xz])
        caging_xz_margin -= xz_thresh
        caging_xz = reward_utils.tolerance(
            np.linalg.norm(tcp[xz] - obj_pos[xz]),  <span class="hljs-comment"># &quot;x&quot; in the description above</span>
            bounds=(<span class="hljs-number">0</span>, xz_thresh),
            margin=caging_xz_margin,  <span class="hljs-comment"># &quot;margin&quot; in the description above</span>
            sigmoid=<span class="hljs-string">&quot;long_tail&quot;</span>,
        )

        <span class="hljs-comment"># MARK: Closed-extent gripper information for caging reward-------------</span>
        gripper_closed = (
            <span class="hljs-built_in">min</span>(<span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, action[-<span class="hljs-number">1</span>]), desired_gripper_effort) / desired_gripper_effort
        )

        <span class="hljs-comment"># MARK: Combine components----------------------------------------------</span>
        caging = reward_utils.hamacher_product(caging_y, <span class="hljs-built_in">float</span>(caging_xz))
        gripping = gripper_closed <span class="hljs-keyword">if</span> caging &gt; <span class="hljs-number">0.97</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0.0</span>
        caging_and_gripping = reward_utils.hamacher_product(caging, gripping)

        <span class="hljs-keyword">if</span> high_density:
            caging_and_gripping = (caging_and_gripping + caging) / <span class="hljs-number">2</span>
        <span class="hljs-keyword">if</span> medium_density:
            tcp = self.tcp_center
            tcp_to_obj = np.linalg.norm(obj_pos - tcp)
            tcp_to_obj_init = np.linalg.norm(self.obj_init_pos - self.init_tcp)
            <span class="hljs-comment"># Compute reach reward</span>
            <span class="hljs-comment"># - We subtract `object_reach_radius` from the margin so that the</span>
            <span class="hljs-comment">#   reward always starts with a value of 0.1</span>
            reach_margin = <span class="hljs-built_in">abs</span>(tcp_to_obj_init - object_reach_radius)
            reach = reward_utils.tolerance(
                tcp_to_obj,
                bounds=(<span class="hljs-number">0</span>, object_reach_radius),
                margin=reach_margin,
                sigmoid=<span class="hljs-string">&quot;long_tail&quot;</span>,
            )
            caging_and_gripping = (caging_and_gripping + <span class="hljs-built_in">float</span>(reach)) / <span class="hljs-number">2</span>

        <span class="hljs-keyword">return</span> caging_and_gripping
</code></pre>
<h3 id="ppo_testtypespy">ppo_test/types.py</h3>
<p><em>大小: 1.2 KB | Token: 331</em></p>
<pre><code class="language-python"><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> annotations

<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Any</span>, NamedTuple, <span class="hljs-type">Tuple</span>

<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> numpy.typing <span class="hljs-keyword">as</span> npt
<span class="hljs-keyword">from</span> typing_extensions <span class="hljs-keyword">import</span> NotRequired, TypeAlias, TypedDict


<span class="hljs-keyword">class</span> <span class="hljs-title class_">Task</span>(<span class="hljs-title class_ inherited__">NamedTuple</span>):
    <span class="hljs-string">&quot;&quot;&quot;All data necessary to describe a single MDP.

    Should be passed into a `MetaWorldEnv`&#x27;s `set_task` method.
    &quot;&quot;&quot;</span>

    env_name: <span class="hljs-built_in">str</span>
    data: <span class="hljs-built_in">bytes</span>  <span class="hljs-comment"># Contains env parameters like random_init and *a* goal</span>


XYZ: TypeAlias = <span class="hljs-string">&quot;Tuple[float, float, float]&quot;</span>
<span class="hljs-string">&quot;&quot;&quot;A 3D coordinate.&quot;&quot;&quot;</span>


<span class="hljs-keyword">class</span> <span class="hljs-title class_">EnvironmentStateDict</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    state: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]
    mjb: <span class="hljs-built_in">str</span>
    mocap: <span class="hljs-built_in">tuple</span>[npt.NDArray[np.float64], npt.NDArray[np.float64]]


<span class="hljs-keyword">class</span> <span class="hljs-title class_">ObservationDict</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    state_observation: npt.NDArray[np.float64]
    state_desired_goal: npt.NDArray[np.float64]
    state_achieved_goal: npt.NDArray[np.float64]


<span class="hljs-keyword">class</span> <span class="hljs-title class_">InitConfigDict</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    obj_init_angle: NotRequired[<span class="hljs-built_in">float</span>]
    obj_init_pos: npt.NDArray[<span class="hljs-type">Any</span>]
    hand_init_pos: npt.NDArray[<span class="hljs-type">Any</span>]


<span class="hljs-keyword">class</span> <span class="hljs-title class_">HammerInitConfigDict</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    hammer_init_pos: npt.NDArray[<span class="hljs-type">Any</span>]
    hand_init_pos: npt.NDArray[<span class="hljs-type">Any</span>]


<span class="hljs-keyword">class</span> <span class="hljs-title class_">StickInitConfigDict</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    stick_init_pos: npt.NDArray[<span class="hljs-type">Any</span>]
    hand_init_pos: npt.NDArray[<span class="hljs-type">Any</span>]
</code></pre>
<h3 id="ppo_testwrapperspy">ppo_test/wrappers.py</h3>
<p><em>大小: 11.6 KB | Token: 3.3K</em></p>
<pre><code class="language-python"><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> annotations

<span class="hljs-keyword">import</span> base64

<span class="hljs-keyword">import</span> gymnasium <span class="hljs-keyword">as</span> gym
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">from</span> gymnasium <span class="hljs-keyword">import</span> Env
<span class="hljs-keyword">from</span> numpy.typing <span class="hljs-keyword">import</span> NDArray

<span class="hljs-keyword">from</span> ppo_test.sawyer_xyz_env <span class="hljs-keyword">import</span> SawyerXYZEnv
<span class="hljs-keyword">from</span> ppo_test.types <span class="hljs-keyword">import</span> Task


<span class="hljs-keyword">class</span> <span class="hljs-title class_">OneHotWrapper</span>(gym.ObservationWrapper, gym.utils.RecordConstructorArgs):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, env: Env, task_idx: <span class="hljs-built_in">int</span>, num_tasks: <span class="hljs-built_in">int</span></span>):
        gym.utils.RecordConstructorArgs.__init__(self)
        gym.ObservationWrapper.__init__(self, env)
        <span class="hljs-keyword">assert</span> <span class="hljs-built_in">isinstance</span>(env.observation_space, gym.spaces.Box)
        env_lb = env.observation_space.low
        env_ub = env.observation_space.high
        one_hot_ub = np.ones(num_tasks)
        one_hot_lb = np.zeros(num_tasks)

        self.one_hot = np.zeros(num_tasks)
        self.one_hot[task_idx] = <span class="hljs-number">1.0</span>

        self._observation_space = gym.spaces.Box(
            np.concatenate([env_lb, one_hot_lb]), np.concatenate([env_ub, one_hot_ub])
        )

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">observation</span>(<span class="hljs-params">self, obs: NDArray</span>) -&gt; NDArray:
        <span class="hljs-keyword">return</span> np.concatenate([obs, self.one_hot])


<span class="hljs-keyword">def</span> <span class="hljs-title function_">_serialize_task</span>(<span class="hljs-params">task: Task</span>) -&gt; <span class="hljs-built_in">dict</span>:
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">&quot;env_name&quot;</span>: task.env_name,
        <span class="hljs-string">&quot;data&quot;</span>: base64.b64encode(task.data).decode(<span class="hljs-string">&quot;ascii&quot;</span>),
    }


<span class="hljs-keyword">def</span> <span class="hljs-title function_">_deserialize_task</span>(<span class="hljs-params">task_dict: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>]</span>) -&gt; Task:
    <span class="hljs-keyword">assert</span> <span class="hljs-string">&quot;env_name&quot;</span> <span class="hljs-keyword">in</span> task_dict <span class="hljs-keyword">and</span> <span class="hljs-string">&quot;data&quot;</span> <span class="hljs-keyword">in</span> task_dict

    <span class="hljs-keyword">return</span> Task(
        env_name=task_dict[<span class="hljs-string">&quot;env_name&quot;</span>], data=base64.b64decode(task_dict[<span class="hljs-string">&quot;data&quot;</span>])
    )


<span class="hljs-keyword">class</span> <span class="hljs-title class_">RNNBasedMetaRLWrapper</span>(gym.Wrapper):
    <span class="hljs-string">&quot;&quot;&quot;A Gymnasium Wrapper to automatically include prev_action / reward / done info in the observation.
    For use with RNN-based meta-RL algorithms.&quot;&quot;&quot;</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, env: Env, normalize_reward: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">True</span></span>):
        <span class="hljs-built_in">super</span>().__init__(env)
        <span class="hljs-keyword">assert</span> <span class="hljs-built_in">isinstance</span>(self.env.observation_space, gym.spaces.Box)
        <span class="hljs-keyword">assert</span> <span class="hljs-built_in">isinstance</span>(self.env.action_space, gym.spaces.Box)
        obs_flat_dim = <span class="hljs-built_in">int</span>(np.prod(self.env.observation_space.shape))
        action_flat_dim = <span class="hljs-built_in">int</span>(np.prod(self.env.action_space.shape))
        self._observation_space = gym.spaces.Box(
            low=-np.inf, high=np.inf, shape=(obs_flat_dim + action_flat_dim + <span class="hljs-number">1</span> + <span class="hljs-number">1</span>,)
        )
        self._normalize_reward = normalize_reward

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">step</span>(<span class="hljs-params">self, action</span>):
        next_obs, reward, terminate, truncate, info = self.env.step(action)
        <span class="hljs-keyword">if</span> self._normalize_reward:
            obs_reward = <span class="hljs-built_in">float</span>(reward) / <span class="hljs-number">10.0</span>
        <span class="hljs-keyword">else</span>:
            obs_reward = <span class="hljs-built_in">float</span>(reward)

        recurrent_obs = np.concatenate(
            [
                next_obs,
                action,
                [obs_reward],
                [<span class="hljs-built_in">float</span>(np.logical_or(terminate, truncate))],
            ]
        )
        <span class="hljs-keyword">return</span> recurrent_obs, reward, terminate, truncate, info

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">reset</span>(<span class="hljs-params">self, *, seed: <span class="hljs-built_in">int</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>, options: <span class="hljs-built_in">dict</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span></span>):
        <span class="hljs-keyword">assert</span> <span class="hljs-built_in">isinstance</span>(self.env.action_space, gym.spaces.Box)
        obs, info = self.env.reset(seed=seed, options=options)
        recurrent_obs = np.concatenate(
            [obs, np.zeros(self.env.action_space.shape), [<span class="hljs-number">0.0</span>], [<span class="hljs-number">0.0</span>]]
        )
        <span class="hljs-keyword">return</span> recurrent_obs, info


<span class="hljs-keyword">class</span> <span class="hljs-title class_">RandomTaskSelectWrapper</span>(gym.Wrapper):
    <span class="hljs-string">&quot;&quot;&quot;A Gymnasium Wrapper to automatically set / reset the environment to a random
    task.&quot;&quot;&quot;</span>

    tasks: <span class="hljs-built_in">list</span>[Task]
    sample_tasks_on_reset: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">True</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_set_random_task</span>(<span class="hljs-params">self</span>):
        task_idx = self.np_random.choice(<span class="hljs-built_in">len</span>(self.tasks))
        self.unwrapped.set_task(self.tasks[task_idx])

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">
        self,
        env: Env,
        tasks: <span class="hljs-built_in">list</span>[Task],
        sample_tasks_on_reset: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">True</span>,
    </span>):
        <span class="hljs-built_in">super</span>().__init__(env)
        self.unwrapped: SawyerXYZEnv
        self.tasks = tasks
        self.sample_tasks_on_reset = sample_tasks_on_reset

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">toggle_sample_tasks_on_reset</span>(<span class="hljs-params">self, on: <span class="hljs-built_in">bool</span></span>):
        self.sample_tasks_on_reset = on

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">reset</span>(<span class="hljs-params">self, *, seed: <span class="hljs-built_in">int</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>, options: <span class="hljs-built_in">dict</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span></span>):
        <span class="hljs-keyword">if</span> self.sample_tasks_on_reset:
            self._set_random_task()
        <span class="hljs-keyword">return</span> self.env.reset(seed=seed, options=options)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">sample_tasks</span>(<span class="hljs-params">self, *, seed: <span class="hljs-built_in">int</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>, options: <span class="hljs-built_in">dict</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span></span>):
        self._set_random_task()
        <span class="hljs-keyword">return</span> self.env.reset(seed=seed, options=options)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_checkpoint</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">dict</span>:
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">&quot;tasks&quot;</span>: [_serialize_task(task) <span class="hljs-keyword">for</span> task <span class="hljs-keyword">in</span> self.tasks],
            <span class="hljs-string">&quot;rng_state&quot;</span>: self.np_random.bit_generator.state,
            <span class="hljs-string">&quot;sample_tasks_on_reset&quot;</span>: self.sample_tasks_on_reset,
            <span class="hljs-string">&quot;env_rng_state&quot;</span>: get_env_rng_checkpoint(self.unwrapped),
        }

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">load_checkpoint</span>(<span class="hljs-params">self, ckpt: <span class="hljs-built_in">dict</span></span>):
        <span class="hljs-keyword">assert</span> <span class="hljs-string">&quot;tasks&quot;</span> <span class="hljs-keyword">in</span> ckpt
        <span class="hljs-keyword">assert</span> <span class="hljs-string">&quot;rng_state&quot;</span> <span class="hljs-keyword">in</span> ckpt
        <span class="hljs-keyword">assert</span> <span class="hljs-string">&quot;sample_tasks_on_reset&quot;</span> <span class="hljs-keyword">in</span> ckpt
        <span class="hljs-keyword">assert</span> <span class="hljs-string">&quot;env_rng_state&quot;</span> <span class="hljs-keyword">in</span> ckpt

        self.tasks = [_deserialize_task(task) <span class="hljs-keyword">for</span> task <span class="hljs-keyword">in</span> ckpt[<span class="hljs-string">&quot;tasks&quot;</span>]]
        self.np_random.__setstate__(ckpt[<span class="hljs-string">&quot;rng_state&quot;</span>])
        self.sample_tasks_on_reset = ckpt[<span class="hljs-string">&quot;sample_tasks_on_reset&quot;</span>]
        set_env_rng(self.unwrapped, ckpt[<span class="hljs-string">&quot;env_rng_state&quot;</span>])


<span class="hljs-keyword">class</span> <span class="hljs-title class_">PseudoRandomTaskSelectWrapper</span>(gym.Wrapper):
    <span class="hljs-string">&quot;&quot;&quot;A Gymnasium Wrapper to automatically reset the environment to a *pseudo*random task when explicitly called.

    Pseudorandom implies no collisions therefore the next task in the list will be used cyclically.
    However, the tasks will be shuffled every time the last task of the previous shuffle is reached.

    Doesn&#x27;t sample new tasks on reset by default.
    &quot;&quot;&quot;</span>

    tasks: <span class="hljs-built_in">list</span>[Task]
    current_task_idx: <span class="hljs-built_in">int</span>
    sample_tasks_on_reset: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_set_pseudo_random_task</span>(<span class="hljs-params">self</span>):
        self.current_task_idx = (self.current_task_idx + <span class="hljs-number">1</span>) % <span class="hljs-built_in">len</span>(self.tasks)
        <span class="hljs-keyword">if</span> self.current_task_idx == <span class="hljs-number">0</span>:
            self.np_random.shuffle(self.tasks)  <span class="hljs-comment"># pyright: ignore [reportArgumentType]</span>
        self.unwrapped.set_task(self.tasks[self.current_task_idx])

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">toggle_sample_tasks_on_reset</span>(<span class="hljs-params">self, on: <span class="hljs-built_in">bool</span></span>):
        self.sample_tasks_on_reset = on

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">
        self,
        env: Env,
        tasks: <span class="hljs-built_in">list</span>[Task],
        sample_tasks_on_reset: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>,
    </span>):
        <span class="hljs-built_in">super</span>().__init__(env)
        self.sample_tasks_on_reset = sample_tasks_on_reset
        self.tasks = tasks
        self.current_task_idx = -<span class="hljs-number">1</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">reset</span>(<span class="hljs-params">self, *, seed: <span class="hljs-built_in">int</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>, options: <span class="hljs-built_in">dict</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span></span>):
        <span class="hljs-keyword">if</span> self.sample_tasks_on_reset:
            self._set_pseudo_random_task()
        <span class="hljs-keyword">return</span> self.env.reset(seed=seed, options=options)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">sample_tasks</span>(<span class="hljs-params">self, *, seed: <span class="hljs-built_in">int</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>, options: <span class="hljs-built_in">dict</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span></span>):
        self._set_pseudo_random_task()
        <span class="hljs-keyword">return</span> self.env.reset(seed=seed, options=options)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_checkpoint</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">dict</span>:
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">&quot;tasks&quot;</span>: [_serialize_task(task) <span class="hljs-keyword">for</span> task <span class="hljs-keyword">in</span> self.tasks],
            <span class="hljs-string">&quot;current_task_idx&quot;</span>: self.current_task_idx,
            <span class="hljs-string">&quot;sample_tasks_on_reset&quot;</span>: self.sample_tasks_on_reset,
            <span class="hljs-string">&quot;env_rng_state&quot;</span>: get_env_rng_checkpoint(self.unwrapped),
        }

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">load_checkpoint</span>(<span class="hljs-params">self, ckpt: <span class="hljs-built_in">dict</span></span>):
        <span class="hljs-keyword">assert</span> <span class="hljs-string">&quot;tasks&quot;</span> <span class="hljs-keyword">in</span> ckpt
        <span class="hljs-keyword">assert</span> <span class="hljs-string">&quot;current_task_idx&quot;</span> <span class="hljs-keyword">in</span> ckpt
        <span class="hljs-keyword">assert</span> <span class="hljs-string">&quot;sample_tasks_on_reset&quot;</span> <span class="hljs-keyword">in</span> ckpt
        <span class="hljs-keyword">assert</span> <span class="hljs-string">&quot;env_rng_state&quot;</span> <span class="hljs-keyword">in</span> ckpt

        self.tasks = [_deserialize_task(task) <span class="hljs-keyword">for</span> task <span class="hljs-keyword">in</span> ckpt[<span class="hljs-string">&quot;tasks&quot;</span>]]
        self.current_task_idx = ckpt[<span class="hljs-string">&quot;current_task_idx&quot;</span>]
        self.sample_tasks_on_reset = ckpt[<span class="hljs-string">&quot;sample_tasks_on_reset&quot;</span>]
        set_env_rng(self.unwrapped, ckpt[<span class="hljs-string">&quot;env_rng_state&quot;</span>])


<span class="hljs-keyword">class</span> <span class="hljs-title class_">AutoTerminateOnSuccessWrapper</span>(gym.Wrapper):
    <span class="hljs-string">&quot;&quot;&quot;A Gymnasium Wrapper to automatically output a termination signal when the environment&#x27;s task is solved.
    That is, when the &#x27;success&#x27; key in the info dict is True.

    This is not the case by default in SawyerXYZEnv, because terminating on success during training leads to
    instability and poor evaluation performance. However, this behaviour is desired during said evaluation.
    Hence the existence of this wrapper.

    Best used *under* an AutoResetWrapper and RecordEpisodeStatistics and the like.&quot;&quot;&quot;</span>

    terminate_on_success: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">True</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, env: Env</span>):
        <span class="hljs-built_in">super</span>().__init__(env)
        self.terminate_on_success = <span class="hljs-literal">True</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">toggle_terminate_on_success</span>(<span class="hljs-params">self, on: <span class="hljs-built_in">bool</span></span>):
        self.terminate_on_success = on

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">step</span>(<span class="hljs-params">self, action</span>):
        obs, reward, terminated, truncated, info = self.env.step(action)
        <span class="hljs-keyword">if</span> self.terminate_on_success:
            terminated = info[<span class="hljs-string">&quot;success&quot;</span>] == <span class="hljs-number">1.0</span>
        <span class="hljs-keyword">return</span> obs, reward, terminated, truncated, info


<span class="hljs-keyword">class</span> <span class="hljs-title class_">NormalizeRewardsExponential</span>(gym.Wrapper):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, reward_alpha, env</span>):
        <span class="hljs-built_in">super</span>().__init__(env)
        self._reward_alpha = reward_alpha
        self._reward_mean = <span class="hljs-number">0.0</span>
        self._reward_var = <span class="hljs-number">1.0</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_update_reward_estimate</span>(<span class="hljs-params">self, reward</span>):
        self._reward_mean = (
            <span class="hljs-number">1</span> - self._reward_alpha
        ) * self._reward_mean + self._reward_alpha * reward
        self._reward_var = (
            <span class="hljs-number">1</span> - self._reward_alpha
        ) * self._reward_var + self._reward_alpha * np.square(
            reward - self._reward_mean
        )

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_apply_normalize_reward</span>(<span class="hljs-params">self, reward</span>):
        self._update_reward_estimate(reward)
        <span class="hljs-keyword">return</span> reward / (np.sqrt(self._reward_var) + <span class="hljs-number">1e-8</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">step</span>(<span class="hljs-params">self, action: NDArray</span>):
        next_obs, reward, terminate, truncate, info = self.env.step(action)
        self._update_reward_estimate(reward)  <span class="hljs-comment"># type: ignore</span>
        reward = self._apply_normalize_reward(reward)  <span class="hljs-comment"># type: ignore</span>
        <span class="hljs-keyword">return</span> next_obs, reward, terminate, truncate, info


<span class="hljs-keyword">def</span> <span class="hljs-title function_">update_mean_var_count_from_moments</span>(<span class="hljs-params">
    mean, var, count, batch_mean, batch_var, batch_count
</span>):
    delta = batch_mean - mean
    tot_count = count + batch_count
    new_mean = mean + delta * batch_count / tot_count
    m_a = var * count
    m_b = batch_var * batch_count
    M2 = m_a + m_b + np.square(delta) * count * batch_count / tot_count
    new_var = M2 / tot_count
    new_count = tot_count
    <span class="hljs-keyword">return</span> new_mean, new_var, new_count


<span class="hljs-keyword">class</span> <span class="hljs-title class_">CheckpointWrapper</span>(gym.Wrapper):
    env_id: <span class="hljs-built_in">str</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, env: gym.Env, env_id: <span class="hljs-built_in">str</span></span>):
        <span class="hljs-built_in">super</span>().__init__(env)
        <span class="hljs-keyword">assert</span> <span class="hljs-built_in">hasattr</span>(self.env, <span class="hljs-string">&quot;get_checkpoint&quot;</span>) <span class="hljs-keyword">and</span> <span class="hljs-built_in">callable</span>(self.env.get_checkpoint)
        <span class="hljs-keyword">assert</span> <span class="hljs-built_in">hasattr</span>(self.env, <span class="hljs-string">&quot;load_checkpoint&quot;</span>) <span class="hljs-keyword">and</span> <span class="hljs-built_in">callable</span>(
            self.env.load_checkpoint
        )
        self.env_id = env_id

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_checkpoint</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">tuple</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">dict</span>]:
        ckpt: <span class="hljs-built_in">dict</span> = self.env.get_checkpoint()
        <span class="hljs-keyword">return</span> (self.env_id, ckpt)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">load_checkpoint</span>(<span class="hljs-params">self, ckpts: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">tuple</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">dict</span>]]</span>) -&gt; <span class="hljs-literal">None</span>:
        my_ckpt = <span class="hljs-literal">None</span>
        <span class="hljs-keyword">for</span> env_id, ckpt <span class="hljs-keyword">in</span> ckpts:
            <span class="hljs-keyword">if</span> env_id == self.env_id:
                my_ckpt = ckpt
                <span class="hljs-keyword">break</span>
        <span class="hljs-keyword">if</span> my_ckpt <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">raise</span> ValueError(
                <span class="hljs-string">f&quot;Could not load checkpoint, no checkpoint found with id <span class="hljs-subst">{self.env_id}</span>. Checkpoint IDs: &quot;</span>,
                [env_id <span class="hljs-keyword">for</span> env_id, _ <span class="hljs-keyword">in</span> ckpts],
            )
        self.env.load_checkpoint(my_ckpt)


<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_env_rng_checkpoint</span>(<span class="hljs-params">env: SawyerXYZEnv</span>) -&gt; <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">dict</span>]:
    <span class="hljs-keyword">return</span> {  <span class="hljs-comment"># pyright: ignore [reportReturnType]</span>
        <span class="hljs-string">&quot;np_random_state&quot;</span>: env.np_random.bit_generator.state,
        <span class="hljs-string">&quot;action_space_rng_state&quot;</span>: env.action_space.np_random.bit_generator.state,
        <span class="hljs-string">&quot;obs_space_rng_state&quot;</span>: env.observation_space.np_random.bit_generator.state,
        <span class="hljs-string">&quot;goal_space_rng_state&quot;</span>: env.goal_space.np_random.bit_generator.state,  <span class="hljs-comment"># type: ignore</span>
    }


<span class="hljs-keyword">def</span> <span class="hljs-title function_">set_env_rng</span>(<span class="hljs-params">env: SawyerXYZEnv, state: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">dict</span>]</span>) -&gt; <span class="hljs-literal">None</span>:
    <span class="hljs-keyword">assert</span> <span class="hljs-string">&quot;np_random_state&quot;</span> <span class="hljs-keyword">in</span> state
    <span class="hljs-keyword">assert</span> <span class="hljs-string">&quot;action_space_rng_state&quot;</span> <span class="hljs-keyword">in</span> state
    <span class="hljs-keyword">assert</span> <span class="hljs-string">&quot;obs_space_rng_state&quot;</span> <span class="hljs-keyword">in</span> state
    <span class="hljs-keyword">assert</span> <span class="hljs-string">&quot;goal_space_rng_state&quot;</span> <span class="hljs-keyword">in</span> state

    env.np_random.bit_generator.state = state[<span class="hljs-string">&quot;np_random_state&quot;</span>]
    env.action_space.np_random.bit_generator.state = state[<span class="hljs-string">&quot;action_space_rng_state&quot;</span>]
    env.observation_space.np_random.bit_generator.state = state[<span class="hljs-string">&quot;obs_space_rng_state&quot;</span>]
    env.goal_space.np_random.bit_generator.state = state[<span class="hljs-string">&quot;goal_space_rng_state&quot;</span>]  <span class="hljs-comment"># type: ignore</span>
</code></pre>

            
            
        </body>
        </html>